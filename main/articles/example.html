<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="crmPack">
<title>crmPack: Object-oriented implementation of CRM designs • crmPack</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="crmPack: Object-oriented implementation of CRM designs">
<meta property="og:description" content="crmPack">
<meta property="og:image" content="https://roche.github.io/crmPack/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">crmPack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.9000.9133</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/trial_definition.html">Trial Definition</a>
    <a class="dropdown-item" href="../articles/trial_analysis.html">Trial Analysis</a>
    <a class="dropdown-item" href="../articles/trial_sanity_checks.html">Trial Design: basic sanity checks</a>
    <a class="dropdown-item" href="../articles/trial_simulation.html">Trial Simulation</a>
    <a class="dropdown-item" href="../articles/rolling-crm.html">Rolling CRM Example</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulation study example</a>
    <a class="dropdown-item" href="../articles/migration_from_the_old_crmPack.html">Migrating from crmPack version 1.0.3</a>
    <a class="dropdown-item" href="../articles/parallel_computing_with_extensions.html">Parallel computing with extensions</a>
    <a class="dropdown-item" href="../articles/crmPack-jss-paper.html">Model-based Dose Escalation Designs in R with crmPack (JSS manuscript)</a>
    <a class="dropdown-item" href="../articles/example.html">crmPack: Object-oriented implementation of CRM designs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/roche/crmPack">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="example_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="example_files/viz-1.8.2/viz.js"></script><link href="example_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="example_files/grViz-binding-1.0.10/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>crmPack: Object-oriented implementation of CRM designs</h1>
                        <h4 data-toc-skip class="author">Ziwei Liao,
Daniel Sabanes Bove</h4>
            
            <h4 data-toc-skip class="date">02 January 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/roche/crmPack/blob/HEAD/vignettes/example.Rmd" class="external-link"><code>vignettes/example.Rmd</code></a></small>
      <div class="d-none name"><code>example.Rmd</code></div>
    </div>

    
    
<pre><code><span><span class="co">## Loading required package: ggplot2</span></span></code></pre>
<pre><code><span><span class="co">## Registered S3 method overwritten by 'crmPack':</span></span>
<span><span class="co">##   method       from  </span></span>
<span><span class="co">##   print.gtable gtable</span></span></code></pre>
<pre><code><span><span class="co">## Type crmPackHelp() to open help browser</span></span>
<span><span class="co">## Type crmPackExample() to open example</span></span></code></pre>
<p>This short vignette shall introduce into the usage of the package
<code>crmPack</code>. Hopefully it makes it easy for you to set up your
own CRM.</p>
<p>If you have any questions or feedback concerning the package, please
write an email to the package maintainer: <a href="mailto:sabanesd@roche.com">sabanesd@roche.com</a>.</p>
<p>Thank you very much in advance!</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Many models in <code>crmPack</code> rely on <a href="http://mcmc-jags.sourceforge.net/" class="external-link">JAGS</a> (please click on the
link for going to the webpage of the project) for the internal MCMC
computations. WinBUGS is not required or supported anymore.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Before being able to run anything, you have to load the package
with</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/roche/crmPack" class="external-link">crmPack</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/gluc/data.tree" class="external-link">data.tree</a></span><span class="op">)</span></span></code></pre></div>
<p>For browsing the help pages for the package, it is easiest to start
the web browser interface with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/crmPackHelp.html">crmPackHelp</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This gives you the list of all help pages available for the package.
The whole R-package is built in a modular form, by using S4 classes and
methods. Please have a look at the help page “Methods” to read an
introduction into the S4 object framework of R, by typing
<code>?Methods</code> in the R console. In the next sections we will
therefore go one by one through the important building blocks (S4
classes and corresponding methods) of CRM designs with
<code>crmPack</code>.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  pathString <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"GeneralData/Data/DataDual"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.tree/man/as.Node.html" class="external-link">as.Node</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.tree/man/ToDiagrammeRGraph.html" class="external-link">SetNodeStyle</a></span><span class="op">(</span><span class="va">tree</span>, shape <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-556723c54bdaed263d3e" style="width:576px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-556723c54bdaed263d3e">{"x":{"diagram":"digraph {\n\n\n\n\n  \"1\" [label = \"GeneralData\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"Data\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"DataDual\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"2\"->\"3\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
Data classes structure
</p>
</div>
<p>We have three data classes for this package. The parent class is the
<code>GeneralData</code> class. The <code>Data</code> class is
inheriting from the <code>GeneralData</code> class and the
<code>DataDual</code> class is inheriting from the <code>Data</code>
class. Inheritance means that the subclass has all the slots
(attributes) of the parent class, but can also have additional slots.
Methods that work on the parent class also work the same way on the
subclass, unless a specialized method for the subclass has been
defined.</p>
<p>First, we will set up the data set. If you are at the beginning of a
trial, no observations will be available. Then we can define an empty
data set, for example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emptydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  doseGrid <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>R</code>-package <code>crmPack</code> uses the S4 class
system for implementation of the dose-escalation designs. There is the
convention that class initialization functions have the same name as the
class, and all class names are capitalized. Note that in order to create
this <code>Data</code> object, we use the initialization function of the
same name, and give it as parameters the contents of the object to be
constructed. At least the <code>doseGrid</code> parameter, which
contains all possible dose levels to be potentially used in the trial,
must be specified in a call of the <code><a href="../reference/Data-class.html">Data()</a></code> initialization
function.</p>
<p>If you are in the middle of a trial and you would like to recommend
the next dose, then you have data from the previous patients for input
into the model. This data can also be captured in a <code>Data</code>
object. For example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Used default patient IDs!</span></span></code></pre>
<p>Most important are <code>x</code> (the doses) and <code>y</code> (the
DLTs, <code>0</code> for no DLT and <code>1</code> for DLT), and we are
using the same dose grid <code>doseGrid</code> as before. All
computations are using the dose grid specified in the <code>Data</code>
object. So for example, except for patient number 7, all patients were
free of DLTs.</p>
<p>Again, you can find out the details in the help page
<code>Data-class</code>. Note that you have received a warning here,
because you did not specify the patient IDs – however, automatic ones
just indexing the patients have been created for you:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">@</span><span class="va">ID</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 3 4 5 6 7 8</span></span></code></pre>
<p>You can get a visual summary of the data by applying
<code>plot</code> to the object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotdata-1.png" width="576"></p>
<blockquote>
<p>Note that for all <code>plot</code> calls in this vignette, you can
leave away the wrapping <code>print</code> function call if you are
working interactively with <code>R</code>. It is only because of the
<code>knitr</code> production of this vignette that the
<code>print</code> statement is needed.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="structure-of-the-model-class">Structure of the model class<a class="anchor" aria-label="anchor" href="#structure-of-the-model-class"></a>
</h2>
<p>Figure @ref(fig:model-classes) shows the structure of the model class
defined in this package. The <code>AllModels</code> class is the parent
class from which all model classes inherit. There are two sub-classes:
First, the <code>GeneralModel</code> class from which all models inherit
that are using <code>JAGS</code> to specify the model and the prior
distribution and will then be estimated by MCMC later on. Then, the
second subclass is the <code>ModelPseudo</code> class for which the
prior of the models are specified in terms of pseudo data and standard
maximum likelihood routines from R will be used for computational
purposes. All models included in this package will have a parent class
of either the <code>GeneralModel</code> or the <code>ModelPseudo</code>
classes. There are two further classes under <code>ModelPseudo</code>
which are the <code>ModelTox</code> class include all DLT (the
occurrence of a dose-limiting toxicity) class models, and class
<code>ModelEff</code> which includes all efficacy class models.</p>
<div class="figure">
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b9be09e63b405f0d5e85" style="width:576px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-b9be09e63b405f0d5e85">{"x":{"diagram":"digraph {\n\n\n\n\n  \"1\" [label = \"AllModels\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"GeneralModel\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"Model\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"LogisiticNormal\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"LogisticLogNormalSub\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"LogisiticKadane\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"ModelPseudo\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"8\" [label = \"ModelEff\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"9\" [label = \"Effloglog\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"10\" [label = \"EffFlexi\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"11\" [label = \"ModelTox\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"12\" [label = \"LogisticIndepBeta\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"7\" \n  \"2\"->\"3\" \n  \"7\"->\"8\" \n  \"7\"->\"11\" \n  \"3\"->\"4\" \n  \"3\"->\"5\" \n  \"3\"->\"6\" \n  \"8\"->\"9\" \n  \"8\"->\"10\" \n  \"11\"->\"12\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
Model classes structure
</p>
</div>
</div>
<div class="section level2">
<h2 id="model-setup">Model setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h2>
<div class="section level3">
<h3 id="logistic-model-with-bivariate-log-normal-prior">Logistic model with bivariate (log) normal prior<a class="anchor" aria-label="anchor" href="#logistic-model-with-bivariate-log-normal-prior"></a>
</h3>
<p>First, we will show an example of setting up of a model inheriting
from the <code>model</code> and <code>GeneralModel</code> classes, the
logistic normal model. You can click on the corresponding help page
<code>LogisticLogNormal-class</code> as background information for the
next steps.</p>
<p>With the following command, we create a new model of class
<code>LogisticLogNormal</code>, with certain mean and covariance prior
parameters and reference dose:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/LogisticLogNormal-class.html">LogisticLogNormal</a></span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  cov <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span>,</span>
<span>  ref_dose <span class="op">=</span> <span class="fl">56</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can query the class that an object belongs to with the
<code>class</code> function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "LogisticLogNormal"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "crmPack"</span></span></code></pre>
<p>We can look in detail at the structure of <code>model</code> as
follows:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'LogisticLogNormal' [package "crmPack"] with 9 slots</span></span>
<span><span class="co">##   ..@ params         :Formal class 'ModelParamsNormal' [package "crmPack"] with 3 slots</span></span>
<span><span class="co">##   .. .. ..@ mean: num [1:2] -0.85 1</span></span>
<span><span class="co">##   .. .. ..@ cov : num [1:2, 1:2] 1 -0.5 -0.5 1</span></span>
<span><span class="co">##   .. .. ..@ prec: num [1:2, 1:2] 1.333 0.667 0.667 1.333</span></span>
<span><span class="co">##   ..@ ref_dose       :Formal class 'positive_number' [package "crmPack"] with 1 slot</span></span>
<span><span class="co">##   .. .. ..@ .Data: num 56</span></span>
<span><span class="co">##   ..@ datamodel      :function ()  </span></span>
<span><span class="co">##   ..@ priormodel     :function ()  </span></span>
<span><span class="co">##   ..@ modelspecs     :function (from_prior)  </span></span>
<span><span class="co">##   ..@ init           :function ()  </span></span>
<span><span class="co">##   ..@ datanames      : chr [1:3] "nObs" "y" "x"</span></span>
<span><span class="co">##   ..@ datanames_prior: chr(0) </span></span>
<span><span class="co">##   ..@ sample         : chr [1:2] "alpha0" "alpha1"</span></span></code></pre>
<p>We see that the object has 9 slots, and their names. These can be
accessed with the <code>@</code> operator (similarly as for lists the
<code>$</code> operator), for example we can extract the
<code>ref_dose</code> slot:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">@</span><span class="va">ref_dose</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "positive_number"</span></span>
<span><span class="co">## [1] 56</span></span></code></pre>
<p>You can find out yourself about the other slots, by looking at the
help page for <code>Model-class</code> in the help browser, because all
univariate models with JAGS specification are just special cases
(subclasses) of the <code>model</code> class. In the
<code>Model-class</code> help page, you also find out that there are
four additional specific model classes that are sub-classes of the
<code>model</code> class, namely <code>LogisticLogNormalSub</code>,
<code>LogisticNormal</code>, <code>LogisticKadane</code> and
<code>DualEndpoint</code>.</p>
<p>Next, we will show an example of setting up a model of the
<code>ModelPseudo</code> class, the <code>LogisticIndepBeta</code>
model. More specifically, this is also a model in <code>ModelTox</code>
class.</p>
<p>The <code>LogisticIndepBeta</code> model is a two-parameter logistic
regression model to describe the relationship between the probability of
the occurrence of DLT and its corresponding log dose levels. The model
parameters are φ<sub>1</sub>, for the intercept and φ <sub>2</sub>, the
slope. This is also a model for which its prior is expressed in form of
pseudo data.</p>
<p>Here it is important that the data set has to be defined before
defining any models from <code>ModelPseudo</code> class. This is to
ensure we obtained the updated estimates for the model parameters using
all currently available observations. Either an empty data set or a data
set that contains all currently available observations is needed.</p>
<p>Therefore, let’s assume an empty data set is set up. For example, we
will use 12 dose levels from 25 to 300 mg with increments of 25 mg. Then
we have:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emptydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  doseGrid <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">25</span>, to <span class="op">=</span> <span class="fl">300</span>, by <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="va">emptydata</span></span></code></pre></div>
<p>Then we express our prior in form of pseudo data. The idea is as
follows. First fix two dose level <span class="math inline">\(d_{(-1)}\)</span> and <span class="math inline">\(d_{(0)}\)</span>, which are usually the lowest and
the highest dose level, so here we choose 25 and 300 mg. Then we elicit
from experts or clinicians the probability of the occurrence of DLT,
<span class="math inline">\(p_{(-1)}\)</span> and <span class="math inline">\(p_{(0)}\)</span> at these two dose levels. That
is, assuming <span class="math inline">\(n_{(l)}\)</span> subjects are
treated at each of these two dose levels, <span class="math inline">\(l=-1,0\)</span>, <span class="math inline">\(t_{(l)}\)</span> out of <span class="math inline">\(n{(l)}\)</span> subjects are expected to be
observed with a DLT such that <span class="math inline">\(p_{(l)} =
t_{(l)}/n_{(l)}\)</span>. Let <span class="math inline">\(\tilde{p}_{(l)}\)</span> be the probability of the
occurrence of a DLT at dose <span class="math inline">\(l\)</span> for
dose <span class="math inline">\(l=-1,0\)</span>. <span class="math inline">\(\tilde{p}_{(l)}\)</span> will follow independent
Beta distributions and the joint probability density function of <span class="math inline">\(p_{(l)}\)</span> can be obtained. Therefore, this
model is called <code>LogisticIndepBeta</code>. We expressed the prior
as if we have some data (pseudo data) before the trial start. The prior
modal estimates of φ<sub>1</sub> and φ<sub>2</sub>, which is also
equivalent to the maximum likelihood estimators, can be obtained with
the R function <code>glm</code>. Please refer to <span class="citation">(Whitehead and Williamson 1998)</span> for details
about the form of the prior and posterior density of the model
parameters φ<sub>1</sub> and φ<sub>2</sub>.</p>
<p>With the following commands, we create the model of class
<code>LogisticIndepBeta</code>, with the prior specified in form of
pseudo data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/LogisticIndepBeta-class.html">LogisticIndepBeta</a></span><span class="op">(</span></span>
<span>  binDLE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>, <span class="fl">1.8</span><span class="op">)</span>, DLEweights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  DLEdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">300</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>(Note that in some functions including this initialization function,
DLE instead of DLT is used. In this vignette we use the unified
abbreviation DLT throughout the text and variable names.)</p>
<p>For the model specified, we have fixed two dose levels (25 and 300
mg) and represented them in the <code>DLEdose</code> slot. Then we
assume that 3 subjects are treated at each of the dose levels,
represented in the <code>DLEweights</code> slot. We have 1.05 subjects
out of the 3 subjects treated at 25 mg observed with a DLT and 1.8
subjects out of the 3 subjects treated at 300 mg observed with a DLT and
this is represented in the <code>binDLE</code> slot. Input to the
<code>Data</code> slot is also need to ensure the all currently
available observations will be incorporated in the model to obtain
updated modal estimates of the model parameters. If an empty data set is
used in the <code>Data</code> slot, the prior modal estimates of the
model parameters, φ<sub>1</sub> for the intercept and φ<sub>2</sub> for
the slope, can be obtained. If a data set with observations, e.g data1
in the DLTmodel above is used, we can obtain the posterior modal
estimates for the model parameters. In addition, the pseudo data can be
expressed by using more than 2 dose levels. On the other hand, at least
two dose levels of pseudo information are needed to obtain modal
estimates of the intercept and the slope parameter. Therefore,
<code>binDLE</code>,<code>DLEweights</code>, <code>DLEdose</code> must
be vectors of at least length 2 and with their corresponding values
specified at the same position in the other two vectors.</p>
<p>Since the imaginary nature of the pseudo data, the value <span class="math inline">\(t_l\)</span> for the number of subjects observed
with DLT can be non-integer values. In principle, <span class="math inline">\(n_l\)</span> can also be non-integer values.</p>
<p>Then we can look at the structure of this model:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">DLTmodel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'LogisticIndepBeta' [package "crmPack"] with 7 slots</span></span>
<span><span class="co">##   ..@ binDLE    : num [1:2] 1.05 1.8</span></span>
<span><span class="co">##   ..@ DLEdose   : num [1:2] 25 300</span></span>
<span><span class="co">##   ..@ DLEweights: int [1:2] 3 3</span></span>
<span><span class="co">##   ..@ phi1      : num -1.95</span></span>
<span><span class="co">##   ..@ phi2      : num 0.412</span></span>
<span><span class="co">##   ..@ Pcov      : num [1:2, 1:2] 10.05 -2.077 -2.077 0.462</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(x)"</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(x)"</span></span>
<span><span class="co">##   ..@ data      :Formal class 'Data' [package "crmPack"] with 9 slots</span></span>
<span><span class="co">##   .. .. ..@ x       : num(0) </span></span>
<span><span class="co">##   .. .. ..@ y       : int(0) </span></span>
<span><span class="co">##   .. .. ..@ doseGrid: num [1:12] 25 50 75 100 125 150 175 200 225 250 ...</span></span>
<span><span class="co">##   .. .. ..@ nGrid   : int 12</span></span>
<span><span class="co">##   .. .. ..@ xLevel  : int(0) </span></span>
<span><span class="co">##   .. .. ..@ placebo : logi FALSE</span></span>
<span><span class="co">##   .. .. ..@ ID      : int(0) </span></span>
<span><span class="co">##   .. .. ..@ cohort  : int(0) </span></span>
<span><span class="co">##   .. .. ..@ nObs    : int 0</span></span></code></pre>
<p>There are in total 10 slots and their names are given. Remember that
they can be accessed with the <code>@</code> operator (similarly as for
lists the <code>$</code> operator), for example we can extract the
<code>phi1</code> slot:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTmodel</span><span class="op">@</span><span class="va">phi1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -1.946152</span></span></code></pre>
<p>This gives the updated modal estimate of the intercept parameter
φ<sub>1</sub>. Please find out other slots using the <code>@</code>
operator and looking at the help page for <code>ModelPseudo</code>,
<code>ModelTox</code> and <code>LogisticIndepBeta</code> classes.</p>
</div>
<div class="section level3">
<h3 id="advanced-model-specification">Advanced model specification<a class="anchor" aria-label="anchor" href="#advanced-model-specification"></a>
</h3>
<p>There are a few further, advanced ways to specify a model object in
<code>crmPack</code>.</p>
<p>First, a minimal informative prior <span class="citation">(Neuenschwander, Branson, and Gsponer 2008)</span> can
be computed using the <code>MinimalInformative</code> function. The
construction is based on the input of a minimal and a maximal dose,
where certain ranges of DLT probabilities are deemed unlikely. A
logistic function is then fitted through the corresponding points on the
dose-toxicity plane in order to derive Beta distributions also for doses
in-between. Finally these Beta distributions are approximated by a
common <code>LogisticNormal</code> (or <code>LogisticLogNormal</code>)
model. So the minimal informative construction avoids explicit
specification of the prior parameters of the logistic regression
model.</p>
<p>In our example, we could construct it as follows, assuming a minimal
dose of 0.1 mg and a maximum dose of 100 mg:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coarseGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">minInfModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MinimalInformative.html">MinimalInformative</a></span><span class="op">(</span></span>
<span>  dosegrid <span class="op">=</span> <span class="va">coarseGrid</span>,</span>
<span>  refDose <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  threshmin <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  threshmax <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  control <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      threshold.stop <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>      maxit <span class="op">=</span> <span class="fl">200</span></span>
<span>    <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">432</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## It: 1, obj value: 0.4445658384</span></span>
<span><span class="co">## It: 4, obj value: 0.3926736165</span></span>
<span><span class="co">## It: 23, obj value: 0.120574847</span></span></code></pre>
<p>We use a few grid points between the minimum and the maximum to guide
the approximation routine, which is based on a stochastic optimization
method (the <code>control</code> argument is for this optimization
routine, please see the help page for
<code>Quantiles2LogisticNormal</code> for details). Therefore we need to
set a random number generator seed beforehand to be able to reproduce
the results in the future. Please note that currently the
reproducibility is under testing– it is currently advised to save the
approximation result in order to certainly be able to use the same model
later on again. The <code>threshmin</code> and <code>threshmax</code>
values specify the probability thresholds above and below, respectively,
it is very unlikely (only 5% probability) to have the true probability
of DLT at the minimum and maximum dose, respectively.</p>
<p>The result <code>minInfModel</code> is a list, and we can use its
contents to illustrate the creation of the prior:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">coarseGrid</span>,</span>
<span>  y <span class="op">=</span> <span class="va">minInfModel</span><span class="op">$</span><span class="va">required</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"prior probability of DLT"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matlines</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">coarseGrid</span>,</span>
<span>  y <span class="op">=</span> <span class="va">minInfModel</span><span class="op">$</span><span class="va">quantiles</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"right"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quantiles"</span>, <span class="st">"approximation"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>  lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/min-inf-res-1.png" width="576"></p>
<p>In this plot we see in blue the quantiles (2.5%, 50%, and 97.5%) of
the Beta distributions that we approximate with the red quantiles of the
logistic normal model. We see that the distance is still quite large,
and the maximum distance between any red and blue point is:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minInfModel</span><span class="op">$</span><span class="va">distance</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.1205748</span></span></code></pre>
<p>Therefore usually we would let the computations take longer (by
removing the <code>control</code> option from the
<code>MinimalInformative</code> call) to obtain a better approximation.
The final approximating model, which has produced the red points, is
contained in the <code>model</code> list element:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">minInfModel</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'LogisticNormal' [package "crmPack"] with 9 slots</span></span>
<span><span class="co">##   ..@ params         :Formal class 'ModelParamsNormal' [package "crmPack"] with 3 slots</span></span>
<span><span class="co">##   .. .. ..@ mean: Named num [1:2] 1.15 1.18</span></span>
<span><span class="co">##   .. .. .. ..- attr(*, "names")= chr [1:2] "meanAlpha.(Intercept)" "meanBeta.I(log(dosegrid/refDose))"</span></span>
<span><span class="co">##   .. .. ..@ cov : num [1:2, 1:2] 3.895 0.269 0.269 0.142</span></span>
<span><span class="co">##   .. .. ..@ prec: num [1:2, 1:2] 0.295 -0.561 -0.561 8.13</span></span>
<span><span class="co">##   ..@ ref_dose       :Formal class 'positive_number' [package "crmPack"] with 1 slot</span></span>
<span><span class="co">##   .. .. ..@ .Data: num 50</span></span>
<span><span class="co">##   ..@ datamodel      :function ()  </span></span>
<span><span class="co">##   ..@ priormodel     :function ()  </span></span>
<span><span class="co">##   ..@ modelspecs     :function (from_prior)  </span></span>
<span><span class="co">##   ..@ init           :function ()  </span></span>
<span><span class="co">##   ..@ datanames      : chr [1:3] "nObs" "y" "x"</span></span>
<span><span class="co">##   ..@ datanames_prior: chr(0) </span></span>
<span><span class="co">##   ..@ sample         : chr [1:2] "alpha0" "alpha1"</span></span></code></pre>
<p>Here we see in the slots <code>mean</code>, <code>cov</code> the
parameters that have been determined. At this point a slight warning:
you cannot directly change these parameters in the slots of the existing
model object, because the parameters have also been saved invisibly in
other places in the model object. Therefore, always use the class
initialization function to create a new model object, if new parameters
are required. But if we want to further use the approximation model, we
can save it under a shorter name, e.g.:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myModel</span> <span class="op">&lt;-</span> <span class="va">minInfModel</span><span class="op">$</span><span class="va">model</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="obtaining-the-posterior">Obtaining the posterior<a class="anchor" aria-label="anchor" href="#obtaining-the-posterior"></a>
</h2>
<p>As said before, models inheriting from the <code>GeneralModel</code>
class rely on MCMC sampling for obtaining the posterior distribution of
the model parameters, given the data. Most of the models, except the
<code>EffFlexi</code> class model (please refer to <a href="#dual-endpoint-dose-escalation-designs">Dual-endpoint dose
escalation designs</a> for details), inheriting from the
<code>ModelPseudo</code> class do not necessarily require MCMC sampling
to obtain posterior estimates. When no MCMC sampling is involved, the
prior or posterior modal estimates of model estimates are used. But we
can still obtain the full posterior distribution of the model parameters
via MCMC for any models specified under <code>ModelPseudo</code> class.
The MCMC sampling can be controlled with an object of class
<code>mcmcOptions</code>, created for example as follows:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span></span>
<span>  burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">2000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now the object <code>options</code> specifies that you would like to
have <code>2000</code> parameter samples obtained from a Markov chain
that starts with a <code>burn-in</code> phase of <code>100</code>
iterations that are discarded, and then save a sample every
<code>2</code> iterations. Note that these numbers are too low for
actual production use and are only used for illustrating purposes here;
normally you would specify at least the default parameters of the
initialization function <code>mcmcOptions</code>: <code>10000</code>
burn-in iterations and <code>10000</code> samples saved every
2<sup>nd</sup> iteration. You can look these up in help browser under
the link <code>McmcOptions</code>.</p>
<p>After having set up the options, you can proceed to MCMC sampling by
calling the <code>mcmc</code> function:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">94</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<p>The <code>mcmc</code> function takes the data object, the model and
the MCMC options. By default, JAGS is used for obtaining the samples.
Use the option <code>verbose = TRUE</code> to show a progress bar and
detailed JAGS messages.</p>
<p>Finally, it is good practice to check graphically that the Markov
chain has really converged to the posterior distribution. To this end,
<code>crmPack</code> provides an interface to the convenient
<code>R</code>-package <code>ggmcmc</code>. With the function
<code>get</code> you can extract the individual parameters from the
object of class <code>Samples</code>.</p>
<p>For example, we extract the <span class="math inline">\(\alpha_{0}\)</span> samples: (please have a look
at the help page for the <code>LogisticLogNormal</code> model class for
the interpretation of the parameters)</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## look at the structure of the samples object:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'Samples' [package "crmPack"] with 2 slots</span></span>
<span><span class="co">##   ..@ data   :List of 2</span></span>
<span><span class="co">##   .. ..$ alpha0: num [1:2000] -0.675 0.254 -1.02 -1.02 -0.262 ...</span></span>
<span><span class="co">##   .. ..$ alpha1: num [1:2000] 1.129 0.683 0.729 0.729 1.426 ...</span></span>
<span><span class="co">##   ..@ options:Formal class 'McmcOptions' [package "crmPack"] with 5 slots</span></span>
<span><span class="co">##   .. .. ..@ iterations: int 4100</span></span>
<span><span class="co">##   .. .. ..@ burnin    : int 100</span></span>
<span><span class="co">##   .. .. ..@ step      : int 2</span></span>
<span><span class="co">##   .. .. ..@ rng_kind  : chr NA</span></span>
<span><span class="co">##   .. .. ..@ rng_seed  : int NA</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## now extract the alpha0 samples (intercept of the regression model)</span></span>
<span><span class="va">alpha0samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">samples</span>, <span class="st">"alpha0"</span><span class="op">)</span></span></code></pre></div>
<p><code>alpha0samples</code> now contains the <span class="math inline">\(\alpha_{0}\)</span> samples in a format understood
by <code>ggmcmc</code> and we can produce plots with it, e.g. a trace
plot and an autocorrelation plot:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://xavier-fim.net/packages/ggmcmc/" class="external-link">ggmcmc</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: dplyr</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: tidyr</span></span></code></pre>
<pre><code><span><span class="co">## Registered S3 method overwritten by 'GGally':</span></span>
<span><span class="co">##   method from   </span></span>
<span><span class="co">##   +.gg   ggplot2</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html" class="external-link">ggs_traceplot</a></span><span class="op">(</span><span class="va">alpha0samples</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/ggmcmc-1.png" width="576"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_autocorrelation.html" class="external-link">ggs_autocorrelation</a></span><span class="op">(</span><span class="va">alpha0samples</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/ggmcmc2-1.png" width="576"></p>
<p>So here we see that we have some autocorrelation in the samples, and
might consider using a higher thinning parameter in order to decrease
it.</p>
<p>You can find other useful plotting functions in the package
information:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"ggmcmc"</span>, help_type <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, using models from <code>ModelPseudo</code> class, we can
also obtain the prior and posterior samples of the model parameters via
MCMC.</p>
<p>For example, using the DLTmodel, <code>data1</code>, the empty data
set and options specified in earlier examples.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data1</span>, model <span class="op">=</span> <span class="va">DLTmodel</span>, options <span class="op">=</span> <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<p>The prior samples of the model parameters are now saved in the
variable <code>DLTsamples</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">225</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">25</span>, to <span class="op">=</span> <span class="fl">300</span>, by <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">DLTpostsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data3</span>, model <span class="op">=</span> <span class="va">DLTmodel</span>, options <span class="op">=</span> <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, <code>DLTpostsamples</code> now contains the posterior
samples of the model parameters. %Since an output message as seen from
the above example will be display after each MCMC sampling when some
observed data are involved, the <code>suppressMessages</code> function
is used from now and throughout this document to avoid showing all of
these message in this document</p>
<p>This <code>mcmc</code> function also takes the data object, model and
the MCMC options. This is not using JAGS but just R for the
computations.</p>
<p>Under this <code>DLTmodel</code>, we will obtain samples of
φ<sub>1</sub> and φ<sub>2</sub>. Using what has been described earlier
in this section , we can also look at the structure using function
<code>str</code>, extracting model parameters samples with
<code>get</code> and produce plots with <code>ggs_traceplot</code> and
<code>ggs_autocorrelation</code> for each of the model parameters.</p>
<p>When no MCMC sampling is involved, the posterior modal estimates of
the model parameters can be obtained for models (except the
<code>EffFlexi</code> class object) inheriting from the
<code>ModelPseudo</code> class object. First you need to put together
all currently available observations in form of a <code>Data</code>
object (when only DLT responses are modelled) or texttt{DataDual} object
(when both DLT and efficacy responses are modelled) class object. Then
using the <code>update</code> function to update your model, the
posterior modal estimates of the model parameters will be display in the
output of the model.</p>
<p>For example, we have some new observations specified in the data set
<code>data3</code> and update the DLT model:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newDLTmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">DLTmodel</span>, data <span class="op">=</span> <span class="va">data3</span><span class="op">)</span></span>
<span><span class="va">newDLTmodel</span><span class="op">@</span><span class="va">phi1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -5.070681</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newDLTmodel</span><span class="op">@</span><span class="va">phi2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.125107</span></span></code></pre>
<p>In the example, the <code>update</code> function is used to obtain
the posterior modal estimates of the model parameters, φ<sub>1</sub> and
φ<sub>2</sub>, which can then be extracted using the operator on the
updated result <code>newDLTmodel</code>.</p>
</div>
<div class="section level2">
<h2 id="plotting-the-model-fit">Plotting the model fit<a class="anchor" aria-label="anchor" href="#plotting-the-model-fit"></a>
</h2>
<p>After having obtained the parameter samples, we can plot the model
fit, by supplying the samples, model and data to the generic plot
function:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plot-model-fit-1.png" width="576"></p>
<p>This plot shows the posterior mean curve and 95% equi-tailed credible
intervals at each point of the dose grid from the <code>Data</code>
object.</p>
<p>Note that you can also produce a plot of the prior mean curve and
credible intervals, i.e. from the model without any data. This works in
principle the same way as with data, just that we use an empty data
object:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## provide only the dose grid:</span></span>
<span><span class="va">emptydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span>doseGrid <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span></span>
<span><span class="co">## obtain prior samples with this Data object</span></span>
<span><span class="va">priorsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">emptydata</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span>
<span><span class="co">## then produce the plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">priorsamples</span>, <span class="va">model</span>, <span class="va">emptydata</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/empty-data-1.png" width="576"></p>
<p>This <code>plot</code> function can also apply to the
<code>DLTmodel</code> when samples of the parameters have been
generated:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DLTsamples</span>, <span class="va">DLTmodel</span>, <span class="va">data1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plot-samplesdata1%20-1.png" width="576"></p>
<p>In addition, we can also plot the fitted dose-response curve using
the prior or the posterior modal estimates of the model parameters when
no MCMC sampling is used. For example, we have the <code>DLTmodel</code>
specified earlier under the <code>ModelTox</code> class with the data
set <code>data1</code> we specified earlier:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data1</span>, <span class="va">DLTmodel</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/emptydatanoDLTsamples-1.png" width="576"></p>
<p>Since no samples are involved, only the curve using the prior or
posterior modal estimates of the parameters are produced, without 95%
credibility intervals.</p>
</div>
<div class="section level2">
<h2 id="escalation-rules">Escalation Rules<a class="anchor" aria-label="anchor" href="#escalation-rules"></a>
</h2>
<p>For the dose escalation, there are four kinds of rules:</p>
<ul>
<li>
<code>Increments</code>: For specifying maximum allowable increments
between doses</li>
<li>
<code>NextBest</code>: How to derive the next best dose</li>
<li>
<code>CohortSize</code>: For specifying the cohort size</li>
<li>
<code>Stopping</code>: Stopping rules for finishing the dose
escalation</li>
</ul>
<p>We have listed here the classes of these rules, and there are
multiple subclasses for each of them, which you can find as links in the
help pages <code>Increments-class</code>, <code>NextBest-class</code>,
<code>CohortSize-class</code> and <code>Stopping-class</code>.</p>
<div class="section level3">
<h3 id="increments-rules">Increments rules<a class="anchor" aria-label="anchor" href="#increments-rules"></a>
</h3>
<p>Figure @ref(fig:increments) shows the structure of the
<code>Increments</code> classes:</p>
<div class="figure">
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8a4236d6c2c4dee2b427" style="width:576px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-8a4236d6c2c4dee2b427">{"x":{"diagram":"digraph {\n\n\n\n\n  \"1\" [label = \"Increments\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"IncrementsRelative\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"IncrementsRelativeParts\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"IncrementsRelativeDLT\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"4\" \n  \"2\"->\"3\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
Increments classes structure
</p>
</div>
<p>The <code>Increments</code> class is the basis for all maximum
increments rule classes within this package. There are three subclasses,
the <code>IncrementsRelative</code>, the
<code>IncrementsRelativeParts</code> and the
<code>IncrementsRelativeDLTs</code> classes. Let us start with looking
in detail at the increments rules. Currently two specific rules are
implemented: Maximum relative increments based on the current dose
(<code>IncrementsRelative</code> and
<code>IncrementsRelativeParts</code>, which only works with
<code>DataParts</code> objects), and maximum relative increments based
on the current cumulative number of DLTs that have happened
(<code>IncrementsRelativeDLT</code>).</p>
<p>For example, in order to specify a maximum increase of 100% for doses
up to 20 mg, and a maximum of 33% for doses above 20 mg, we can setup
the following increments rule:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myIncrements</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span></span>
<span>  intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  increments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.33</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here the <code>intervals</code> slot specifies the left bounds of the
intervals, in which the maximum relative <code>Increments</code> (note:
decimal values here, no percentages!) are valid.</p>
<p>The increments rule is used by the <code>maxDose</code> function to
obtain the maximum allowable dose given the current data:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">myIncrements</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 20</span></span></code></pre>
<p>So in this case, the next dose could not be larger than 20 mg.</p>
<p>In the following example the dose escalation will be restricted to a
3-fold (= 200%) increase:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myIncrements1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IncrementsRelative-class.html">IncrementsRelative</a></span><span class="op">(</span></span>
<span>  intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>,</span>
<span>  increments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>From all doses (since the dose grid starts at 25 mg) there is a
maximum increase of 200% here.</p>
<p>The <code>IncrementsRelativeDLT</code> class works similarly, taking
the number of DLTs in the whole trial so far as the basis for the
maximum increments instead of the last dose.</p>
</div>
<div class="section level3">
<h3 id="rules-for-next-best-dose-recommendation">Rules for next best dose recommendation<a class="anchor" aria-label="anchor" href="#rules-for-next-best-dose-recommendation"></a>
</h3>
<p>Figure @ref(fig:rules) show the structure of the next best dose
recommendation rules currently implemented in <code>crmPack</code>.</p>
<div class="figure">
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-df5a348aed969e1ecca2" style="width:576px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-df5a348aed969e1ecca2">{"x":{"diagram":"digraph {\n\n\n\n\n  \"1\" [label = \"NextBest\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"NextBestMTD\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"NextBestNCRM\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"NextBestThreePlusThree\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"NextBestDualEndpoint\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"NextBestTD\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"NextBestTDSamples\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"8\" [label = \"NextBestMaxGain\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"9\" [label = \"NextBestMaxGainSamples\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"1\"->\"4\" \n  \"1\"->\"5\" \n  \"1\"->\"6\" \n  \"1\"->\"7\" \n  \"1\"->\"8\" \n  \"1\"->\"9\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
Escalation classes structure
</p>
</div>
<p>All classes of escalation rules are contained in the
<code>nextBest</code> class. There are two main types of escalation
rules: either only the binary DLT responses are incorporated into the
escalation process, or a binary DLT and a continuous efficacy/biomarker
response are jointly incorporated into the escalation process.</p>
<p>There are two implemented rules for toxicity endpoint CRMs inheriting
from the <code>GeneralModel</code> class: <code>NextBestMTD</code> that
uses the posterior distribution of the MTD estimate (given a target
toxicity probability defining the MTD), and <code>nextBestCRM</code>
that implements the N-CRM, using posterior probabilities of
target-dosing and overdosing at the dose grid points to recommend a next
best dose.</p>
<p>For example, in order to use the N-CRM with a target toxicity
interval from 20% to 35%, and a maximum overdosing probability of 25%,
we specify:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestNCRM-class.html">NextBestNCRM</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span>
<span>  overdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  max_overdose_prob <span class="op">=</span> <span class="fl">0.25</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we could use an MTD driven recommendation rule. For
example, with a target toxicity rate of 33%, and recommending the 25%
posterior quantile of the MTD, we specify</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtdNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestMTD-class.html">NextBestMTD</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="fl">0.33</span>,</span>
<span>  derive <span class="op">=</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">mtd_samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mtd_samples</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that the <code>NextBestMTD</code> class is quite flexible,
because you can specify a function <code>derive</code> that derives the
next best dose from the posterior MTD samples.</p>
<p>There are also two further next best dose recommendation rules when
the model is inheriting from the <code>ModelTox</code> class. One rule
is specified when no samples for the model parameters are involved and
the other one is when samples of the model parameters are generated and
are incorporated into the dose-escalation procedure.</p>
<p>The details about these rules are as follows. First, two
probabilities of the occurrence of a DLT have to be fixed. The first one
is called <code>targetDuringTrial</code> which is the target probability
of the occurrence of a DLT to be used during the trial. The second
probability is called <code>targetEndOfTrial</code> is the target
probability of the occurrence of a DLT to be used at the end of a trial.
The above two targets always have to be specified. For cases when
samples are involved, an additional argument has to be used, which is a
function to advise what we should recommend using the samples that we
have. This will be elaborated in details in the example below.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TDNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestTD-class.html">NextBestTD</a></span><span class="op">(</span></span>
<span>  prob_target_drt <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  prob_target_eot <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this example, we fixed the target probability of the occurrence of
a DLT to be used during the trial be 0.35. This means we will allow
subjects to dose levels with probability of DLT closest and less than or
equal 0.35 during the trial. At the end of the trial, we will therefore
recommend a dose level which is closest and with probability of DLT less
than or equal to 0.3. This <code>NextBestTD</code> rule class can be
only used when no samples are involved in the escalation procedure. Next
we will show an example of the <code>NextBestTDsamples</code> rule class
when samples are involved in the escalation process.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TDsamplesNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestTDsamples-class.html">NextBestTDsamples</a></span><span class="op">(</span></span>
<span>  prob_target_drt <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  prob_target_eot <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  derive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">samples</span>, probs <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The slot for <code>targetDuringTrial</code> and
<code>targetEndOfTrial</code> are specified in the same way as in the
last example given the value of 0.35 and 0.3, respectively. The
<code>derive</code> slot should always be specified with a function. In
this example, using the function specified in the <code>derive</code>
slot says that we will recommend the 30% posterior quantiles of the
samples to be the estimates for the doses corresponding to the
<code>targetDuringTrial</code> and <code>targetEndOfTrial</code>
doses.</p>
<p>During the study, in order to derive the next best dose, we supply
the generic <code>nextBest</code> function with the rule, the maximum
dose, the posterior samples, the model and the data:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">samples</span>, model <span class="op">=</span> <span class="va">model</span>, data <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result is a list with two elements: <code>value</code> contains
the numeric value of the recommended next best dose, and
<code>plot</code> contains a plot that illustrates how the next best
dose was computed. In this case we used the N-CRM rule, therefore the
plot gives the target-dosing and overdosing probabilities together with
the safety bar of 25%, the maximum dose and the final recommendation
(the red triangle):</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 20</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/next-best-results-1.png" width="576"></p>
<p>Similarly, we can use the the generic <code>nextBest</code> function
for the<code>NextBestTD</code> and <code>NextBestTDsamples</code> rules.
In the example below we will use the data set <code>data3</code> with
DLT observations. We can compute the next best dose to be given to the
next cohort using the posterior modal estimates of the DLT model (i.e.,
no MCMC sampling involved here):</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecDLT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">TDNextBest</span>, doselimit <span class="op">=</span> <span class="fl">300</span>, model <span class="op">=</span> <span class="va">newDLTmodel</span>, data <span class="op">=</span> <span class="va">data3</span><span class="op">)</span></span></code></pre></div>
<p>A list of numerical values and a plot showing how the next best dose
was computed will be given. This list of results will provide the
numerical values for the next dose level, <code>next_dose_drt</code>;
the target probability of DLT used during the trial,
<code>prob_target_drt</code>; the estimated dose level for which its
probability of DLT equals the target probability used during the trial,
<code>dose_target_drt</code>; the target probability of DLT used at the
end of a trial, <code>prob_target_eot</code>; the estimated dose level
for which its probability of DLT equals the target probability of DLT
used at the end of a trial <code>dose_target_eot</code>; and the dose
level at dose grid closest and less than the
<code>dose_target_eot</code>, <code>next_dose_eot</code>. We can use the
<code>$</code> operator to obtain these values and the plot from the
list. For example,</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecDLT</span><span class="op">$</span><span class="va">next_dose_drt</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 50</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecDLT</span><span class="op">$</span><span class="va">prob_target_drt</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.35</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecDLT</span><span class="op">$</span><span class="va">dose_target_drt</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 52.28128</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">doseRecDLT</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/next-bestTD-results-1.png" width="576"></p>
<p>We can see that the next dose suggested to be given to the next
cohort of subjects is 50 mg. The target probability of DLT during the
trial is 0.35 and the TD35 (the tolerated dose with probability of DLT
equal to 0.35) is estimated to be 52.28 mg. As we are using 12 dose
levels or dose grids from 25 mg to 300 mg with increments of 25 mg for
this data set, <code>data3</code>, we can see that what is suggested for
the next dose 50 mg is also the dose level closest below 52.28 mg, the
estimated <code>dose_target_drt</code>. Similarly, at the end of a trial
we could also obtain all “End Of Trial” estimates by using the
<code>$</code> operator. In addition, we also have a plot to show next
dose allocation. The red curve shows the estimated DLT curve obtained
using the posterior modal estimates of the model parameters. We also
assumed the maximum allowable dose be 300 mg which was specified as the
<code>doselimit</code> parameter of the <code>nextBest</code> function
call and the red vertical line denoted with “Max” shows the maximum dose
level (at x-axis) that is allowed in this case. The vertical purple line
denoted with “Next” marks the dose level to be allocated to the next
cohort of subjects. In this example, the target probability of DLT used
during trial and at the end of a trial were 0.35 and 0.3, respectively.
The circle and the square on the DLT curve show where the probability of
DLT is estimated to be equal to 0.3 and 0.35, respectively. Hence, the
value of the estimated TD30 and TD35 can be checked at the x-axis
vertically below these symbols.</p>
<p>When MCMC sampling is involved, we will use the samples of model
parameters to choose the next best dose. For example, in the following
code chunk we use the data set, <code>data3</code>, with some DLT
observations and the posterior samples of the model parameters,
<code>DLTpostsamples</code> to compute the next best dose:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecDLTSamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">TDsamplesNextBest</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">DLTpostsamples</span>, model <span class="op">=</span> <span class="va">newDLTmodel</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The same list of results will be produced as in the example before:
The values of the <code>next_dose_drt</code>,
<code>prob_target_drt</code>, <code>dose_target_drt</code>,
<code>prob_target_eot</code>, <code>dose_target_eot</code> and
<code>next_dose_eot</code> can be obtained using the <code>$</code>
operator. The only difference is that the plot in this example will look
slightly different than in the previous example:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">doseRecDLTSamples</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/next-bestTDsamples-results-1.png" width="576">
&gt; This graph is incorrect</p>
<p>In the plot, vertical lines are given to show the value for the next
dose, the TD30 estimate, the TD35 estimate and the maximum allowable
dose level. Since samples of model parameters were utilized, the density
curves of the TD30 (pink) and the TD35 (grey) are plotted.</p>
</div>
<div class="section level3">
<h3 id="cohort-size-rules">Cohort size rules<a class="anchor" aria-label="anchor" href="#cohort-size-rules"></a>
</h3>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  pathString <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"CohortSize/CohortSizeRange"</span>,</span>
<span>    <span class="st">"CohortSize/CohortSizeDLT"</span>,</span>
<span>    <span class="st">"CohortSize/CohortSizeConst"</span>,</span>
<span>    <span class="st">"CohortSize/CohortSizeParts"</span>,</span>
<span>    <span class="st">"CohortSize/CohortSizeMax"</span>,</span>
<span>    <span class="st">"CohortSize/CohortSizeMin"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.tree/man/as.Node.html" class="external-link">as.Node</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.tree/man/ToDiagrammeRGraph.html" class="external-link">SetNodeStyle</a></span><span class="op">(</span><span class="va">tree</span>, shape <span class="op">=</span> <span class="st">"box"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1fec9c33034ceb85ed27" style="width:576px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-1fec9c33034ceb85ed27">{"x":{"diagram":"digraph {\n\n\n\n\n  \"1\" [label = \"CohortSize\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"CohortSizeRange\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"CohortSizeDLT\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"CohortSizeConst\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"CohortSizeParts\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"CohortSizeMax\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"CohortSizeMin\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"1\"->\"4\" \n  \"1\"->\"5\" \n  \"1\"->\"6\" \n  \"1\"->\"7\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
CohortSize classes structure
</p>
</div>
<p>% All classes related to cohort size in this package are contains
within <code>CohortSize</code> class.</p>
<p>Similarly to the increments rules, you can define intervals in the
dose space and/or the DLT space to define the size of the cohorts. For
example, let’s assume we want to have one patient only in the cohorts
until we reach 30 mg or the first DLT is encountered, and then proceed
with three patients per cohort.</p>
<p>We start by creating the two separate rules, first for the dose
range:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySize1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CohortSizeRange-class.html">CohortSizeRange</a></span><span class="op">(</span>intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span>, cohort_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then for the DLT range:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySize2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CohortSizeDLT-class.html">CohortSizeDLT</a></span><span class="op">(</span>intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, cohort_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally we combine the two rules by taking the maximum number of
patients of both rules:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySize</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxSize.html">maxSize</a></span><span class="op">(</span><span class="va">mySize1</span>, <span class="va">mySize2</span><span class="op">)</span></span></code></pre></div>
<p>The <code>CohortSize</code> rule is used by the size}` function,
together with the next dose and the current data, in order to determine
the size of the next cohort:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/size.html">size</a></span><span class="op">(</span><span class="va">mySize</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3</span></span></code></pre>
<p>Here, because we have one DLT already, we would go for 3 patients for
the next cohort.</p>
<p>Moreover, if you would like to have a constant cohort size, you can
use the following <code>CohortSizeConst</code> class, which we will use
(with three patients) for simplicity for the remainder of this
vignette:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySize</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CohortSizeConst-class.html">CohortSizeConst</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stopping-rules">Stopping rules<a class="anchor" aria-label="anchor" href="#stopping-rules"></a>
</h3>
<p>All of the stopping rules classes inherit directly from the
<code>Stopping</code> class. There are in total 9 stopping rules, listed
as follows:</p>
<ul>
<li><code>StoppingCohortNearDose</code></li>
<li><code>StoppingPatientsNearDose</code></li>
<li><code>StoppingMinCohorts</code></li>
<li><code>StoppingMinPatients</code></li>
<li><code>StoppingTargetProb</code></li>
<li><code>StoppingMTDdistribution</code></li>
<li><code>StoppingTargetBiomarker</code></li>
<li><code>StoppingTDCIRatio</code></li>
<li><code>StoppingMaxGainCIRatio</code></li>
</ul>
<p>From the names of these stopping rules, we can have an idea of what
criteria have been used for stopping decisions and we will explain
briefly here what are these criteria. For further details please refer
to examples presented later in this vignette or examples given in the
help pages. You can find a link to all implemented stopping rule parts
in the help page <code>Stopping-class</code>.</p>
<p>For example, <code>StoppingCohortNearDose</code> class objects can be
used to stop the dose escalation based on the numbers of cohorts treated
near to the next best dose (where the required proximity is given as the
percentage of relative deviation from the next best dose). Similarly,
for <code>StoppingPatientsNearDose</code>, stopping is based on the
number of patients treated near the next best dose.
<code>StoppingMinCohorts</code> and <code>StoppingMinPatients</code>
rules can be used to stop the dose escalation if a minimum overall
number of patients or cohorts have been enrolled. We have also other
stopping rules such that a trial will be stopped either based on the MTD
distribution (<code>StoppingMTDdistribution</code>), or reached a
pre-specified probability of the next dose being in the target toxicity
interval (<code>StoppingTargetProb</code>) or or target biomarker
interval (<code>StoppingTargetBiomarker</code>) or when the current
estimate of the quantity of interest is ‘accurate’ enough
(<code>StoppingTDCIRatio</code> and
<code>StoppingMaxGainCIRatio</code>)</p>
<p>Stopping rules are often quite complex, because they are built from
“and/or” combinations of multiple parts. Therefore the
<code>crmPack</code> implementation mirrors this, and multiple atomic
stopping rules can be combined easily. For example, let’s assume we
would like to stop the trial if there are at least 3 cohorts and at
least 50% probability in the target toxicity interval <span class="math inline">\((20%, 35%)\)</span>, or the maximum sample size of
20 patients has been reached.</p>
<p>Then we start by creating the three pieces the rule is composed
of:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStopping1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingMinCohorts-class.html">StoppingMinCohorts</a></span><span class="op">(</span>nCohorts <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">myStopping2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingTargetProb-class.html">StoppingTargetProb</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.35</span><span class="op">)</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span><span class="va">myStopping3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span>nPatients <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>Finally we combine these with the <code>and</code> operator
<code>&amp;</code> and the <code>or</code> operator <code>|</code>:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">myStopping1</span> <span class="op">&amp;</span> <span class="va">myStopping2</span><span class="op">)</span> <span class="op">|</span> <span class="va">myStopping3</span></span></code></pre></div>
<p>We can also stop the trial when the current estimate of the quantity
of interest, such as the TD30 given in earlier examples, is ‘accurate’
enough. The accuracy of the current estimate of TD30 is quantified by
the width of the associated 95% credibility interval. The wider the
interval, the less accurate the estimate is. In particular, the ratio of
the upper to the lower limit of this 95% credibility interval is used.
The smaller the ratio, the more accurate is the estimate.</p>
<p>For example, we will stop our trial if we obtain a ratio of less than
5 for the 95% credibility interval of the TD30 estimate in this case,
deciding that we have obtained an estimate which is ‘accurate’
enough.</p>
<p>The <code>StoppingTDCIRatio</code> function can be used in both cases
when no DLT samples or DLT samples are involved:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStopping4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingTDCIRatio-class.html">StoppingTDCIRatio</a></span><span class="op">(</span>target_ratio <span class="op">=</span> <span class="fl">5</span>, prob_target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>In the above two examples, the <code>targetRatio</code> and
<code>targetEndOfTrial</code> has to be specified.</p>
</blockquote>
<p>During the dose escalation study, any (atomic or combined) stopping
rule can be used by the function <code>stopTrial</code> to determine if
the rule has already been fulfilled. For example in our case:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping</span>, dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">samples</span>, model <span class="op">=</span> <span class="va">model</span>, data <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## attr(,"message")[[1]]</span></span>
<span><span class="co">## attr(,"message")[[1]][[1]]</span></span>
<span><span class="co">## [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"message")[[1]][[2]]</span></span>
<span><span class="co">## [1] "Probability for target toxicity is 36 % for dose 20 and thus below the required 50 %"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"message")[[2]]</span></span>
<span><span class="co">## [1] "Number of patients is 8 and thus below the prespecified minimum number 20"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"individual")</span></span>
<span><span class="co">## attr(,"individual")[[1]]</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## attr(,"message")[[1]]</span></span>
<span><span class="co">## [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"message")[[2]]</span></span>
<span><span class="co">## [1] "Probability for target toxicity is 36 % for dose 20 and thus below the required 50 %"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"individual")</span></span>
<span><span class="co">## attr(,"individual")[[1]]</span></span>
<span><span class="co">## [1] TRUE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"individual")[[2]]</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "Probability for target toxicity is 36 % for dose 20 and thus below the required 50 %"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"individual")[[2]]</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "Number of patients is 8 and thus below the prespecified minimum number 20"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<p>We receive here <code>FALSE</code>, which means that the stopping
rule criteria have not been met. The attribute <code>message</code>
contains the textual results of the atomic parts of the stopping rule.
Here we can read that the probability for target toxicity was just 30%
for the recommended dose 20 mg and therefore too low, and also the
maximum sample size has not been reached, therefore the trial shall
continue.</p>
<p>In the same way the stopping rule <code>myStopping4</code> (no
samples and with samples) can be evaluated:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping4</span>, dose <span class="op">=</span> <span class="va">doseRecDLTSamples</span><span class="op">$</span><span class="va">next_dose_drt</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">DLTpostsamples</span>, model <span class="op">=</span> <span class="va">newDLTmodel</span>, data <span class="op">=</span> <span class="va">data3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "95% CI is (0.000611274483578011, 10459.1345133637), Ratio = 17110373.1537 is greater than target_ratio = 5"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping4</span>, dose <span class="op">=</span> <span class="va">doseRecDLT</span><span class="op">$</span><span class="va">next_dose_drt</span>,</span>
<span>  model <span class="op">=</span> <span class="va">newDLTmodel</span>, data <span class="op">=</span> <span class="va">data3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "95% CI is ( 11.0662 , 164.618 ), Ratio = 14.8758 is  greater than target_ratio = 5"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<p>when DLT samples or no DLT samples are involved.</p>
<blockquote>
<p>Note that at the moment the <code>and</code> operator
<code>&amp;</code> and the <code>or</code> operator <code>|</code>
cannot be used together with <code>StoppingTDCIRatio</code> class
objects. This is still under development.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h2>
<p>In order to run simulations, we first have to build a specific
design, that comprises a model, the escalation rules, starting data, a
cohort size and a starting dose.</p>
The structure of the design classes in this package is shown in figure
@ref(fig:Design).
<div class="figure">
<div class="grViz html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-32a78892df6a108d5283" style="width:576px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-32a78892df6a108d5283">{"x":{"diagram":"digraph {\n\n\n\n\n  \"1\" [label = \"RuleDesign\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"Design\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"DualDesign\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"TDDesign\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"DualResponsesDesign\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"TDSamplesDesign\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"DualResponsesTDSamplesDesign\", shape = \"box\", fillcolor = \"#FFFFFF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"4\" \n  \"1\"->\"6\" \n  \"2\"->\"3\" \n  \"4\"->\"5\" \n  \"6\"->\"7\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
Design classes structure
</p>
</div>
<p>It might seem strange at first sight that we have to supply starting
data to the design, but we will show below that this makes sense. First,
we use our <code>emptydata</code> object that only contains the dose
grid, and a cohorts of 3 patients, starting from 0.1 mg:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Design-class.html">Design</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  nextBest <span class="op">=</span> <span class="va">myNextBest</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  data <span class="op">=</span> <span class="va">emptydata</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Another example will be given when the <code>TDDesign</code> class is
used. The empty data set, <code>data1</code> will be used, and the
starting dose will be 25 mg. The code below will be a design defined
when no MCMC sampling is involved. The <code>nextBest</code> slot under
this <code>TDDesign</code> class function has to be defined with the
<code>TDNextBest</code> class object to ensure we will pick the next
best dose using rules as defined when no MCMC sampling is involved. In
addition, we define here with <code>myStopping4</code> that the trial
will only stop when the ratio of the 95% credibility interval limits of
the current estimate of TD30 (<code>TDtargetEndOfTrial</code>) is less
than or equal to 5. In addition, we also use <code>myIncrements1</code>,
<code>mySize</code> and <code>data1</code> defined in earlier examples
for the <code>increments</code>, <code>cohort_size</code> and
<code>data</code> slots in defining the <code>TDDesign</code>
object:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TDDesign-class.html">TDDesign</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">DLTmodel</span>,</span>
<span>  nextBest <span class="op">=</span> <span class="va">TDNextBest</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping4</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements1</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data1</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When MCMC samples are involved, we also have to specify a design to
ensure our package will run the simulations using the MCMC samples of
the model parameters for models specified under the
<code>ModelPseudo</code> class object. In the example, the
<code>TDsamplesDesign</code> class object has to be used with the
<code>TDsamplesNextBest</code> class object in the <code>nextBest</code>
slot to ensure MCMC sampling is involved for this design. We also apply
the stopping rule <code>myStopping4</code> or <code>myStopping3</code>
such that the trial will stop either when the ratio of the 95%
credibility interval limits of the current estimate of TD30
(<code>TDtargetEndOfTrial</code>) is less than or equal to 5
(<code>myStopping4</code>) or when a maximum of 30 patients has been
enrolled in the trial (<code>myStopping3</code>):</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTsamplesDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TDsamplesDesign-class.html">TDsamplesDesign</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">DLTmodel</span>,</span>
<span>  nextBest <span class="op">=</span> <span class="va">TDsamplesNextBest</span>,</span>
<span>  stopping <span class="op">=</span> <span class="op">(</span><span class="va">myStopping4</span> <span class="op">|</span> <span class="va">myStopping3</span><span class="op">)</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements1</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data1</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="examining-single-trial-behavior">Examining single trial behavior<a class="anchor" aria-label="anchor" href="#examining-single-trial-behavior"></a>
</h3>
<p>Before looking at the “many trials” operating characteristics, it is
important to look at the “single trial” operating characteristics of the
dose escalation design. For this, <code>crmPack</code> provides the
function <code>examine</code>, which generates a <code>data.frame</code>
showing the beginning of several hypothetical trial courses under the
design. Assuming no DLTs have been seen until a certain dose, then the
consequences of different number of DLTs being observed at this dose are
shown. In the current example we have</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">23</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/examine.html">examine</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    dose DLTs nextDose  stop increment</span></span>
<span><span class="co">## 1     3    0      6.0 FALSE       100</span></span>
<span><span class="co">## 2     3    1      6.0 FALSE       100</span></span>
<span><span class="co">## 3     3    2      0.1 FALSE       -97</span></span>
<span><span class="co">## 4     3    3       NA FALSE        NA</span></span>
<span><span class="co">## 5     6    0     12.0 FALSE       100</span></span>
<span><span class="co">## 6     6    1     12.0 FALSE       100</span></span>
<span><span class="co">## 7     6    2      3.0 FALSE       -50</span></span>
<span><span class="co">## 8     6    3      0.5 FALSE       -92</span></span>
<span><span class="co">## 9    12    0     24.0 FALSE       100</span></span>
<span><span class="co">## 10   12    1     24.0 FALSE       100</span></span>
<span><span class="co">## 11   12    2     14.0 FALSE        17</span></span>
<span><span class="co">## 12   12    3      6.0 FALSE       -50</span></span>
<span><span class="co">## 13   24    0     30.0 FALSE        25</span></span>
<span><span class="co">## 14   24    1     30.0 FALSE        25</span></span>
<span><span class="co">## 15   24    2     26.0 FALSE         8</span></span>
<span><span class="co">## 16   24    3     18.0 FALSE       -25</span></span>
<span><span class="co">## 17   30    0     38.0 FALSE        27</span></span>
<span><span class="co">## 18   30    1     38.0 FALSE        27</span></span>
<span><span class="co">## 19   30    2     36.0 FALSE        20</span></span>
<span><span class="co">## 20   30    3     26.0 FALSE       -13</span></span>
<span><span class="co">## 21   38    0     50.0 FALSE        32</span></span>
<span><span class="co">## 22   38    1     50.0 FALSE        32</span></span>
<span><span class="co">## 23   38    2     42.0 FALSE        11</span></span>
<span><span class="co">## 24   38    3     36.0 FALSE        -5</span></span>
<span><span class="co">## 25   50    0     58.0  TRUE        16</span></span>
<span><span class="co">## 26   50    1     54.0  TRUE         8</span></span>
<span><span class="co">## 27   50    2     50.0  TRUE         0</span></span>
<span><span class="co">## 28   50    3     44.0  TRUE       -12</span></span></code></pre>
<p>Note that it is important to set a seed, since minor changes might
occur due to sampling variations. However, the <code>mcmcOptions</code>
parameter should be chosen in order to minimize such variation. The
default setting, used implicitly in the above call, should normally be
sufficient, but checking this (by running the function twice with
different seeds and comparing the results) is important.</p>
<p>The resulting data frame gives the dose of the cohort until which no
DLTs are observed, the number of DLTs, the resulting next dose
recommendation, whether the design would stop, and the relative
increment of the next dose compared to the current dose in percentage.
Note that cohort size rules are taken into account by
<code>examine</code>. <code>NA</code> entries mean that the design would
stop without a valid dose, since all doses are considered too toxic
after observing the number of DLTs at that dose.</p>
</div>
<div class="section level3">
<h3 id="simulating-from-a-true-scenario">Simulating from a true scenario<a class="anchor" aria-label="anchor" href="#simulating-from-a-true-scenario"></a>
</h3>
<p>For the “many trials” operating characteristics, we have to define a
true scenario, from which the data should arise. In this case, this only
requires a function that computes the probability of DLT given a dose.
Here we use a specific case of the function contained in the model
space:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## define the true function</span></span>
<span><span class="va">myTruth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/probFunction.html">probFunction</a></span><span class="op">(</span><span class="va">model</span>, alpha0 <span class="op">=</span> <span class="fl">7</span>, alpha1 <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot it in the range of the dose grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu">myTruth</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">80</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/true-def-1.png" width="576"></p>
<p>In a similar way, we can also simulate trials based on a true DLT
scenario using the <code>TDDesign</code> and the
<code>TDsamplesDesign</code>.</p>
<p>First, we will specified the true DLT scenario such that</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## define the true function</span></span>
<span><span class="va">TrueDLT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/probFunction.html">probFunction</a></span><span class="op">(</span><span class="va">DLTmodel</span>, phi1 <span class="op">=</span> <span class="op">-</span><span class="fl">53.66584</span>, phi2 <span class="op">=</span> <span class="fl">10.50499</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot it in the range of the dose grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="va">TrueDLT</span>, from <span class="op">=</span> <span class="fl">25</span>, to <span class="op">=</span> <span class="fl">300</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/trueDLT-1.png" width="576"></p>
<p>This true DLT scenario will be used for both the
<code>TDDesign</code> and the <code>TDsamplesDesign</code></p>
<p>Now we can proceed to the simulations. We only generate 100 trial
outcomes here for illustration, for the actual study this should be
increased of course to at least 500:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">mySims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">design</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">myTruth</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">819</span>,</span>
<span>  mcmcOptions <span class="op">=</span> <span class="va">options</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">time</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">## 126.342</span></span></code></pre>
<p>We have wrapped the call to <code>simulate</code> in a
<code>system.time</code> to obtain the required time for the simulations
(about 126 seconds in this case). The argument <code>args</code> could
contain additional arguments for the <code>truth</code> function, which
we did not require here and therefore let it at the default
<code>NULL</code>. We specify the number of simulations with
<code>nsim</code> and the random number generator seed with
<code>seed</code>. Note that we also pass again the MCMC options object,
because during the trial simulations the MCMC routines are used.
Finally, the argument <code>parallel</code> can be used to enable the
use of all processors of the computer for running the simulations in
parallel. This can yield a meaningful speedup, especially for larger
number of simulations.</p>
<p>As (almost) always, the result of this call is again an object with a
class, in this case <code>Simulations</code>:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mySims</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Simulations"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "crmPack"</span></span></code></pre>
<p>From the help page</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="st">"Simulations-class"</span>, help <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## starting httpd help server ... done</span></span></code></pre>
<p>we see that this class is a subclass of the
<code>GeneralSimulations</code> class. By looking at the help pages for
<code>Simulations</code> and the parent class
<code>GeneralSimulations</code>, we can find the description of all
slots of <code>mySims</code>. In particular, the <code>Data</code> slot
contains the list of produced <code>Data</code> objects of the simulated
trials. Therefore, we can plot the course of e.g. the third simulated
trial as follows:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySims</span><span class="op">@</span><span class="va">data</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/third-trial-1.png" width="576"></p>
<p>The final dose for this trial was</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySims</span><span class="op">@</span><span class="va">doses</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 24</span></span></code></pre>
<p>and the stopping reason was</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySims</span><span class="op">@</span><span class="va">stop_reasons</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [[1]][[1]]</span></span>
<span><span class="co">## [1] "Number of cohorts is 6 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[1]][[2]]</span></span>
<span><span class="co">## [1] "Probability for target toxicity is 54 % for dose 24 and thus above the required 50 %"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] "Number of patients is 18 and thus below the prespecified minimum number 20"</span></span></code></pre>
<p>Furthermore, with this object, we can apply two methods. First, we
can plot it, i.e. we can apply the plot method:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySims</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/sim-plot-1.png" width="576"></p>
<p>The resulting plot shows on the top panel a summary of the trial
trajectories. On the bottom, the proportions of doses tried, averaged
over the simulated trials, are shown. Note that you can select the plots
by changing the <code>type</code> argument of <code>plot</code>, which
by default is <code>type =   c("trajectory", "dosesTried")</code>.</p>
<p>Second, we can summarize the simulation results. Here again we have
to supply a true dose-toxicity function. We take the same
(<code>myTruth</code>) as above:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mySims</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">myTruth</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 100 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target toxicity interval was 20, 35 %</span></span>
<span><span class="co">## Target dose interval corresponding to this was 19.6, 21.6 </span></span>
<span><span class="co">## Intervals are corresponding to 10 and 90 % quantiles</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of patients overall : mean 19 (18, 21) </span></span>
<span><span class="co">## Number of patients treated above target tox interval : mean 7 (6, 9) </span></span>
<span><span class="co">## Proportions of DLTs in the trials : mean 26 % (22 %, 29 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients on active : mean 25 % (16 %, 34 %) </span></span>
<span><span class="co">## Doses selected as MTD : mean 20.8 (17.8, 26) </span></span>
<span><span class="co">## True toxicity at doses selected : mean 32 % (10 %, 70 %) </span></span>
<span><span class="co">## Proportion of trials selecting target MTD: 30 %</span></span>
<span><span class="co">## Dose most often selected as MTD: 20 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 26 %</span></span>
<span><span class="co">## Fitted toxicity rate at dose most often selected : mean 26 % (21 %, 30 %)</span></span></code></pre>
<p>Note that sometimes the observed toxicity rate at the dose most often
selected (here 20 mg) is not available, because it can happen that no
patients were actually treated that dose during the simulations. (Here
it is available.) This illustrates that the MTD can be selected based on
the evidence from the data at other dose levels – which is an advantage
of model-based dose-escalation designs.</p>
<p>Now we can also produce a plot of the summary results, which gives a
bit more detail than the textual summary we have just seen:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simSum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mySims</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">myTruth</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simSum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/sim-sum-plot-1.png" width="576"></p>
<p>The top left panel shows the distribution of the sample size across
the simulated trials. In this case the trials had between 15 and 21
patients. The top right panel shows the distribution of the final MTD
estimate / recommended dose across the simulated trials. The middle left
panel shows the distribution across the simulations of the DLT
proportions observed in the patients dosed. Here in most trials between
20 and 30% of the patients had DLTs. The middle right panel shows the
distribution across simulations of the number of patients treated above
the target toxicity window (here we used the default from 20% to 35%).
Finally, in the bottom panel we see a comparison of the true
dose-toxicity curve (black) with the estimated dose-toxicity curves,
averaged (continuous red line) across the trials and with 95% credible
interval across the trials. Here we see that the steep true
dose-toxicity curve is not recovered by the model fit.</p>
<p>If we find that e.g. the top right plot with the distribution of the
final selected doses is too small and shows not the right x-axis window,
we can only plot this one and add x-axis customization on top: (see the
<code>ggplot2</code> documentation for more information on customizing
the plots)</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dosePlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simSum</span>, type <span class="op">=</span> <span class="st">"doseSelected"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">30</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span></code></pre>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dosePlot</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 1 rows containing missing values (`geom_bar()`).</span></span></code></pre>
<p><img src="example_files/figure-html/sim-sum-plot2-1.png" width="576"></p>
<p>Some further examples will be given for simulations using the
<code>TDDesign</code> and the <code>TDsamplesDesign</code> classes. For
illustration purpose, we will generate only 10 trial outcomes.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTSim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">DLTdesign</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">TrueDLT</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">819</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The above is an example when no MCMC sampling is involved and we have
another example below for simulation when MCMC sampling is involved:</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTsampSim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">DLTsamplesDesign</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">TrueDLT</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">819</span>,</span>
<span>  mcmcOptions <span class="op">=</span> <span class="va">options</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The meaning of these arguments are the same as those defined and
explained above in the <code>simulate</code> example for the
<code>Design</code> class. % With slots <code>args</code> to specify any
additional arguments for the <code>truth</code> function,
<code>truth</code> for the real DLT scenario to simulate responses from,
<code>nsim</code> for the number of simulations, <code>seed</code>, the
random generator seed and <code>parallel</code> to specify whether
parallel computing is to be used for running the simulations.</p>
<p>Similarly, the results of individual simulations can be obtained
graphically using the <code>plot</code> function. The dose level for
recommendation that is the dose levels closest below the final estimated
TD30 (the final estimates of the dose level with probability of DLT
equals to the target end of trial) was</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTSim</span><span class="op">@</span><span class="va">doses</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100</span></span></code></pre>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTsampSim</span><span class="op">@</span><span class="va">doses</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100</span></span></code></pre>
<p>The overall results of the 100 trials for these two simulations can
also be plotted as</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DLTSim</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotDLTSim-1.png" width="576"></p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DLTsampSim</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotDLTsampSim-1.png" width="576"></p>
<p>which show the trial trajectories and the proportion of doses level
tried.</p>
<p>These simulation results can also be summarized using the
<code>summary</code> function given the truth:</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DLTSim</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">TrueDLT</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 10 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target probability of DLE p(DLE) used at the end of a trial was 30 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used at the end of a trial, TDEOT, was 152.6195 </span></span>
<span><span class="co">## TDEOT at dose Grid was 150 </span></span>
<span><span class="co">## Target p(DLE) used during a trial was 35 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used during a trial, TDDT, was 155.972 </span></span>
<span><span class="co">## TDDT at dose Grid was 150 </span></span>
<span><span class="co">## Number of patients overall : mean 16 (15, 18) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used at the end of a trial : mean 3 (3, 3) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used during a trial : mean 3 (3, 3) </span></span>
<span><span class="co">## Proportions of observed DLT in the trials : mean 21 % (20 %, 22 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients : mean 20 % (17 %, 21 %) </span></span>
<span><span class="co">## Doses selected as TDEOT : mean 100 (100, 100) </span></span>
<span><span class="co">## True toxicity at TDEOT : mean 1 % (1 %, 1 %) </span></span>
<span><span class="co">## Proportion of trials selecting the TDEOT: 0 %</span></span>
<span><span class="co">## Proportion of trials selecting the TDDT: 0 %</span></span>
<span><span class="co">## Dose most often selected as TDEOT: 100 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 6 %</span></span>
<span><span class="co">## Fitted probabilities of DLE at dose most often selected : mean 24 % (24 %, 25 %) </span></span>
<span><span class="co">## The summary table of the final TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    117.3   120.1   123.8   122.0   123.8   123.8  </span></span>
<span><span class="co">## The summary table of the final ratios of the TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    4.054   4.157   4.447   4.330   4.447   4.447  </span></span>
<span><span class="co">## The summary table of the final TDDT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    137.5   140.7   144.4   142.5   144.4   144.4  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    117.3   120.1   123.8   122.0   123.8   123.8  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##                   all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    4.054   4.157   4.447   4.330   4.447   4.447</span></span></code></pre>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DLTsampSim</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">TrueDLT</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 10 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target probability of DLE p(DLE) used at the end of a trial was 30 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used at the end of a trial, TDEOT, was 152.6195 </span></span>
<span><span class="co">## TDEOT at dose Grid was 150 </span></span>
<span><span class="co">## Target p(DLE) used during a trial was 35 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used during a trial, TDDT, was 155.972 </span></span>
<span><span class="co">## TDDT at dose Grid was 150 </span></span>
<span><span class="co">## Number of patients overall : mean 21 (21, 21) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used at the end of a trial : mean 1 (0, 3) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used during a trial : mean 1 (0, 3) </span></span>
<span><span class="co">## Proportions of observed DLT in the trials : mean 10 % (5 %, 14 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients : mean 6 % (1 %, 10 %) </span></span>
<span><span class="co">## Doses selected as TDEOT : mean 100 (75, 125) </span></span>
<span><span class="co">## True toxicity at TDEOT : mean 2 % (0 %, 5 %) </span></span>
<span><span class="co">## Proportion of trials selecting the TDEOT: 0 %</span></span>
<span><span class="co">## Proportion of trials selecting the TDDT: 0 %</span></span>
<span><span class="co">## Dose most often selected as TDEOT: 100 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 6 %</span></span>
<span><span class="co">## Fitted probabilities of DLE at dose most often selected : mean 22 % (18 %, 26 %) </span></span>
<span><span class="co">## The summary table of the final TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    97.28  100.35  115.37  114.40  125.23  135.76  </span></span>
<span><span class="co">## The summary table of the final ratios of the TDEOT across all simulations</span></span>
<span><span class="co">##       Min.   1st Qu.    Median      Mean   3rd Qu.      Max.  </span></span>
<span><span class="co">##  1.000e+01 6.800e+01 4.079e+06 5.241e+11 1.917e+11 3.806e+12  </span></span>
<span><span class="co">## The summary table of the final TDDT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    118.8   122.2   144.9   143.3   161.5   170.3  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    97.28  100.35  115.37  114.40  125.23  135.76  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##                   all simulations</span></span>
<span><span class="co">##       Min.   1st Qu.    Median      Mean   3rd Qu.      Max.  </span></span>
<span><span class="co">##  1.000e+01 6.800e+01 4.079e+06 5.241e+11 1.917e+11 3.806e+12</span></span></code></pre>
<p>Then we can also plot the summary of these two simulations using the
<code>plot</code> function:</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTsimSum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DLTSim</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">TrueDLT</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DLTsimSum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/DLTSim-plotsummary-1.png" width="576"></p>
<p>and</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DLTsimsampSum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DLTsampSim</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">TrueDLT</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DLTsimsampSum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/DLTsampSim-plotsummary-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="predicting-the-future-course-of-the-trial">Predicting the future course of the trial<a class="anchor" aria-label="anchor" href="#predicting-the-future-course-of-the-trial"></a>
</h3>
<p>By simulating parameters from their current posterior distribution
instead of an assumed true scenario, it is possible to generate trial
simulations from the posterior predictive distribution at any time point
during the trial. This means that we can predict the future course of
the trial, given the current data. In our illustrating example, this
would work as follows.</p>
<p>The rationale of the <code>simulate</code> call is now that we
specify as the <code>truth</code> argument the <code>prob</code>
function from our assumed model.</p>
<p>For the simulations, these arguments are internally given by the
values contained in the data frame given to <code>simulate</code> as the
<code>args</code> argument. In our case, we want to supply the posterior
samples of <code>alpha0</code> and <code>alpha1</code> in this data
frame. We take only 50 out of the 2000 posterior samples in order to
reduce the runtime for this example:</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postSamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">samples</span><span class="op">@</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">*</span> <span class="fl">50</span>, <span class="op">]</span></span>
<span><span class="va">postSamples</span></span></code></pre></div>
<pre><code><span><span class="co">##          alpha0    alpha1</span></span>
<span><span class="co">## 50   -1.3638482 0.6051534</span></span>
<span><span class="co">## 100   0.3635856 0.5014000</span></span>
<span><span class="co">## 150   0.2660523 0.1511878</span></span>
<span><span class="co">## 200  -0.8546810 0.9321286</span></span>
<span><span class="co">## 250   0.3515237 0.9865473</span></span>
<span><span class="co">## 300  -0.2780316 0.9861991</span></span>
<span><span class="co">## 350  -1.6596323 0.8385508</span></span>
<span><span class="co">## 400  -0.7376582 0.6596640</span></span>
<span><span class="co">## 450  -0.3214541 0.3098870</span></span>
<span><span class="co">## 500   0.5958671 0.9095670</span></span>
<span><span class="co">## 550  -0.7324474 1.0782009</span></span>
<span><span class="co">## 600   0.1514773 1.0823443</span></span>
<span><span class="co">## 650  -0.4438488 0.9495352</span></span>
<span><span class="co">## 700   1.5355211 0.9750417</span></span>
<span><span class="co">## 750   0.6474636 1.3922311</span></span>
<span><span class="co">## 800  -0.9571174 1.6381196</span></span>
<span><span class="co">## 850   0.7004483 1.9151077</span></span>
<span><span class="co">## 900  -1.2981845 1.0299982</span></span>
<span><span class="co">## 950   0.6332035 1.1745774</span></span>
<span><span class="co">## 1000 -1.7211984 0.3799383</span></span></code></pre>
<p>Therefore, each simulated trial will come from a posterior sample of
our estimated model, given all data so far.</p>
<p>Furthermore we have to make a new <code>Design</code> object that
contains the current data to start from, and the current recommended
dose as the starting dose:</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Design-class.html">Design</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  nextBest <span class="op">=</span> <span class="va">myNextBest</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  <span class="co">## use the current data:</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  <span class="co">## and the recommended dose as the starting dose:</span></span>
<span>  startingDose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally we can execute the simulations:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">futureSims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span></span>
<span>  <span class="co">## supply the new design here</span></span>
<span>  <span class="va">nowDesign</span>,</span>
<span>  <span class="co">## the truth is the assumed prob function</span></span>
<span>  truth <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">alpha0</span>, <span class="va">alpha1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Samples-class.html">Samples</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha0 <span class="op">=</span> <span class="va">alpha0</span>, alpha1 <span class="op">=</span> <span class="va">alpha1</span><span class="op">)</span>,</span>
<span>      options <span class="op">=</span> <span class="fu"><a href="../reference/McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>samples <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/prob.html">prob</a></span><span class="op">(</span><span class="va">dose</span>, <span class="va">model</span>, <span class="va">samples</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="co">## further arguments are the</span></span>
<span>  <span class="co">## posterior samples</span></span>
<span>  args <span class="op">=</span> <span class="va">postSamples</span>,</span>
<span>  <span class="co">## do exactly so many simulations as</span></span>
<span>  <span class="co">## we have samples</span></span>
<span>  nsim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">postSamples</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">918</span>,</span>
<span>  <span class="co">## this remains the same:</span></span>
<span>  mcmcOptions <span class="op">=</span> <span class="va">options</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">time</span></span></code></pre></div>
<pre><code><span><span class="co">## elapsed </span></span>
<span><span class="co">##  14.376</span></span></code></pre>
<p>And now, exactly in the same way as above for the operating
characteristics simulations, we can summarize the resulting predictive
simulations, for example show the predicted trajectories of doses:</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">futureSims</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/sim-future-plot-1.png" width="576"></p>
<p>In the summary, we do not need to look at the characteristics
involving the true dose-toxicity function, because in this case we are
not intending to compare the performance of our CRM relative to a
truth:</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">futureSims</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">myTruth</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 20 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target toxicity interval was 20, 35 %</span></span>
<span><span class="co">## Target dose interval corresponding to this was 19.6, 21.6 </span></span>
<span><span class="co">## Intervals are corresponding to 10 and 90 % quantiles</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of patients overall : mean 19 (17, 20) </span></span>
<span><span class="co">## Number of patients treated above target tox interval : mean 3 (0, 9) </span></span>
<span><span class="co">## Proportions of DLTs in the trials : mean 23 % (10 %, 31 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients on active : mean 18 % (4 %, 43 %) </span></span>
<span><span class="co">## Doses selected as MTD : mean 21.9 (10, 46.6) </span></span>
<span><span class="co">## True toxicity at doses selected : mean 32 % (0 %, 100 %) </span></span>
<span><span class="co">## Proportion of trials selecting target MTD: 0 %</span></span>
<span><span class="co">## Dose most often selected as MTD: 12 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 28 %</span></span>
<span><span class="co">## Fitted toxicity rate at dose most often selected : mean 20 % (7 %, 30 %)</span></span></code></pre>
<p>We see here e.g. that the estimated number of patients overall is 19,
so 11 more than the current 8 patients are expected to be needed before
finishing the trial.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-33-design-outcomes">Simulating 3+3 design outcomes<a class="anchor" aria-label="anchor" href="#simulating-33-design-outcomes"></a>
</h2>
<p>While <code>crmPack</code> focuses on model-based dose-escalation
designs, it also includes the 3+3 design in order to allow for
convenient comparisons. Note that actually no simulations would be
required for the 3+3 design, because all possible outcomes can be
enumerated, however we still rely here on simulations for consistency
with the overall <code>crmPack</code> design.</p>
<p>The easiest way to setup a 3+3 design is the function
<code>ThreePlusThreeDesign</code>:</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threeDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RuleDesign-class.html">ThreePlusThreeDesign</a></span><span class="op">(</span>doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">50</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">threeDesign</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "RuleDesign"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "crmPack"</span></span></code></pre>
<p>We have used here a much coarser dose grid than for the model-based
design before, because the 3+3 design cannot jump over doses. The
starting dose is automatically chosen as the first dose from the grid.
The outcome is a <code>RuleDesign</code> object, and you have more setup
options if you directly use the <code><a href="../reference/RuleDesign-class.html">RuleDesign()</a></code> initialization
function. We can then simulate trials, again assuming that the
<code>myTruth</code> function gives the true dose-toxicity
relationship:</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threeSims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">threeDesign</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">35</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">myTruth</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As before for the model-based design, we can summarize the
simulations:</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threeSimsSum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">threeSims</span>,</span>
<span>  truth <span class="op">=</span> <span class="va">myTruth</span></span>
<span><span class="op">)</span></span>
<span><span class="va">threeSimsSum</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 1000 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target toxicity interval was 20, 35 %</span></span>
<span><span class="co">## Target dose interval corresponding to this was 19.6, 21.6 </span></span>
<span><span class="co">## Intervals are corresponding to 10 and 90 % quantiles</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of patients overall : mean 16 (15, 18) </span></span>
<span><span class="co">## Number of patients treated above target tox interval : mean 4 (3, 6) </span></span>
<span><span class="co">## Proportions of DLTs in the trials : mean 17 % (13 %, 22 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients on active : mean 17 % (14 %, 22 %) </span></span>
<span><span class="co">## Doses selected as MTD : mean 15.2 (15, 15) </span></span>
<span><span class="co">## True toxicity at doses selected : mean 4 % (3 %, 3 %) </span></span>
<span><span class="co">## Proportion of trials selecting target MTD: 0 %</span></span>
<span><span class="co">## Dose most often selected as MTD: 15 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 3 %</span></span></code></pre>
<p>Here we see that mg was the dose most often selected as MTD, and this
is actually too low when comparing with the narrow target dose interval
going from to mg. This is an inherent problem of dose-escalation designs
where the dose grid has to be coarse: you might not know before starting
the trial which is the range where you need a more refined dose grid. In
this case we obtain doses that are too low, as one can see from the
average true toxicity of ~% at doses selected. Graphical summaries are
again obtained by calling <code>plot</code> on the summary object:</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">threeSimsSum</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/three-sims-plot-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="dual-endpoint-dose-escalation-designs">Dual-endpoint dose escalation designs<a class="anchor" aria-label="anchor" href="#dual-endpoint-dose-escalation-designs"></a>
</h2>
<p>In this section, we will look into dose-escalation procedures
included in this package where two end points are incorporated into the
study. The first endpoint is the binary DLT response that we discussed
already in the last sections. The second endpoint is the continuous
biomarker/efficacy response. In this package, we can either model these
two responses jointly (using a single model class, assuming correlation)
or separately (using two separate model classes, assuming no
correlation).</p>
<p>Now we will first describe how we model the two responses
jointly.</p>
<div class="section level3">
<h3 id="dual-endpoint-designs-with-a-joint-model">Dual-endpoint designs with a joint model<a class="anchor" aria-label="anchor" href="#dual-endpoint-designs-with-a-joint-model"></a>
</h3>
<blockquote>
<p>As a disclaimer, please note that the designs in this section are
still under development, and so far we have not yet been published.
Therefore please consider them as experimental.</p>
</blockquote>
<p>In the help page <code>DualEndpoint-class</code> the general joint
model structure is described. Basically the idea is that a (single)
biomarker variable is the second endpoint of the dose-escalation design,
with the aim to maximize the biomarker response while controlling
toxicity in a safe range. This is useful when it can not be assumed that
just increasing the dose will always lead to better efficacy.</p>
<p>Let’s look at the data structure. Here is an example:</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataDual-class.html">DataDual</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>,</span>
<span>      <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span></span>
<span>    <span class="op">)</span>,</span>
<span>  y <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>      <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">17</span><span class="op">)</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  w <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0.31</span>, <span class="fl">0.42</span>, <span class="fl">0.59</span>, <span class="fl">0.45</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>,</span>
<span>      <span class="fl">0.52</span>, <span class="fl">0.54</span>, <span class="fl">0.56</span>, <span class="fl">0.43</span>, <span class="fl">0.41</span>, <span class="fl">0.39</span>, <span class="fl">0.34</span>, <span class="fl">0.38</span>, <span class="fl">0.21</span></span>
<span>    <span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">6</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The corresponding plot can again be obtained with:</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-data-plot-1.png" width="576"></p>
<p>Here we see that there seems to be a maximum biomarker response at
around 10 mg already. In order to model this data, we consider a
dual-endpoint model with a first-order random-walk (RW1) structure for
the dose-biomarker relationship:</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DualEndpointRW-class.html">DualEndpointRW</a></span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  sigma2betaW <span class="op">=</span></span>
<span>    <span class="fl">0.01</span>,</span>
<span>  sigma2W <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.1</span>, b <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  rho <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  rw1 <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We use a smoothing parameter <span class="math inline">\(\sigma^{2}_{\beta_{W}} = 0.01\)</span>, an
inverse-gamma prior <span class="math inline">\(\mathrm{IG}(0.1,
0.1)\)</span> on the biomarker variance <span class="math inline">\(\sigma^{2}_{W}\)</span> and a uniform prior (or
<span class="math inline">\(\mathrm{Beta}(1, 1)\)</span> prior) on the
correlation <span class="math inline">\(\rho\)</span> between the latent
DLT and the biomarker variable.</p>
<p>As the dual-endpoint models are more complex, it is advisable to use
a sufficiently long Markov chain for fitting them. Here we just use for
illustration purposes a quite small Markov chain – again, for the real
application, this would need to be at least 25 times longer!</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span></span>
<span>  burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">2000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we can obtain the MCMC samples:</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model</span>, <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<p>And we check the convergence by picking a few of the fitted biomarker
means and plotting their traceplots:</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">@</span><span class="va">nGrid</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 41</span></span></code></pre>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betaWpicks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">samples</span>, <span class="st">"betaW"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">5L</span>, <span class="fl">10L</span>, <span class="fl">25L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html" class="external-link">ggs_traceplot</a></span><span class="op">(</span><span class="va">betaWpicks</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-conv-1.png" width="576"></p>
<p>Here all 4 <span class="math inline">\(\beta_{W,j}\)</span> (<span class="math inline">\(j=1, 5, 10, 25\)</span>) means, which are the
biomarker means at the first, 5th, 10th and 25th gridpoint,
respectively, seem to have converged, as the traceplots show. (Remember
that <code>data@nGrid</code> gives the number of grid points.) So we can
plot the model fit:</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span>, extrapolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-modelfit-1.png" width="576"></p>
<p>We specify <code>extrapolate = FALSE</code> to focus the biomarker
plot in the right panel on the observed dose range, so we don’t want to
extrapolate the biomarker fit to higher dose levels. We can also look at
the estimated biomarker precision <span class="math inline">\(1 /
\sigma^{2}_{W}\)</span>. For that we extract the precision
<code>precW</code> and then use another <code>ggmcmc</code> function to
create the histogram:</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_histogram.html" class="external-link">ggs_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">samples</span>, <span class="st">"precW"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-variance-1.png" width="576"></p>
<p>For the selection of the next best dose, a special class
<code>NextBestDualEndpoint</code> has been implemented. It tries to
maximize the biomarker response, under an NCRM-type safety constraint.
If we want to have at least 90% of the maximum biomarker response, and a
25% maximum overdose probability for the next dose, we specify:</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestDualEndpoint-class.html">NextBestDualEndpoint</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  overdose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.35</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  max_overdose_prob <span class="op">=</span> <span class="fl">0.25</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In our example, and assuming a dose limit of 50 mg given by the
maximum allowable increments, the next dose can then be found as
follows:</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">myNextBest</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">samples</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nextDose</span><span class="op">$</span><span class="va">value</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 12</span></span></code></pre>
<p>A corresponding plot can be produced by printing the
<code>plot</code> element of the returned list:</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">nextDose</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-nextdose-plot-1.png" width="576"></p>
<p>Here the bottom panel shows (as for the NCRM) the overdose
probability, and we see that doses above 14 mg are too toxic. In the top
panel, we see the probability for each dose to reach at least 90% of the
maximum biomarker response in the dose grid — this is here our target
probability. While the numbers are low, we clearly see that there is a
local maximum at 6 mg of the target probability, confirming what we have
seen in the previous data and model fit plots.</p>
<p>A corresponding stopping rule exists. When we have a certain
probability to be above a relative biomarker target, then the
<code>StoppingTargetBiomarker</code> rule gives back <code>TRUE</code>
when queried if it has been fulfilled by the <code>stopTrial</code>
function. For example, if we require at least 50% probability to be
above 90% biomarker response, we specify:</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStopping6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingTargetBiomarker-class.html">StoppingTargetBiomarker</a></span><span class="op">(</span></span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this case, the rule has not been fulfilled yet, as we see
here:</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span><span class="va">myStopping6</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">nextDose</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">samples</span>, <span class="va">model</span>, <span class="va">data</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "Probability for target biomarker is 11 % for dose 12 and thus below the required 50 %"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<p>Again, this dual-endpoint specific rule can be combined as required
with any other stopping rule. For example, we could combine it with a
maximum sample size of 40~patients:</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStopping</span> <span class="op">&lt;-</span> <span class="va">myStopping6</span> <span class="op">|</span> <span class="fu"><a href="../reference/StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<p>If one or both of the stopping rules are fulfilled, then the trial is
stopped.</p>
<p>Let’s try to build a corresponding dual-endpoint design. We start
with an empty data set, and use the relative increments rule defined in
a previous section and use a constant cohort size of 3 patients:</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emptydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataDual-class.html">DataDual</a></span><span class="op">(</span>doseGrid <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DualDesign-class.html">DualDesign</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">emptydata</span>,</span>
<span>  nextBest <span class="op">=</span> <span class="va">myNextBest</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="fu"><a href="../reference/CohortSizeConst-class.html">CohortSizeConst</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In order to study operating characteristics, we need to determine
true biomarker and DLT probability functions. Here we are going to use a
biomarker function from the beta family. Note that there is a
corresponding <code>DualEndpointBeta</code> model class, that allows to
have dual-endpoint designs with the beta biomarker response function.
Have a look at the corresponding help page for more information on that.
But let’s come back to our scenario definition:</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betaMod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">e0</span>, <span class="va">eMax</span>, <span class="va">delta1</span>, <span class="va">delta2</span>, <span class="va">scal</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">maxDens</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">delta1</span><span class="op">^</span><span class="va">delta1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">delta2</span><span class="op">^</span><span class="va">delta2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">delta1</span> <span class="op">+</span> <span class="va">delta2</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">delta1</span> <span class="op">+</span> <span class="va">delta2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dose</span> <span class="op">&lt;-</span> <span class="va">dose</span> <span class="op">/</span> <span class="va">scal</span></span>
<span>  <span class="va">e0</span> <span class="op">+</span> <span class="va">eMax</span> <span class="op">/</span> <span class="va">maxDens</span> <span class="op">*</span> <span class="op">(</span><span class="va">dose</span><span class="op">^</span><span class="va">delta1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">dose</span><span class="op">)</span><span class="op">^</span><span class="va">delta2</span></span>
<span><span class="op">}</span></span>
<span><span class="va">trueBiomarker</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">betaMod</span><span class="op">(</span><span class="va">dose</span>, e0 <span class="op">=</span> <span class="fl">0.2</span>, eMax <span class="op">=</span> <span class="fl">0.6</span>, delta1 <span class="op">=</span> <span class="fl">5</span>, delta2 <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">0.5</span> <span class="op">/</span> <span class="fl">0.5</span>, scal <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">trueTox</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">(</span><span class="va">dose</span> <span class="op">-</span> <span class="fl">60</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can draw the corresponding curves:</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu">trueTox</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu">trueBiomarker</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-sc-plot-1.png" width="576"></p>
<p>So the biomarker response peaks at 50 mg, where the toxicity is still
low. After deciding for a true correlation of <span class="math inline">\(\rho=0\)</span> and a true biomarker variance of
<span class="math inline">\(\sigma^{2}_{W} = 0.01\)</span> (giving a
high signal-to-noise ratio), we can start simulating trials (starting
each with 6 mg):</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mySims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">design</span>,</span>
<span>  trueTox <span class="op">=</span> <span class="va">trueTox</span>,</span>
<span>  trueBiomarker <span class="op">=</span> <span class="va">trueBiomarker</span>,</span>
<span>  sigma2W <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  rho <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  mcmcOptions <span class="op">=</span></span>
<span>    <span class="fu"><a href="../reference/McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span></span>
<span>      burnin <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>      step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      samples <span class="op">=</span> <span class="fl">3000</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that we are having a “small” MCMC option set here, in order to
reduce simulation time — for the real application, this should be
“larger”.</p>
<p>Plotting the result gives not only an overview of the final dose
recommendations and trial trajectories, but also a summary of the
biomarker variance and correlation estimates in the simulations:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mySims</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Note: method with signature 'Simulations#missing' chosen for function 'plot',</span></span>
<span><span class="co">##  target signature 'DualSimulations#missing'.</span></span>
<span><span class="co">##  "GeneralSimulations#missing" would also be valid</span></span></code></pre>
<p><img src="example_files/figure-html/dual-sims-plot-1.png" width="576"></p>
<p>Finally, a summary of the simulations can be obtained with the
corresponding function:</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mySims</span>,</span>
<span>  trueTox <span class="op">=</span> <span class="va">trueTox</span>,</span>
<span>  trueBiomarker <span class="op">=</span> <span class="va">trueBiomarker</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sumOut</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 10 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target toxicity interval was 20, 35 %</span></span>
<span><span class="co">## Target dose interval corresponding to this was 51.6, 56.1 </span></span>
<span><span class="co">## Intervals are corresponding to 10 and 90 % quantiles</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of patients overall : mean 42 (42, 42) </span></span>
<span><span class="co">## Number of patients treated above target tox interval : mean 0 (0, 0) </span></span>
<span><span class="co">## Proportions of DLTs in the trials : mean 0 % (0 %, 0 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients on active : mean 0 % (0 %, 0 %) </span></span>
<span><span class="co">## Doses selected as MTD : mean 0.1 (0.1, 0.1) </span></span>
<span><span class="co">## True toxicity at doses selected : mean 0 % (0 %, 0 %) </span></span>
<span><span class="co">## Proportion of trials selecting target MTD: 0 %</span></span>
<span><span class="co">## Dose most often selected as MTD: 0.1 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 0 %</span></span>
<span><span class="co">## Fitted toxicity rate at dose most often selected : mean 2 % (1 %, 2 %) </span></span>
<span><span class="co">## Fitted biomarker level at dose most often selected : mean 0.2 (0.2, 0.2)</span></span></code></pre>
<p>We see here that all trials proceeded until the maximum sample size
of 40 patients (reaching 42 because of the cohort size 3). The doses
selected are lower than the toxicity target range, because here we were
aiming for a biomarker target instead, and the true biomarker response
peaked at 50 mg.</p>
<p>The corresponding plot looks as follows:</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sumOut</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/dual-sim-sum-plot-1.png" width="576"></p>
<p>We see that the average biomarker fit is not too bad in the range up
to 50 mg, but the toxicity curve fit is bad — probably a result of the
very low frequency of DLTs.</p>
<p>Again the warning here: the dual-endpoint designs are still
experimental!</p>
<p>% Next we will talk about dose escalation designs where the two
endpoints are modelled separately.</p>
</div>
<div class="section level3">
<h3 id="dual-endpoint-designs-with-separate-models">Dual-endpoint designs with separate models<a class="anchor" aria-label="anchor" href="#dual-endpoint-designs-with-separate-models"></a>
</h3>
<p>In this subsection, we will look into the dose-escalation designs
where we model the binary DLT responses and the continuous
biomarker/efficacy responses separately. Here we hence assume that there
is no correlation between the binary DLT and continuous efficacy
responses.</p>
<p>First, we have to define the data sets for the dual responses using
the <code>DataDual</code> function just like in the example given in the
last subsection.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataDual-class.html">DataDual</a></span><span class="op">(</span>doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">300</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DataDual-class.html">DataDual</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">225</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.31</span>, <span class="fl">0.42</span>, <span class="fl">0.59</span>, <span class="fl">0.45</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.52</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">300</span>, <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this example, <code>data2</code> is the empty data set where 12
dose levels, from 25 to 300 mg with increments of 25 mg are used. The
variable <code>data4</code> contains the data set with both the binary
DLT and continuous efficacy responses observations. The elements in the
slot <code>x</code> are the dose levels where 8 subjects are treated.
The elements in slot <code>y</code> represent the corresponding binary
DLT responses observed for these 8 subjects and the elements in slot
<code>w</code> represent the continuous efficacy responses obtained for
the 8 subjects.</p>
<p>Similarly, we can also obtain a plot of the data sets using the
<code>plot</code> function as described in the last subsection.</p>
<p>As described, we will model the two responses separately. In order to
do so, we will only use models inheriting from the
<code>ModelPseudo</code> class.</p>
<p>For the binary DLT responses, we can use any of the models inheriting
from the <code>ModelTox</code> class. In the example below we will use
models inheriting from the <code>LogisticIndepBeta</code> class which is
the variable <code>DLTmodel</code> (or <code>newDLTmodel</code> with
observations) given in previous examples.</p>
<p>For the continuous efficacy responses, we can use any models
inheriting from the <code>ModelEff</code> class. In the current version
of the package, there are two model classes, the <code>Effloglog</code>
and the <code>EffFlexi</code> model, inheriting from the
<code>ModelEff</code> class. Since <code>ModelEff</code> is also
inheriting from the <code>ModelPseudo</code> class, the prior for this
efficacy model also needs to be specified in the form of pseudo data.
(Please refer to @ref(fig:model-classes) for the structure of model
classes defined in this package.)</p>
<p>The following commands show how we set up the <code>Effloglog</code>
model. This is an efficacy model to describe the relationship between
the efficacy responses to their corresponding dose levels on a double
logarithmic (“log-log”) scale. This refers to a linear model with three
unknown parameters: the intercept θ<sub>1</sub>, the slope θ<sub>2</sub>
and the precision <span class="math inline">\(\nu\)</span> (inverse of
the variance) of the efficacy responses. Similarly to other pseudo
models, the data set has to be specified before setting up the
model:</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Effmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Effloglog-class.html">Effloglog</a></span><span class="op">(</span></span>
<span>  eff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.223</span>, <span class="fl">2.513</span><span class="op">)</span>,</span>
<span>  eff_dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the specification of the prior pseudo data, two dose levels 25
and 300 mg are fixed and specified in the <code>eff_dose</code> slot.
After eliciting the prior expected efficacy values at these two dose
levels (e.g. by asking for experts’), these are specified in the
<code>eff</code> slot. Here for example, 1.223 is the expected efficacy
value for subjects treated at dose 25 mg and 2.513 is the expected
efficacy value for subjects treated at 300 mg. The slot <code>nu</code>
represents the prior precision of the efficacy responses. In this
example, two positive scalars for <span class="math inline">\(a\)</span>
and <span class="math inline">\(b\)</span> are specified suggesting the
prior distribution of the precision is gamma with shape parameter <span class="math inline">\(a=1\)</span> and rate parameter <span class="math inline">\(b=0.025\)</span>. Note here, since a gamma
distribution is used as the prior distribution of <span class="math inline">\(\nu\)</span>, the posterior distribution will
again be a gamma distribution, because the gamma prior on the precision
is conjugate to the normal likelihood. If a fixed value of the precision
is preferred, a single positive scalar can also be specified in
<code>nu</code> slot. Finally the <code>Data</code> slot is specified
either with an empty data set or a data set with all currently available
observations.</p>
<p>Similarly, we can also look at the structure of the Effmodel by
applying the <code>str</code> function:</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Effmodel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'Effloglog' [package "crmPack"] with 13 slots</span></span>
<span><span class="co">##   ..@ eff      : num [1:2] 1.22 2.51</span></span>
<span><span class="co">##   ..@ eff_dose : num [1:2] 25 300</span></span>
<span><span class="co">##   ..@ nu       : Named num [1:2] 1 0.025</span></span>
<span><span class="co">##   .. ..- attr(*, "names")= chr [1:2] "a" "b"</span></span>
<span><span class="co">##   ..@ use_fixed: logi FALSE</span></span>
<span><span class="co">##   ..@ theta1   : num -1.41</span></span>
<span><span class="co">##   ..@ theta2   : num 2.25</span></span>
<span><span class="co">##   ..@ Pcov     : num [1:2, 1:2] NaN NaN NaN NaN</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(log(x))"</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(log(x))"</span></span>
<span><span class="co">##   ..@ X        : num [1:2, 1:2] 1 1 1.17 1.74</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "1" "2"</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(log(x))"</span></span>
<span><span class="co">##   .. ..- attr(*, "assign")= int [1:2] 0 1</span></span>
<span><span class="co">##   ..@ Y        : num [1:2] 1.22 2.51</span></span>
<span><span class="co">##   ..@ mu       : num [1:2] -1.41 2.25</span></span>
<span><span class="co">##   ..@ Q        : num [1:2, 1:2] 2 2.91 2.91 4.4</span></span>
<span><span class="co">##   .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(log(x))"</span></span>
<span><span class="co">##   .. .. ..$ : chr [1:2] "(Intercept)" "log(log(x))"</span></span>
<span><span class="co">##   ..@ const    : num 0</span></span>
<span><span class="co">##   ..@ data     :Formal class 'DataDual' [package "crmPack"] with 10 slots</span></span>
<span><span class="co">##   .. .. ..@ w       : num(0) </span></span>
<span><span class="co">##   .. .. ..@ x       : num(0) </span></span>
<span><span class="co">##   .. .. ..@ y       : int(0) </span></span>
<span><span class="co">##   .. .. ..@ doseGrid: num [1:12] 25 50 75 100 125 150 175 200 225 250 ...</span></span>
<span><span class="co">##   .. .. ..@ nGrid   : int 12</span></span>
<span><span class="co">##   .. .. ..@ xLevel  : int(0) </span></span>
<span><span class="co">##   .. .. ..@ placebo : logi FALSE</span></span>
<span><span class="co">##   .. .. ..@ ID      : int(0) </span></span>
<span><span class="co">##   .. .. ..@ cohort  : int(0) </span></span>
<span><span class="co">##   .. .. ..@ nObs    : int 0</span></span></code></pre>
<p>There are 15 slots, which can be accessed with the <code>@</code>
operator. From this efficacy model, we can obtain the prior (if using an
empty data set) or the posterior modal estimates of model parameters
θ<sub>1</sub> (intercept) and θ<sub>2</sub> (slope). In addition, if a
gamma prior distribution is used for <span class="math inline">\(\nu\)</span> and we have some observations (data)
available, then we can obtain the updated values of the shape <span class="math inline">\(a\)</span> and the rate <span class="math inline">\(b\)</span> parameters for the gamma distribution,
via the model. The joint prior and posterior density functions of
θ<sub>1</sub> and θ<sub>2</sub> are described in details in <span class="citation">(Yeung et al. 2015)</span>.</p>
<p>Next, we will describe an example when a flexible semi-parametric
function is used to describe the relationship between the efficacy
values and their corresponding dose levels. The differences of the mean
efficacy responses of neighboring dose levels are modeled by the either
first or second order random walk models. This flexible model aims to
capture different shapes of the dose-efficacy curve. We will estimate
the mean efficacy responses obtained at each of the dose levels by MCMC
sampling. % will be involved to obtain the prior and posterior
distribution of all these mean efficacy responses.</p>
<p>This flexible form can be specified by using the
<code>EffFlexi</code> class object. The <code>EffFlexi</code> class is
inheriting from the <code>ModelEff</code> class and its prior is also
specified with pseudo data:</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Effmodel2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EffFlexi-class.html">EffFlexi</a></span><span class="op">(</span></span>
<span>  eff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.223</span>, <span class="fl">2.513</span><span class="op">)</span>,</span>
<span>  eff_dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">300</span><span class="op">)</span>,</span>
<span>  sigma2W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.1</span>, b <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  sigma2betaW <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">20</span>, b <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  rw1 <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here, similarly to above, we also fixed two dose levels 25 and 300 mg
and supplied the prior expected efficacy responses 1.223 and 2.513. The
variance of the efficacy responses <span class="math inline">\(\sigma^2\)</span> under this model can be
specified with a single positive scalar value or two positive scalar
values for the shape <span class="math inline">\(a\)</span> and the
scale <span class="math inline">\(b\)</span> parameters of the inverse
gamma distribution in the slot <code>sigma2</code>. In here, we
specified the variance of the efficacy responses with the inverse gamma
distribution with shape parameter <span class="math inline">\(a=0.1\)</span> and scale parameter <span class="math inline">\(b=0.1\)</span>. Then, the variance of the random
walk model <span class="math inline">\(\sigma^2_{\beta_W}\)</span> can
also be specified either with a single positive scalar or two positive
scalar for the parameters of the inverse gamma distribution in the slot
<code>sigma2betaW</code>. In here, we specified the variance of the
random walk model with the inverse gamma distribution with shape
parameter <span class="math inline">\(a=20\)</span> and scale parameter
<span class="math inline">\(b=50\)</span>. In addition, we can also
specify how we would like to smooth the mean efficacy response function.
Either the first order (with <code>RW1</code>) or the second order (with
<code>RW2</code>) random walk model can be used to describe the
relationship between the neighbouring mean efficacy responses and is
specified in the the slot <code>smooth</code>. As seen in our example,
<code>RW2</code>, the second order random walk model is used. Finally,
we also have to specify the data set in <code>Data</code> to be used for
the model which is <code>data2</code> in this example.</p>
<p>The structure of the <code>EffFlexi</code> model object is as
follows:</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Effmodel2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'EffFlexi' [package "crmPack"] with 10 slots</span></span>
<span><span class="co">##   ..@ eff        : num [1:2] 1.22 2.51</span></span>
<span><span class="co">##   ..@ eff_dose   : num [1:2] 25 300</span></span>
<span><span class="co">##   ..@ sigma2W    : Named num [1:2] 0.1 0.1</span></span>
<span><span class="co">##   .. ..- attr(*, "names")= chr [1:2] "a" "b"</span></span>
<span><span class="co">##   ..@ sigma2betaW: Named num [1:2] 20 50</span></span>
<span><span class="co">##   .. ..- attr(*, "names")= chr [1:2] "a" "b"</span></span>
<span><span class="co">##   ..@ use_fixed  : Named logi [1:2] FALSE FALSE</span></span>
<span><span class="co">##   .. ..- attr(*, "names")= chr [1:2] "sigma2W" "sigma2betaW"</span></span>
<span><span class="co">##   ..@ rw1        : logi FALSE</span></span>
<span><span class="co">##   ..@ X          : int [1:2, 1:12] 1 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..@ RW         : num [1:12, 1:12] 1 -2 1 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..@ RW_rank    : int 10</span></span>
<span><span class="co">##   ..@ data       :Formal class 'DataDual' [package "crmPack"] with 10 slots</span></span>
<span><span class="co">##   .. .. ..@ w       : num(0) </span></span>
<span><span class="co">##   .. .. ..@ x       : num(0) </span></span>
<span><span class="co">##   .. .. ..@ y       : int(0) </span></span>
<span><span class="co">##   .. .. ..@ doseGrid: num [1:12] 25 50 75 100 125 150 175 200 225 250 ...</span></span>
<span><span class="co">##   .. .. ..@ nGrid   : int 12</span></span>
<span><span class="co">##   .. .. ..@ xLevel  : int(0) </span></span>
<span><span class="co">##   .. .. ..@ placebo : logi FALSE</span></span>
<span><span class="co">##   .. .. ..@ ID      : int(0) </span></span>
<span><span class="co">##   .. .. ..@ cohort  : int(0) </span></span>
<span><span class="co">##   .. .. ..@ nObs    : int 0</span></span></code></pre>
<p>The slot and the names are shown which can be accessed with the
<code>@</code> operator. The value ‘FALSE’ of the slot
<code>useFixed</code> shows that both the variance of the efficacy
response <code>sigma2</code> and the variance of the random walk model
`sigma2betaW<code>are not fixed, but estimated and assigned an inverse gamma prior distribution in this model. The slot</code>useRW1<code>also gives a 'FALSE' value which means that the second order random walk model has been used to model the smooth dose-response function. In addition, the (only internally required) random walk difference matrix and the rank of this matrix are also shown in the slot</code>RWmat<code>and</code>RWmatRank`,
respectively.</p>
<p>As discussed, the posterior estimates for model parameters specified
under <code>ModelPseudo</code> class (except the <code>EffFlexi</code>
model class) can be obtained as the modal estimates or via MCMC
sampling. In here, we will first show how we obtain the estimates of the
parameters via MCMC sampling. (Similarly, we can also use the
<code>mcmc</code> function to obtain prior and posterior samples of the
<code>Effloglog</code> and the <code>EffFlexi</code> models.) % using
Effmodel or Effmodel2, respectively with data2 and options specified
earlier</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Effsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data2</span>, model <span class="op">=</span> <span class="va">Effmodel</span>, <span class="va">options</span><span class="op">)</span></span>
<span><span class="va">Effsamples2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data2</span>, model <span class="op">=</span> <span class="va">Effmodel2</span>, <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Effpostsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data2</span>, model <span class="op">=</span> <span class="va">Effmodel</span>, <span class="va">options</span><span class="op">)</span></span>
<span><span class="va">Effpostsamples2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data2</span>, model <span class="op">=</span> <span class="va">Effmodel2</span>, <span class="va">options</span><span class="op">)</span></span></code></pre></div>
<p>Under the <code>Effloglog</code> (Effmodel) model, samples of the
intercept θ<sub>1</sub>, the slope θ<sub>2</sub> of the efficacy linear
log-log model and the precision <span class="math inline">\(\nu\)</span>
of the efficacy responses can be obtained. For the <code>EffFlexi</code>
(Effmodel2) model, the samples of the mean efficacy responses at all
dose levels, the variance <span class="math inline">\(\sigma^2\)</span>
(sigma2) of the efficacy responses and the variance <span class="math inline">\(\sigma^2_{\beta_W}\)</span> (sigma2betaW) of the
random walk model are obtained. It is also again possible to look at the
structure (<code>str</code>) and extract (<code>get</code>) and obtain
plots (<code>ggs_traceplot</code> and <code>ggs_autocorrelation</code>)
of the samples of the parameters.</p>
<p>If no MCMC sampling is involved, the prior or the posterior modal
estimates can be obtained in the output of the models. If some
observations for both responses are available, they can be put in a
<code>DataDual</code> data set, and given to the <code>Data</code> slot
under each model. We can also do so by updating the current model with
the new observations using the <code>update</code> function. Then the
prior or the posterior modal estimates of the model parameters can be
obtained using the <code>@</code> operator of the model. For example,
for the <code>Effloglog</code> class model:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newEffmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Effmodel</span>, data <span class="op">=</span> <span class="va">data4</span><span class="op">)</span></span>
<span><span class="va">newEffmodel</span><span class="op">@</span><span class="va">theta1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -2.81695</span></span></code></pre>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newEffmodel</span><span class="op">@</span><span class="va">theta2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2.709524</span></span></code></pre>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newEffmodel</span><span class="op">@</span><span class="va">nu</span></span></code></pre></div>
<pre><code><span><span class="co">##         a         b </span></span>
<span><span class="co">## 3.0000000 0.9832955</span></span></code></pre>
<p>The posterior modal estimates of θ<sub>1</sub> and θ<sub>2</sub> and
the updated values of parameters of the gamma distribution of <span class="math inline">\(\nu\)</span> can be read now from the output
above.</p>
<p>Similarly we can update with new data for the <code>EffFlexi</code>
class model:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newEffmodel2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Effmodel2</span>, data <span class="op">=</span> <span class="va">data4</span><span class="op">)</span></span>
<span><span class="va">newEffmodel2</span><span class="op">@</span><span class="va">RW</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]</span></span>
<span><span class="co">##  [1,]    1   -2    1    0    0    0    0    0    0     0     0     0</span></span>
<span><span class="co">##  [2,]   -2    5   -4    1    0    0    0    0    0     0     0     0</span></span>
<span><span class="co">##  [3,]    1   -4    6   -4    1    0    0    0    0     0     0     0</span></span>
<span><span class="co">##  [4,]    0    1   -4    6   -4    1    0    0    0     0     0     0</span></span>
<span><span class="co">##  [5,]    0    0    1   -4    6   -4    1    0    0     0     0     0</span></span>
<span><span class="co">##  [6,]    0    0    0    1   -4    6   -4    1    0     0     0     0</span></span>
<span><span class="co">##  [7,]    0    0    0    0    1   -4    6   -4    1     0     0     0</span></span>
<span><span class="co">##  [8,]    0    0    0    0    0    1   -4    6   -4     1     0     0</span></span>
<span><span class="co">##  [9,]    0    0    0    0    0    0    1   -4    6    -4     1     0</span></span>
<span><span class="co">## [10,]    0    0    0    0    0    0    0    1   -4     6    -4     1</span></span>
<span><span class="co">## [11,]    0    0    0    0    0    0    0    0    1    -4     5    -2</span></span>
<span><span class="co">## [12,]    0    0    0    0    0    0    0    0    0     1    -2     1</span></span></code></pre>
<p>The <code>plot</code> function can also be applied to the
<code>Effloglog</code> model class or the <code>EffFlexi</code> model
class objects, when samples of the parameters are generated under all
these models:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Effpostsamples</span>, <span class="va">newEffmodel</span>, <span class="va">data4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plot-samplesdata2loglog-1.png" width="576"></p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Effpostsamples2</span>, <span class="va">newEffmodel2</span>, <span class="va">data4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plot-samplesdata2Flexi-1.png" width="576"></p>
<p>In addition, we can also plot the fitted dose-efficacy curve using
the prior or the posterior modal estimates of the model parameters when
no MCMC sampling is used. For example, using <code>Effmodel</code> and
data set <code>data2</code> specified earlier:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data2</span>, <span class="va">Effmodel</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plot-nosamplesEffmodel-1.png" width="576"></p>
<p>Since no samples are involved, only the curves using the prior or
posterior modal estimates of the parameters are produced, and no 95%
credibility intervals are provided.</p>
<p>Furthermore, we can also plot the estimated DLT probability and
efficacy curve side by side using the <code>plotDualResponses</code>
function. For example, using the <code>DLTmodel</code>,
<code>Effmodel</code> and <code>data2</code> specified in earlier
examples:</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotDualResponses.html">plotDualResponses</a></span><span class="op">(</span></span>
<span>  DLEmodel <span class="op">=</span> <span class="va">DLTmodel</span>,</span>
<span>  Effmodel <span class="op">=</span> <span class="va">Effmodel</span>, data <span class="op">=</span> <span class="va">data2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotDualResponseNoSamples-1.png" width="576"></p>
<p>When the MCMC samples are used, we have:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotDualResponses.html">plotDualResponses</a></span><span class="op">(</span></span>
<span>  DLEmodel <span class="op">=</span> <span class="va">DLTmodel</span>, DLEsamples <span class="op">=</span> <span class="va">DLTsamples</span>,</span>
<span>  Effmodel <span class="op">=</span> <span class="va">Effmodel</span>, Effsamples <span class="op">=</span> <span class="va">Effsamples</span>, data <span class="op">=</span> <span class="va">data2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotDualResponseSamples-1.png" width="576"></p>
<p>Next we will talk about the dose escalation rules when two separate
models are used for the dual responses. All <code>Increments</code>,
<code>CohortSize</code> and the <code>Stopping</code> rules classes
described earlier can be applied here. We will now look into additional
<code>nextBest</code> and <code>Stopping</code> classes rules that we
can use in this situation.</p>
<p>In here, the decision of choosing the next best dose for
administration is based on a gain function we defined <span class="citation">(Yeung et al. 2015)</span>. This gain function
represents a trade-off between the DLT and efficacy responses such that
we will allocate the dose which gives the best trade-off between these
responses. In other words, the dose which gives the maximum gain value
will be the dose allocated to the next cohort of subjects. The basic
ideas of this rules are as follows. % old text: Assume that no DLT is
observed in a subject, the gain value observed at a particular dose
level is obtained by multiplying the probability of no DLT observed at
this dose levels and all expected efficacy responses when no DLT is
observed at this particular dose level. %new: The gain value at a
particular dose level is obtained by multiplying the probability of no
DLT at this dose level and the expected efficacy response at this dose
level. As the data accumulates in the trial, the estimate of the gain
function will improve. This gain function consists of two components,
one part is about the DLT responses and the other about the efficacy
response. It depends on the values obtained in each of the components
which will affect the values of the gain.</p>
<p>For example, the most ideal case is that both the probability of no
DLT and the expected value of the efficacy response are high. The gain
value obtained will then be very high. This is the reason why the dose
which gives the maximum gain value should be allocated to the next
cohort of subjects.</p>
<p>We can plot the gain function given a DLT model specified under the
<code>ModelTox</code> class and an efficacy model specified under the
<code>ModelEff</code> class using the <code>plotGain</code> function.
For example, using the variables <code>newDLTmodel</code>,
<code>newEffmodel</code> and the data set with observations,
<code>data4</code>, specified in earlier examples, we have:</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotGain.html">plotGain</a></span><span class="op">(</span>DLEmodel <span class="op">=</span> <span class="va">newDLTmodel</span>, Effmodel <span class="op">=</span> <span class="va">newEffmodel</span>, data <span class="op">=</span> <span class="va">data4</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotGain-1.png" width="576"></p>
<p>This is a case where no MCMC sampling is involved such that the prior
and posterior modal estimates of the model parameters are used.</p>
<p>There are two implemented <code>nextBest</code> rules for the dual
responses using the gain function: the <code>NextBestMaxGain</code> and
the <code>NextBestMaxGainSamples</code> class object. The
<code>NextBestMaxGain</code> is used when no MCMC sampling are involved
and we will use the prior or the posterior modal estimates of the model
parameters to obtain the gain values at each of the dose levels, while
the <code>NextBestMaxGainSamples</code> is used when MCMC sampling is
involved to obtain the posterior estimates. For example, when no MCMC
sampling is involved:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GainNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestMaxGain-class.html">NextBestMaxGain</a></span><span class="op">(</span></span>
<span>  prob_target_drt <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  prob_target_eot <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To use the <code>NextBestMaxGain</code>, we have to specify the
target probability of the occurrence of a DLT to be used during the
trial or at the end of the trial. In this example, the target
probability of DLT to be used during the trial and at the end of the
trial are 0.35 and 0.3, respectively. Therefore, under this rule we will
suggest the dose level which gives the maximum gain value and has a
probability of DLT less than or equal to 0.35 to administer to the next
cohort of subjects. At the end of the trial, we will recommend the dose
with maximum gain value and probability of DLT less than or equal to
0.3. In order to derive the next best dose for administration, we have
to use the <code>nextBest</code> function with this
<code>NextBestMaxGain</code> object given the doselimit, both the DLT
and the efficacy models and the data set, which includes all currently
available observations:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecGain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">GainNextBest</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data4</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="va">newDLTmodel</span>,</span>
<span>  model_eff <span class="op">=</span> <span class="va">newEffmodel</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The results will be a list of numerical values with a plot
illustrating how the next best dose was computed. The list of numerical
values include the next best dose suggested, the values of the target
probabilities of DLT used during and at the end of a trial. Furthermore,
the estimated doses for these two targets, as well as the “Gstar”
estimated dose (the dose with gives the maximum gain value) are provided
along with the corresponding dose level in the dose grid for the above
three estimates. We can also get to see the plot about the next best
dose recommendation using the <code>$</code> operator.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecGain</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="example_files/figure-html/nextbestplot-maxgain-1.png" width="576"></p>
<p>As usual, we have the solid red, blue and green lines as the curves
to represent the relationship between the probability of DLT, the mean
efficacy response and gain values, respectively, to their corresponding
dose levels. The vertical line in purple shows the next best dose
suggested for administration and the vertical brown line shows the
maximum allowable dose level to be administered to the next cohort of
subjects. Furthermore, the circle and the square on the DLT curve also
show the current estimate of the estimated TD30 and TD35.</p>
<p>Next we will look at the <code>NextBestMaxGainSamples</code> class
object when MCMC sampling is involved. In the following code, we specify
the target probabilities of DLT used during or at the end of a trial to
be 0.35 and 0.3 again, and we specify that the 30% posterior quantile
will be used as the estimate for the TD35 and TD30, while we specify the
50% posterior quantile for the Gstar estimate:</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GainsamplesNextBest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestMaxGainSamples-class.html">NextBestMaxGainSamples</a></span><span class="op">(</span></span>
<span>  prob_target_drt <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  prob_target_eot <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  derive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">TDsamples</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">TDsamples</span>, prob <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  mg_derive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Gstarsamples</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Gstarsamples</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that the two functions, <code>derive</code> and
<code>mg_derive</code> have to be specified to derive the corresponding
estimates from the posterior samples.</p>
<p>Again, the generic function <code>nextBest</code> will be used
together with this rule object to derive the next best dose:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecGainSamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span><span class="va">GainsamplesNextBest</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data4</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="va">newDLTmodel</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">DLTpostsamples</span>,</span>
<span>  model_eff <span class="op">=</span> <span class="va">newEffmodel</span>,</span>
<span>  samples_eff <span class="op">=</span> <span class="va">Effpostsamples</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Estimated TD 30 = 18.6611868271306 not within dose grid"</span></span></code></pre>
<p>The list of numerical results given in the output will be the same as
those given using <code>NextBestMaxGain</code> class object which
includes the next dose suggested, the current estimates of TD30, TD35
and Gstar and their corresponding dose levels at dose Grid. We can also
see the plot:</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecGainSamples</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="example_files/figure-html/nextbest-NextBestMaxGainSamplesplot-1.png" width="576"></p>
<p>In this plot, the posterior distribution of Gstar is shown as a
histogram. The vertical lines on the plot show all current estimates of
TD30, TD35 and Gstar. In addition, the next dose and the maximum
allowable dose are also given in blue and red lines, respectively.</p>
<p>Next, we will introduce some further <code>Stopping</code> rules that
can be applied to the above two classes of escalation rules. After the
escalation based on two responses and two separate pseudo DLT and
efficacy models, we will select one dose, which is the minimum of the
estimate of TD30 (TDtargetEndOfTrial) and the optimal gain dose (Gstar)
as the recommended dose for potential further clinical trials. The main
feature of these stopping rules is that the trial could be stopped if
the current estimates of this selected quantity is ‘accurate’ enough. In
particular, we will also consider the ratio of the 95% credibility
interval bounds of its current estimate. The smaller this ratio, the
more accurate is the estimate.</p>
<p>For example, we would like to stop our trial if the ratio is less
than or equal to 5. The functions <code>StoppingMaxGainCIRatio</code> is
used for this purpose:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStopping7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingMaxGainCIRatio-class.html">StoppingMaxGainCIRatio</a></span><span class="op">(</span>target_ratio <span class="op">=</span> <span class="fl">5</span>, prob_target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">myStopping8</span> <span class="op">&lt;-</span> <span class="va">myStopping7</span> <span class="op">|</span> <span class="fu"><a href="../reference/StoppingMinPatients-class.html">StoppingMinPatients</a></span><span class="op">(</span><span class="fl">72</span><span class="op">)</span></span></code></pre></div>
<p>To note here, at the moment the class
<code>stoppingMaxGainCIRatio</code> cannot be used together with other
<code>stopping</code> class rules with the “and” operator
<code>&amp;</code> and the <code>or</code> operator <code>|</code> (this
is still under development).</p>
<p>Similarly, the <code>stopTrial</code> function can then be used in
order to determine if the rule has been fulfilled:</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping7</span>, dose <span class="op">=</span> <span class="va">doseRecGain</span><span class="op">$</span><span class="va">next_dose</span>, model <span class="op">=</span> <span class="va">newDLTmodel</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data4</span>, Effmodel <span class="op">=</span> <span class="va">newEffmodel</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "Gstar estimate is 79.7805 with 95% CI ( 21.5588 , 295.2361 ) and its ratio = 13.6945"               </span></span>
<span><span class="co">## [2] "TDtargetEndOfTrial estimate is  42.6813 with 95% CI ( 11.0662 , 164.618 ) and its ratio= 14.8758"   </span></span>
<span><span class="co">## [3] "TDatrgetEndOfTrial estimate is smaller with ratio = 14.8758 which is  greater than target_ratio = 5"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping7</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecGainSamples</span><span class="op">$</span><span class="va">next_dose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">DLTpostsamples</span>,</span>
<span>  model <span class="op">=</span> <span class="va">newDLTmodel</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data4</span>,</span>
<span>  TDderive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">TDsamples</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">TDsamples</span>, prob <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  Effmodel <span class="op">=</span> <span class="va">newEffmodel</span>,</span>
<span>  Effsamples <span class="op">=</span> <span class="va">Effpostsamples</span>,</span>
<span>  Gstarderive <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Gstarsamples</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Gstarsamples</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## attr(,"message")</span></span>
<span><span class="co">## [1] "Gstar estimate is 50 with 95% CI ( 25 , 300 ) and its ratio = 12"                                          </span></span>
<span><span class="co">## [2] "TDtargetEndOfTrial estimate is  18.6612 with 95% CI ( 6e-04 , 10459.1345 ) and its ratio= 17110373.1537"   </span></span>
<span><span class="co">## [3] "TDatrgetEndOfTrial estimate is smaller with ratio = 17110373.1537  which is  greater than target_ratio = 5"</span></span>
<span><span class="co">## attr(,"report_label")</span></span>
<span><span class="co">## [1] NA</span></span></code></pre>
<p>% For cases when either no or DLT and efficacy samples are
involved.</p>
<p>Next, we will now look at how to construct the design objects. We
will also start with an empty data set, the object <code>data3</code> of
the <code>DataDual</code> class introduced in earlier examples.</p>
<p>There are two functions which we can used. The
<code>DualResponsesDesign</code> can be used without MCMC samples, while
<code>DualResponsesSamplesDesign</code> can be used when MCMC samples
are involved. For example, we use the object <code>Effmodel</code> of
the <code>Effloglog</code> class specified earlier as the efficacy model
in the following code:</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DualResponsesDesign-class.html">DualResponsesDesign</a></span><span class="op">(</span></span>
<span>  nextBest <span class="op">=</span> <span class="va">GainNextBest</span>,</span>
<span>  model <span class="op">=</span> <span class="va">DLTmodel</span>,</span>
<span>  eff_model <span class="op">=</span> <span class="va">Effmodel</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data2</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping7</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements1</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DualResponsesSamplesDesign-class.html">DualResponsesSamplesDesign</a></span><span class="op">(</span></span>
<span>  nextBest <span class="op">=</span> <span class="va">GainsamplesNextBest</span>,</span>
<span>  model <span class="op">=</span> <span class="va">DLTmodel</span>,</span>
<span>  eff_model <span class="op">=</span> <span class="va">Effmodel</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data2</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping8</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements1</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can use the function <code>DualResponsesSamplesDesign</code> to
specify a design when an efficacy model is specified under the
<code>EffFlexi</code> class object. For example, we use the object
<code>Effmodel2</code> of the <code>EffFlexi</code> class specified in
earlier examples here:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DualResponsesSamplesDesign-class.html">DualResponsesSamplesDesign</a></span><span class="op">(</span></span>
<span>  nextBest <span class="op">=</span> <span class="va">GainsamplesNextBest</span>,</span>
<span>  model <span class="op">=</span> <span class="va">DLTmodel</span>,</span>
<span>  eff_model <span class="op">=</span> <span class="va">Effmodel2</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data2</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">myStopping8</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">myIncrements1</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">mySize</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We specified the above three designs using all previous rules for
nextBest (the escalation rule), stopping, increments and cohort
size.</p>
<p>Next, we have to specify the scenarios for simulations. For example,
for simulations using the DLT model and efficacy model from the
<code>LogisticIndepBeta</code> and <code>Effloglog</code> objects,
respectively, we can specify the scenario as below:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myTruthDLT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/probFunction.html">probFunction</a></span><span class="op">(</span><span class="va">DLTmodel</span>, phi1 <span class="op">=</span> <span class="op">-</span><span class="fl">53.66584</span>, phi2 <span class="op">=</span> <span class="fl">10.50499</span><span class="op">)</span></span>
<span><span class="va">myTruthEff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/efficacyFunction.html">efficacyFunction</a></span><span class="op">(</span><span class="va">Effmodel</span>, theta1 <span class="op">=</span> <span class="op">-</span><span class="fl">4.818429</span>, theta2 <span class="op">=</span> <span class="fl">3.653058</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myTruthGain</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">myTruthEff</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu">myTruthDLT</span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The true DLT, efficacy and gain curves can be obtained. We can see
the corresponding curves as</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TruthTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doseFunction.html">doseFunction</a></span><span class="op">(</span><span class="va">DLTmodel</span>, phi1 <span class="op">=</span> <span class="op">-</span><span class="fl">53.66584</span>, phi2 <span class="op">=</span> <span class="fl">10.50499</span><span class="op">)</span></span>
<span></span>
<span><span class="va">GAIN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">-</span><span class="op">(</span><span class="op">-</span><span class="fl">4.8218429</span> <span class="op">+</span> <span class="fl">3.653058</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">xi</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">53.66584</span> <span class="op">+</span> <span class="fl">10.50499</span> <span class="op">*</span> <span class="va">xi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Txi</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">GAIN</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="va">maxg</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">GAIN</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="va">gstar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">Txi</span><span class="op">)</span></span>
<span><span class="va">td30</span> <span class="op">&lt;-</span> <span class="fu">TruthTD</span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">td35</span> <span class="op">&lt;-</span> <span class="fu">TruthTD</span><span class="op">(</span><span class="fl">0.35</span><span class="op">)</span></span>
<span><span class="va">DoseLevels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">300</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DoseLevels</span>, <span class="fu">myTruthDLT</span><span class="op">(</span><span class="va">DoseLevels</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">3</span>, ylab <span class="op">=</span> <span class="st">"Values"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu">myTruthEff</span><span class="op">(</span><span class="va">DoseLevels</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">td30</span>, <span class="fl">0.3</span>, col <span class="op">=</span> <span class="st">"violet"</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">td35</span>, <span class="fl">0.35</span>, col <span class="op">=</span> <span class="st">"violet"</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">DoseLevels</span>, <span class="fu">myTruthEff</span><span class="op">(</span><span class="va">DoseLevels</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">DoseLevels</span>, <span class="fu">myTruthGain</span><span class="op">(</span><span class="va">DoseLevels</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green3"</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">gstar</span>, <span class="op">-</span><span class="va">maxg</span>, col <span class="op">=</span> <span class="st">"green3"</span>, pch <span class="op">=</span> <span class="fl">17</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"n"</span>, cex <span class="op">=</span> <span class="fl">1.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"p(DLT)=0.3"</span>, <span class="st">"p(DLT)=0.35"</span>, <span class="st">"Max gain"</span>, <span class="st">"p(DLTs)"</span>,</span>
<span>    <span class="st">"efficacy"</span>, <span class="st">"gain"</span></span>
<span>  <span class="op">)</span>, text.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"violet"</span>, <span class="st">"violet"</span>, <span class="st">"green3"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green3"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"violet"</span>, <span class="st">"violet"</span>, <span class="st">"green3"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green3"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/Truecurves-1.png" width="576"></p>
<p>Using all the above commands, we can obtained the DLT (red),
efficacy(blue) and gain (green) curves and also their corresponding true
values for the TD30 (TDtargetEndOfTrial), TD35 (TDtargetDuringTrial) and
the Gstar. In addition, the above scenario for DLT and efficacy can be
used for both cases (modal estimates or MCMC samples).</p>
<p>If the <code>EffFlexi</code> class object will be used for the
simulations. Using the same DLT scenario and a new efficacy scenario
will be specified such that</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myTruthEff1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="op">-</span><span class="fl">0.5478867</span>, <span class="fl">0.1645417</span>, <span class="fl">0.5248031</span>, <span class="fl">0.7604467</span>,</span>
<span>  <span class="fl">0.9333009</span>, <span class="fl">1.0687031</span>, <span class="fl">1.1793942</span>, <span class="fl">1.2726408</span>,</span>
<span>  <span class="fl">1.3529598</span>, <span class="fl">1.4233411</span>, <span class="fl">1.4858613</span>, <span class="fl">1.5420182</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">@</span><span class="va">doseGrid</span></span>
<span><span class="va">myTruthGain1</span> <span class="op">&lt;-</span> <span class="va">myTruthEff1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu">myTruthDLT</span><span class="op">(</span><span class="va">d1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The corresponding curves can also be plotted as:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maxg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">myTruthGain1</span><span class="op">)</span></span>
<span><span class="va">gstar1</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">@</span><span class="va">doseGrid</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">myTruthGain1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">DoseLevels1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">300</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">TruthTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doseFunction.html">doseFunction</a></span><span class="op">(</span><span class="va">DLTmodel</span>, phi1 <span class="op">=</span> <span class="op">-</span><span class="fl">53.66584</span>, phi2 <span class="op">=</span> <span class="fl">10.50499</span><span class="op">)</span></span>
<span><span class="va">td30</span> <span class="op">&lt;-</span> <span class="fu">TruthTD</span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">td35</span> <span class="op">&lt;-</span> <span class="fu">TruthTD</span><span class="op">(</span><span class="fl">0.35</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DoseLevels1</span>, <span class="fu">myTruthDLT</span><span class="op">(</span><span class="va">DoseLevels1</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">3</span>, ylab <span class="op">=</span> <span class="st">"Values"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">myTruthEff1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">td30</span>, <span class="fl">0.3</span>, col <span class="op">=</span> <span class="st">"violet"</span>, pch <span class="op">=</span> <span class="fl">15</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">td35</span>, <span class="fl">0.35</span>, col <span class="op">=</span> <span class="st">"violet"</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">myTruthEff1</span>, col <span class="op">=</span> <span class="st">"blue"</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">myTruthGain1</span>, col <span class="op">=</span> <span class="st">"green3"</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">gstar1</span>, <span class="va">maxg1</span>, col <span class="op">=</span> <span class="st">"green3"</span>, pch <span class="op">=</span> <span class="fl">17</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  bty <span class="op">=</span> <span class="st">"n"</span>, cex <span class="op">=</span> <span class="fl">1.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"p(DLT)=0.3"</span>, <span class="st">"p(DLT)=0.35"</span>,</span>
<span>    <span class="st">"Max gain"</span>, <span class="st">"p(DLTs)"</span>, <span class="st">"efficacy"</span>, <span class="st">"gain"</span></span>
<span>  <span class="op">)</span>, text.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"violet"</span>, <span class="st">"violet"</span>,</span>
<span>    <span class="st">"green3"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green3"</span></span>
<span>  <span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"violet"</span>, <span class="st">"violet"</span>, <span class="st">"green3"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green3"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/TruecurvesFlexi-1.png" width="576"></p>
<p>Similarly, we also get the DLT, efficacy and gain values and the
corresponding real values of the TD30, TD35 and Gstar.</p>
<p>Then after establishing the real scenarios, we can simulate the
trials. First, we will look at two examples when the
<code>Effloglog</code> class object is used as the efficacy model. We
will show first an example when no MCMC samples are involved:</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">design1</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trueDLE <span class="op">=</span> <span class="va">myTruthDLT</span>,</span>
<span>  trueEff <span class="op">=</span> <span class="va">myTruthEff</span>,</span>
<span>  trueNu <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">0.025</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">819</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>simulate</code> function is used in all cases to simulate
trials with specified scenarios. From the above, we specified the true
precision (<code>trueNu</code>) of the efficacy responses be 1/0.025. In
other words, we used a value of 0.025 as the true variance of the
efficacy responses in this simulation. For the arguments
<code>args</code>,<code>nsim</code>, <code>seed</code> and
<code>parallel</code>, please refer to earlier examples for details for
their specification and description details.</p>
<p>When MCMC samples are used, we can also specify the simulations in a
similar way with an additional argument <code>mcmcOptions</code> such
that we have</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">design2</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trueDLE <span class="op">=</span> <span class="va">myTruthDLT</span>,</span>
<span>  trueEff <span class="op">=</span> <span class="va">myTruthEff</span>,</span>
<span>  trueNu <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">0.025</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">819</span>,</span>
<span>  mcmcOptions <span class="op">=</span> <span class="va">options</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When the <code>EffFlexi</code> class object is used as the efficacy
model, we will generate the simulations as follows:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sim3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">design3</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trueDLE <span class="op">=</span> <span class="va">myTruthDLT</span>,</span>
<span>  trueEff <span class="op">=</span> <span class="va">myTruthEff1</span>,</span>
<span>  trueSigma2 <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  trueSigma2betaW <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  mcmcOptions <span class="op">=</span> <span class="va">options</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">819</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the specification of the arguments <code>object</code>,
<code>args</code>, <code>trueDLE</code>, <code>trueEff</code>,
<code>mcmcOptions</code>,<code>nsim</code>,<code>seed</code>,<code>parallel</code>
please refer to earlier examples for details. In addition, two arguments
have to be used when the <code>EffFlexi</code> class efficacy model is
used for the simulations: First, <code>trueSigma2</code> has to be
specified as the true variance of the efficacy responses and
<code>trueSigma2betaW</code> as the true variance of the random walk
model to be used in the simulation.</p>
<p>Furthermore, we can also plot, summarize and plot the summary of the
simulated results using <code>plot</code> and <code>summary</code>
function:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sim1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Note: method with signature 'PseudoSimulations#missing' chosen for function 'plot',</span></span>
<span><span class="co">##  target signature 'PseudoDualSimulations#missing'.</span></span>
<span><span class="co">##  "GeneralSimulations#missing" would also be valid</span></span></code></pre>
<p><img src="example_files/figure-html/plotsimulationresults1-1.png" width="576"></p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sim2</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotsimulationresults2-1.png" width="576"></p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sim3</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/plotsimulationresults3-1.png" width="576"></p>
<p>The plots give an overview of the final dose recommendations and
trial trajectories. In addition, they also give a summary of the
efficacy variance and also the random walk model variance when the
<code>EffFlexi</code> class object is used for the efficacy model.</p>
<p>Then, the summary and the plot of the summary of the simulations can
be obtained by:</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sum1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Sim1</span>,</span>
<span>  trueDLE <span class="op">=</span> <span class="va">myTruthDLT</span>,</span>
<span>  trueEff <span class="op">=</span> <span class="va">myTruthEff</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Sum1</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 10 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target probability of DLE p(DLE) used at the end of a trial was 30 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used at the end of a trial, TDEOT, was 152.6195 </span></span>
<span><span class="co">## TDEOT at dose Grid was 150 </span></span>
<span><span class="co">## Target p(DLE) used during a trial was 35 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used during a trial, TDDT, was 155.972 </span></span>
<span><span class="co">## TDDT at dose Grid was 150 </span></span>
<span><span class="co">## Number of patients overall : mean 16 (15, 19) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used at the end of a trial : mean 3 (3, 3) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used during a trial : mean 3 (3, 3) </span></span>
<span><span class="co">## Proportions of observed DLT in the trials : mean 21 % (20 %, 23 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients : mean 21 % (20 %, 21 %) </span></span>
<span><span class="co">## Doses selected as TDEOT : mean 100 (97.5, 102.5) </span></span>
<span><span class="co">## True toxicity at TDEOT : mean 1 % (0 %, 1 %) </span></span>
<span><span class="co">## Proportion of trials selecting the TDEOT: 0 %</span></span>
<span><span class="co">## Proportion of trials selecting the TDDT: 0 %</span></span>
<span><span class="co">## Dose most often selected as TDEOT: 100 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 0 %</span></span>
<span><span class="co">## Fitted probabilities of DLE at dose most often selected : mean 24 % (24 %, 24 %) </span></span>
<span><span class="co">## The summary table of the final TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    98.18  123.81  123.81  122.23  123.81  133.63  </span></span>
<span><span class="co">## The summary table of the final ratios of the TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    3.849   4.447   4.447   4.442   4.447   4.993  </span></span>
<span><span class="co">## The summary table of the final TDDT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    118.2   144.4   144.4   143.5   144.4   161.5  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    98.18  123.81  123.81  122.23  123.81  133.63  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##                   all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    3.849   4.447   4.447   4.442   4.447   4.993  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target Gstar, the dose which gives the maximum gain value was 130.0097 </span></span>
<span><span class="co">## Target Gstar at dose Grid was 125 </span></span>
<span><span class="co">## The summary table of the final Gstar across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    142.9   146.7   152.1   152.6   153.1   178.6  </span></span>
<span><span class="co">## The summary table of the final ratios of the Gstar across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    6.807   6.985   7.188   7.691   7.472  10.729  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    98.18  123.81  123.81  122.23  123.81  133.63  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##         all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    3.849   4.447   4.447   4.442   4.447   4.993  </span></span>
<span><span class="co">## Fitted expected efficacy level at dose most often selected : mean 0.9 (0.9, 1)</span></span></code></pre>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sum1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/summarysimulationresults1-1.png" width="576"></p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sum2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Sim2</span>,</span>
<span>  trueDLE <span class="op">=</span> <span class="va">myTruthDLT</span>,</span>
<span>  trueEff <span class="op">=</span> <span class="va">myTruthEff</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Sum2</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 10 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target probability of DLE p(DLE) used at the end of a trial was 30 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used at the end of a trial, TDEOT, was 152.6195 </span></span>
<span><span class="co">## TDEOT at dose Grid was 150 </span></span>
<span><span class="co">## Target p(DLE) used during a trial was 35 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used during a trial, TDDT, was 155.972 </span></span>
<span><span class="co">## TDDT at dose Grid was 150 </span></span>
<span><span class="co">## Number of patients overall : mean 45 (36, 51) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used at the end of a trial : mean 8 (3, 12) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used during a trial : mean 8 (3, 12) </span></span>
<span><span class="co">## Proportions of observed DLT in the trials : mean 19 % (17 %, 20 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients : mean 19 % (15 %, 25 %) </span></span>
<span><span class="co">## Doses selected as TDEOT : mean 120 (100, 125) </span></span>
<span><span class="co">## True toxicity at TDEOT : mean 4 % (1 %, 5 %) </span></span>
<span><span class="co">## Proportion of trials selecting the TDEOT: 0 %</span></span>
<span><span class="co">## Proportion of trials selecting the TDDT: 0 %</span></span>
<span><span class="co">## Dose most often selected as TDEOT: 125 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 6 %</span></span>
<span><span class="co">## Fitted probabilities of DLE at dose most often selected : mean 25 % (23 %, 27 %) </span></span>
<span><span class="co">## The summary table of the final TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    115.0   127.6   135.9   132.4   138.6   143.8  </span></span>
<span><span class="co">## The summary table of the final ratios of the TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##        1       1       1       1       1       1  </span></span>
<span><span class="co">## The summary table of the final TDDT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    133.2   151.0   155.9   154.2   159.3   168.8  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    115.0   127.6   135.9   132.4   138.6   143.8  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##                   all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##        1       1       1       1       1       1  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target Gstar, the dose which gives the maximum gain value was 130.0097 </span></span>
<span><span class="co">## Target Gstar at dose Grid was 125 </span></span>
<span><span class="co">## The summary table of the final Gstar across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    150.0   175.0   187.5   182.5   200.0   200.0  </span></span>
<span><span class="co">## The summary table of the final ratios of the Gstar across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##      2.4     2.4     2.4     2.4     2.4     2.4  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    115.0   127.6   135.9   132.4   138.6   143.8  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##         all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##        1       1       1       1       1       1  </span></span>
<span><span class="co">## Fitted expected efficacy level at dose most often selected : mean 1 (1, 1)</span></span></code></pre>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sum2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/summarysimulationresults2-1.png" width="576"></p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sum3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Sim3</span>,</span>
<span>  trueDLE <span class="op">=</span> <span class="va">myTruthDLT</span>,</span>
<span>  trueEff <span class="op">=</span> <span class="va">myTruthEff1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Sum3</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary of 10 simulations</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target probability of DLE p(DLE) used at the end of a trial was 30 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used at the end of a trial, TDEOT, was 152.6195 </span></span>
<span><span class="co">## TDEOT at dose Grid was 150 </span></span>
<span><span class="co">## Target p(DLE) used during a trial was 35 %</span></span>
<span><span class="co">## The dose level corresponds to the target p(DLE) used during a trial, TDDT, was 155.972 </span></span>
<span><span class="co">## TDDT at dose Grid was 150 </span></span>
<span><span class="co">## Number of patients overall : mean 50 (39, 58) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used at the end of a trial : mean 8 (6, 12) </span></span>
<span><span class="co">## Number of patients treated above the target p(DLE) used during a trial : mean 8 (6, 12) </span></span>
<span><span class="co">## Proportions of observed DLT in the trials : mean 21 % (18 %, 24 %) </span></span>
<span><span class="co">## Mean toxicity risks for the patients : mean 20 % (15 %, 24 %) </span></span>
<span><span class="co">## Doses selected as TDEOT : mean 115 (100, 125) </span></span>
<span><span class="co">## True toxicity at TDEOT : mean 3 % (1 %, 5 %) </span></span>
<span><span class="co">## Proportion of trials selecting the TDEOT: 0 %</span></span>
<span><span class="co">## Proportion of trials selecting the TDDT: 0 %</span></span>
<span><span class="co">## Dose most often selected as TDEOT: 125 </span></span>
<span><span class="co">## Observed toxicity rate at dose most often selected: 4 %</span></span>
<span><span class="co">## Fitted probabilities of DLE at dose most often selected : mean 27 % (25 %, 28 %) </span></span>
<span><span class="co">## The summary table of the final TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    113.1   123.7   127.0   127.0   130.0   137.2  </span></span>
<span><span class="co">## The summary table of the final ratios of the TDEOT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##        1       1       1       1       1       1  </span></span>
<span><span class="co">## The summary table of the final TDDT across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    128.9   143.6   149.2   149.0   154.4   169.5  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    113.1   123.7   127.0   127.0   130.0   137.2  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##                   all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##        1       1       1       1       1       1  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Target Gstar, the dose which gives the maximum gain value was 125 </span></span>
<span><span class="co">## Target Gstar at dose Grid was 125 </span></span>
<span><span class="co">## The summary table of the final Gstar across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    250.0   250.0   250.0   262.5   275.0   300.0  </span></span>
<span><span class="co">## The summary table of the final ratios of the Gstar across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    1.333   1.500   1.857   1.938   2.000   3.000  </span></span>
<span><span class="co">## The summary table of dose levels, the optimal dose</span></span>
<span><span class="co">##  to recommend for subsequent study across all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##    113.1   123.7   127.0   127.0   130.0   137.2  </span></span>
<span><span class="co">## The summary table of the final ratios of the optimal dose for stopping across</span></span>
<span><span class="co">##         all simulations</span></span>
<span><span class="co">##     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  </span></span>
<span><span class="co">##        1       1       1       1       1       1  </span></span>
<span><span class="co">## Fitted expected efficacy level at dose most often selected : mean 0.9 (0.9, 1)</span></span></code></pre>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sum3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_files/figure-html/summarysimulationresults3-1.png" width="576"></p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># nolint end</span></span></code></pre></div>
<p>In the first simulation, <code>Sim1</code> the trial will only stop
when the ratio of the 95% credibility interval bounds of the current
estimate of the minimum between TD30(TDtargetEndOfTrial) and Gstar is
less than or equal to 5. The last two simulations, <code>Sim2</code> and
<code>Sim3</code>, use trials which only stop either when a maximum of
72 patients has been treated or when the ratio of the 95% credibility
interval is less than or equal to 5. We can see that in all of the above
simulations all trials require a total of around 60 patients for a
study.</p>
<p>As a reminder, for the dual endpoint dose escalation design which
uses two separate models to describe the dose-responses relationship,
the gain function is used to determine the next best dose and the final
recommended dose at the end of a trial. More specifically at the end of
a trial, we will recommend the dose level closest below which is the
minimum of final estimate of the TD30 (TDtargetEndOfTrial) and
Gstar.</p>
<p>The DLT and efficacy scenario that we used for the first,
<code>Sim1</code> and the second simulations, <code>Sim2</code> are the
same. The real TD30 (TDtargetEndOfTrial) is given in the summary and is
152.6125 mg and the dose level at doseGrid which is closest and below
this real TD30 is 150 mg. The real Gstar is 130.0097 mg and the dose
level in the dose grid closest to this Gstar is 125 mg.</p>
<p>In this case, the real Gstar is less than the real TD30 and we will
expect most of the recommendations to be made at a dose level close to
the real Gstar. In other words, under this scenario, we will expect most
of the recommendations made at 125 mg. We can see that the simulated
results agrees to what we are expecting. From the summaries and the
plots of the summaries, 125 mg is the dose level which is selected most
often in both of these simulations.</p>
<p>For the scenario of last simulation, <code>Sim3</code>, we have the
same real TD30 and the real Gstar is 125 mg. Since the real TD30 is
greater than the real Gstar, we will also expect recommendations should
be made close to the real Gstar under this scenario. We can see that
from the simulated results in the summary or the plot of summary, the
procedure also recommends 125 mg most often in the simulations, which
agrees with our real scenario.</p>
<p>Now, we will also look at the fitted dose-DLT and dose-efficacy
curves obtained under all these three simulations. From the plots of
summaries, we can see that in all cases, the fitted dose-DLT curves
(solid-red curve) do not approximate very well to the real dose-DLT
curve (solid-black curve). The 95% credibility interval of the DLT curve
(broken-red curves) is also given when MCMC samples are involved in the
simulation. In contrast, we can see that the fitted efficacy curve
(solid-blue curve) gives a very good fit to the real efficacy curve
(solid-black) in all cases. The approximation to the real efficacy curve
is better when the linear linear log-log model, <code>Effloglog</code>
is used, compared to when the flexible form , <code>EffFlexi</code> is
used. In addition, we can also see the 95% credibility interval of the
efficacy curve (broken-blue line) when MCMC sampling of the efficacy
responses is involved.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Neuenschwander2008" class="csl-entry">
Neuenschwander, Beat, Michael Branson, and Thomas Gsponer. 2008.
<span>“<span class="nocase">Critical aspects of the Bayesian approach to
phase I cancer trials.</span>”</span> <em>Statistics in Medicine</em> 27
(13): 2420–39. <a href="http://onlinelibrary.wiley.com/doi/10.1002/sim.3230" class="external-link">http://onlinelibrary.wiley.com/doi/10.1002/sim.3230</a>.
</div>
<div id="ref-WhiteheadWilliamson1998" class="csl-entry">
Whitehead, J., and D. Williamson. 1998. <span>“<span class="nocase">Bayesian decision procedures based on logistic regression
models for dose-finding studies</span>.”</span> <em>Journal of
Biopharmaceutical Statistics</em> 8 (3): 445–67.
</div>
<div id="ref-wy15" class="csl-entry">
Yeung, W. Y., J. Whitehead, B. Reigner, U. Beyer, C. Diack, and T. Jaki.
2015. <span>“Bayesian Adaptive Dose-Escalation Procedure for Binary and
Continuous Responses Utilizing a Gain Function.”</span>
<em>Pharmaceutical Statistics</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Sabanes Bove, Wai Yin Yeung, Burak Kuersad Guenhan, Giuseppe Palermo, Thomas Jaki, Jiawen Zhu, Ziwei Liao, Dimitris Kontos, Marlene Schulte-Goebel, Doug Kelkhoff, Oliver Boix, Robert Adams, Clara Beck, John Kirkpatrick, F. Hoffmann-La Roche AG, Merck Healthcare KGaA, Bayer AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
