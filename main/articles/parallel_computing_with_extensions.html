<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Parallel computing with extensions • crmPack</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parallel computing with extensions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">crmPack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/trial_definition.html">Trial Definition</a></li>
    <li><a class="dropdown-item" href="../articles/trial_analysis.html">Trial Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/trial_sanity_checks.html">Trial Design: basic sanity checks</a></li>
    <li><a class="dropdown-item" href="../articles/trial_simulation.html">Trial Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/ordinal-crm.html">Ordinal CRM</a></li>
    <li><a class="dropdown-item" href="../articles/rolling-crm.html">Rolling CRM Example</a></li>
    <li><a class="dropdown-item" href="../articles/simulations.html">Simulation study example</a></li>
    <li><a class="dropdown-item" href="../articles/knit_print.html">Describing `crmPack` Objects</a></li>
    <li><a class="dropdown-item" href="../articles/tidy_method.html">Using tidy</a></li>
    <li><a class="dropdown-item" href="../articles/migration_from_the_old_crmPack.html">Migrating from crmPack version 1.0.3</a></li>
    <li><a class="dropdown-item" href="../articles/parallel_computing_with_extensions.html">Parallel computing with extensions</a></li>
    <li><a class="dropdown-item" href="../articles/crmPack-jss-paper.html">Model-based Dose Escalation Designs in R with crmPack (JSS manuscript)</a></li>
    <li><a class="dropdown-item" href="../articles/example.html">crmPack: Object-oriented implementation of CRM designs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/crmPack/main">main</a> </div></li>
<!-- end dropdown for versions -->
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/crmPack"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Parallel computing with extensions</h1>
                        <h4 data-toc-skip class="author">Oliver
Boix</h4>
            
            <h4 data-toc-skip class="date">14 March 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/crmPack/blob/main/vignettes/parallel_computing_with_extensions.Rmd" class="external-link"><code>vignettes/parallel_computing_with_extensions.Rmd</code></a></small>
      <div class="d-none name"><code>parallel_computing_with_extensions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>One of the big advantages of <code>crmPack</code> over existing R
implementations is its flexible framework based on the S4 classes and
methods system <span class="citation">(Chambers 2008)</span>. Users can
extend the existing functionality easily to the specific needs of the
study <span class="citation">(Sabanes Bove et al. 2019)</span>.</p>
<p>User defined extensions of classes and methods can be easily created
and used together with existing <code>crmPack</code> classes and methods
when setting up the study and performing analysis with observed data. As
long as no parallel computing is used, no special care needs to be taken
utilizing both native and user defined classes and methods. When trial
simulations need to be performed to derive the operational
characteristics of a study setup, run times may become long with single
core processing. The run time depends mainly on the number of study
replications and MCMC samples. In cases of long run times, utilizing
parallel computing, i.e., using multiple CPU cores, can overcome these
challenge and decrease run times significantly.</p>
<p>Parallel computing is supported by <code>crmPack</code> by design,
i.e., whenever the simulation call is invoked with parameters
<code>parallel = TRUE</code> and <code>nCores =</code> more than one
CPU, each core is initialized with the <code>crmPack</code> package and
the global environment.</p>
<p>Due to the nature of the S4 object system, user defined classes and
method that were defined in the global environment cannot just be made
available at each core by initializing the core with the global
environment. User defined classes and method needs to be executed at any
core that is initialized to warrant full functionality of the S4
objects.</p>
<p>The following paragraphs provide an example of how user defined
extensions can be used utilizing parallel computing within
<code>crmPack</code>.</p>
</div>
<div class="section level2">
<h2 id="high-level-usage">High level usage<a class="anchor" aria-label="anchor" href="#high-level-usage"></a>
</h2>
<p>To use user written extension with parallel computing and
<code>crmPack</code>, the user written code needs to be embedded in a
function. This function will be stored in the value of a global option
with the fixed name <code>crmpack_extensions</code>. The existence of
the global option is evaluated when parallel computing is requested. In
case the option <code>crmpack_extensions</code> exists, the content is
submitted to any node of the cluster, so that the user written S4
classes and methods are available along with the <code>crmPack</code>
package.</p>
<p>The following code show at a high level, how the option is
utilized.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  crmpack_extensions <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># ..... user code .....</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="important-information-for-usage">Important information for usage<a class="anchor" aria-label="anchor" href="#important-information-for-usage"></a>
</h2>
<p>When operation characteristics of the design needs to be derived
utilizing parallel computing, the simulation function must be executed
with the parameter <code>parallel = TRUE</code> and
<code>nCores =</code> a number greater than one. In this case, it is
evaluated if a global option with the name
<code>crmpack_extensions</code> exists. If this is true, the value of
the global option <code>crmpack_extensions</code> is executed at each
core at the time of initialization, i.e., the character string that is
equal to the global option <code>crmpack_extensions</code> is executed
at any core of the cluster, so that the code is available for the use
with parallel computing.</p>
<p>Please note that the wrapper function that holds the user extensions
is the most convenient way to hand over <code>class</code> and
<code>method</code> definitions and the user constructor function to the
<code>crmpack_extensions</code> option. However, the constructor
function must be available in the environment from which it is called.
When the extensions are directly coded within the wrapper function, the
<code>&lt;&lt;-</code> operator must be used for any new user defined
constructor function that is defined within the wrapper function. The
<code>&lt;&lt;-</code> operator will force a function to become visible
within the global environment. Another possibility is to store the user
extensions in a file that is sourced within the wrapper function. In
this case user defined constructor function can be assigned with the
regular <code>&lt;-</code> operator, as source parse the content of the
file in the environment.</p>
<p>To avoid errors it is important to understand that packages attached
to the current environment are not available at the workers environment.
I.e., even though the code may work without any problems when used with
single core processing, it may fail in parallel execution as functions
are not attached to the workers environment. Therefore it is necessary
to make sure that all called functions are available in the workers
environment. This can be achieved by including a <code>library</code>
statement within the wrapper function or by using the double colon
operator <code>::</code>.</p>
<p>Any of the above described usage options are further detailed in the
example.</p>
</div>
<div class="section level2">
<h2 id="information-for-debugging">Information for debugging<a class="anchor" aria-label="anchor" href="#information-for-debugging"></a>
</h2>
<p>It is expected as a good practice, that any new written extension is
first tested and validated with one CPU core, before utilizing the
global option <code>crmpack_extensions</code>. It is important to
understand that the character string that is the value of the global
option <code>crmpack_extensions</code> is executed directly at each core
and will not be checked for validity or correctness. In case that the
code run into errors, the returned error message while using parallel
computing may be misleading and may not help to identify the root cause
of problem. Debugging of newly written code is much easier without using
parallel computing.</p>
</div>
<div class="section level2">
<h2 id="worked-out-example">Worked out example<a class="anchor" aria-label="anchor" href="#worked-out-example"></a>
</h2>
<p>Let us assume we want to utilize a two-parameter logistic regression
model, where the slope parameter should have only positive values, with
a normal prior that is truncated for the slope parameter, so that the
slope can have only positive values. In this case we want to set the
prior distribution of the slope parameter to be a truncated normal
distribution bounded by zero on the lower end. This model representation
is not part of the <code>crmPack</code> package but can easily be added
as shown below. Please note that for this example the extra code is
directly inserted into the option <code>crmpack_extensions</code> as a
function. As mentioned before, user should write and test their code
first without embedding it into a function which is set equal to the
option <code>crmpack_extensions</code>, to assure that no errors occur
during the whole execution and the results are as expected.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/openpharma/crmPack" class="external-link">crmPack</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_own_extension</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Attach the package checkmate with library(checkmate) here, to avoid usage of</span></span>
<span>  <span class="co"># the :: operator in the code below.</span></span>
<span></span>
<span>  <span class="co"># LogisticNormalTruncPrior ----</span></span>
<span></span>
<span>  <span class="co">## class ----</span></span>
<span></span>
<span>  <span class="co">#' `LogisticNormalTruncPrior`</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @description `r lifecycle::badge("experimental")`</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' [`LogisticNormalTruncPrior`] is the class for the usual logistic regression</span></span>
<span>  <span class="co">#'  model with bivariate normal prior on the intercept and slope.</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @aliases LogisticNormalTruncPrior</span></span>
<span>  <span class="co">#' @export</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @slot mean1 the mean of the intercept</span></span>
<span>  <span class="co">#' @slot mean2 the mean of the slope</span></span>
<span>  <span class="co">#' @slot var1 the variance of the intercept</span></span>
<span>  <span class="co">#' @slot var2 the variance of the slope</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="va">.LogisticNormalTruncPrior</span> <span class="op">&lt;-</span> <span class="kw">setClass</span><span class="op">(</span></span>
<span>    Class <span class="op">=</span> <span class="st">"LogisticNormalTruncPrior"</span>,</span>
<span>    contains <span class="op">=</span> <span class="st">"GeneralModel"</span>,</span>
<span>    slots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      mean1 <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>      mean2 <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>      var1 <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>      var2 <span class="op">=</span> <span class="st">"numeric"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">## constructor ----</span></span>
<span></span>
<span>  <span class="co">#' @rdname LogisticNormalTruncPrior-class</span></span>
<span></span>
<span>  <span class="co">#' Initialization function for the `LogisticNormalTruncPrior` class</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @param mean1 the mean of the intercept</span></span>
<span>  <span class="co">#' @param mean2 the mean of the slope</span></span>
<span>  <span class="co">#' @param var1 the variance of the intercept</span></span>
<span>  <span class="co">#' @param var2 the variance of the slope</span></span>
<span>  <span class="co">#' @return the \code{\linkS4class{LogisticNormalTruncPrior}} object</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @export</span></span>
<span>  <span class="co">#' @keywords methods</span></span>
<span>  <span class="va">LogisticNormalTruncPrior</span> <span class="op">&lt;&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mean1</span>, <span class="va">mean2</span>, <span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">.LogisticNormalTruncPrior</span><span class="op">(</span></span>
<span>      mean1 <span class="op">=</span> <span class="va">mean1</span>,</span>
<span>      mean2 <span class="op">=</span> <span class="va">mean2</span>,</span>
<span>      var1 <span class="op">=</span> <span class="va">var1</span>,</span>
<span>      var2 <span class="op">=</span> <span class="va">var2</span>,</span>
<span>      datamodel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nObs</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dbern</span><span class="op">(</span><span class="va">mean</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="../reference/logit.html">logit</a></span><span class="op">(</span><span class="va">mean</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">alpha0</span> <span class="op">+</span> <span class="va">alpha1</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span>,</span>
<span>      priormodel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">alpha0</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">mean1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">var1</span><span class="op">)</span></span>
<span>        <span class="va">alpha1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">mean2</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">var2</span><span class="op">)</span> <span class="op">%_%</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      datanames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nObs"</span>, <span class="st">"y"</span>, <span class="st">"x"</span><span class="op">)</span>,</span>
<span>      modelspecs <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          mean1 <span class="op">=</span> <span class="va">mean1</span>,</span>
<span>          mean2 <span class="op">=</span> <span class="va">mean2</span>,</span>
<span>          var1 <span class="op">=</span> <span class="va">var1</span>,</span>
<span>          var2 <span class="op">=</span> <span class="va">var2</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      init <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha0 <span class="op">=</span> <span class="va">mean1</span>, alpha1 <span class="op">=</span> <span class="va">mean2</span><span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha0"</span>, <span class="st">"alpha1"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">## dose ----</span></span>
<span></span>
<span>  <span class="co">#' @describeIn dose compute the dose level reaching a specific toxicity</span></span>
<span>  <span class="co">#'   probability.</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @aliases dose-LogisticNormalTruncPrior</span></span>
<span>  <span class="co">#' @export</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="kw">setMethod</span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>    signature <span class="op">=</span> <span class="fu">signature</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>      model <span class="op">=</span> <span class="st">"LogisticNormalTruncPrior"</span>,</span>
<span>      samples <span class="op">=</span> <span class="st">"Samples"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">model</span>, <span class="va">samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">checkmate</span><span class="fu">::</span><span class="fu">assert_probabilities</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://mllg.github.io/checkmate/reference/checkSubset.html" class="external-link">assert_subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha0"</span>, <span class="st">"alpha1"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="../reference/check_length.html">assert_length</a></span><span class="op">(</span><span class="va">x</span>, len <span class="op">=</span> <span class="fu"><a href="../reference/size.html">size</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">alpha0</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">alpha0</span></span>
<span>      <span class="va">alpha1</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">alpha1</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="../reference/logit.html">logit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="va">alpha0</span><span class="op">)</span> <span class="op">/</span> <span class="va">alpha1</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co">## prob ----</span></span>
<span></span>
<span>  <span class="co">#' @describeIn prob compute the toxicity probability of a specific dose.</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="co">#' @aliases prob-LogisticNormalTruncPrior</span></span>
<span>  <span class="co">#' @export</span></span>
<span>  <span class="co">#'</span></span>
<span>  <span class="kw">setMethod</span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"prob"</span>,</span>
<span>    signature <span class="op">=</span> <span class="fu">signature</span><span class="op">(</span></span>
<span>      dose <span class="op">=</span> <span class="st">"numeric"</span>,</span>
<span>      model <span class="op">=</span> <span class="st">"LogisticNormalTruncPrior"</span>,</span>
<span>      samples <span class="op">=</span> <span class="st">"Samples"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dose</span>, <span class="va">model</span>, <span class="va">samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://mllg.github.io/checkmate/reference/checkNumeric.html" class="external-link">assert_numeric</a></span><span class="op">(</span></span>
<span>        <span class="va">dose</span>,</span>
<span>        lower <span class="op">=</span> <span class="fl">0L</span>, any.missing <span class="op">=</span> <span class="cn">FALSE</span>, min.len <span class="op">=</span> <span class="fl">1</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://mllg.github.io/checkmate/reference/checkSubset.html" class="external-link">assert_subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha0"</span>, <span class="st">"alpha1"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="../reference/check_length.html">assert_length</a></span><span class="op">(</span><span class="va">dose</span>, len <span class="op">=</span> <span class="fu"><a href="../reference/size.html">size</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">alpha0</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">alpha0</span></span>
<span>      <span class="va">alpha1</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">alpha1</span></span>
<span>      <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha0</span> <span class="op">-</span> <span class="va">alpha1</span> <span class="op">*</span> <span class="va">dose</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>After the new code is defined and embedded into a function, we can
store the function as value of a global option, which we will name
<code>crmpack_extensions</code>.</p>
<p>Please note that <code>&lt;&lt;-</code>operator is used to assign the
<code>LogisticNormalTruncPrior</code> function to the global
environment. The assertion functions from the package
<code>checkmate</code> are referenced by the double colon operator in
this example. In case that the package <code>checkmate</code> is
attached within the function, i.e., the statement
<code><a href="https://mllg.github.io/checkmate/" class="external-link">library(checkmate)</a></code> is used in the code above, the direct
reference <code>checkmate::</code> can be removed. Either way works with
parallel computing as this makes sure that the functions can be used in
the current environment and at the workers when parallel study
simulations are performed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store the function into the global option crmpack_extensions.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>crmpack_extensions <span class="op">=</span> <span class="va">my_own_extension</span><span class="op">)</span></span></code></pre></div>
<p>Now we are able to use the newly created model
<code>LogisticNormalTruncPrior</code> to set up a study. First, we get
the value from the global option <code>crmpack_extensions</code>, which
is the function that we have defined above. Then we execute the function
within the global environment, so that the constructor function and the
corresponding classes and methods for <code>prob</code> and
<code>dose</code> become available.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Execute the user written extensions.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"crmpack_extensions"</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next we can set up the study with the new model and desired design
features.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the dose grid.</span></span>
<span><span class="va">emptydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  doseGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">120</span>, <span class="fl">160</span>, <span class="fl">240</span>, <span class="fl">320</span>,</span>
<span>    <span class="fl">480</span>, <span class="fl">640</span>, <span class="fl">960</span>, <span class="fl">1280</span>, <span class="fl">1920</span>, <span class="fl">2400</span>, <span class="fl">3000</span>, <span class="fl">4000</span></span>
<span>  <span class="op">)</span>,</span>
<span>  placebo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data for basic testing of the setup.</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">80</span>, <span class="fl">80</span>, <span class="fl">160</span>, <span class="fl">160</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">emptydata</span><span class="op">@</span><span class="va">doseGrid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Setup the model.</span></span>
<span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu">LogisticNormalTruncPrior</span><span class="op">(</span></span>
<span>  mean1 <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>,</span>
<span>  mean2 <span class="op">=</span> <span class="fl">0.00075</span>,</span>
<span>  var1 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  var2 <span class="op">=</span> <span class="fl">0.000009</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Options used for simulations.</span></span>
<span><span class="va">my_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span></span>
<span>  burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  rng_kind <span class="op">=</span> <span class="st">"Mersenne-Twister"</span>,</span>
<span>  rng_seed <span class="op">=</span> <span class="fl">94</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create mcmc samples.</span></span>
<span><span class="va">my_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="va">my_model</span>, <span class="va">my_options</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the dose toxicity curve.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_samples</span>, <span class="va">my_model</span>, <span class="va">my_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify increments.</span></span>
<span><span class="va">my_increments</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IncrementsRelativeDLT-class.html">IncrementsRelativeDLT</a></span><span class="op">(</span></span>
<span>  intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  increments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Maximum dose.</span></span>
<span><span class="va">this_max_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">my_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Next best dose.</span></span>
<span><span class="va">my_next_best</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NextBestMinDist-class.html">NextBestMinDist</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">this_next_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>, <span class="va">this_max_dose</span>, <span class="va">my_samples</span>, <span class="va">my_model</span>, <span class="va">my_data</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span></span>
<span><span class="co"># Stopping rule.</span></span>
<span><span class="va">my_stopping</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StoppingPatientsNearDose-class.html">StoppingPatientsNearDose</a></span><span class="op">(</span>nPatients <span class="op">=</span> <span class="fl">9</span>, percentage <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stop trial based on criteria and observed data.</span></span>
<span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span><span class="va">my_stopping</span>, <span class="va">this_next_dose</span>, <span class="va">my_samples</span>, <span class="va">my_model</span>, <span class="va">my_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cohorts size.</span></span>
<span><span class="va">my_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CohortSizeDLT-class.html">CohortSizeDLT</a></span><span class="op">(</span></span>
<span>  intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Design.</span></span>
<span><span class="va">my_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Design-class.html">Design</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">my_model</span>,</span>
<span>  nextBest <span class="op">=</span> <span class="va">my_next_best</span>,</span>
<span>  stopping <span class="op">=</span> <span class="va">my_stopping</span>,</span>
<span>  increments <span class="op">=</span> <span class="va">my_increments</span>,</span>
<span>  cohort_size <span class="op">=</span> <span class="va">my_size</span>,</span>
<span>  data <span class="op">=</span> <span class="va">emptydata</span>,</span>
<span>  startingDose <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After setting up the model and the design features, it is very useful
to check the model decisions in case that no DLT is observed until a
certain dose level before any study simulations are performed. This
check can also serve as additional test for the new written code.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Examine the design.</span></span>
<span><span class="fu"><a href="../reference/examine.html">examine</a></span><span class="op">(</span><span class="va">my_design</span>, <span class="va">my_options</span><span class="op">)</span></span></code></pre></div>
<p>When examine runs as expected, study simulations can be performed. To
demonstrate the difference between single core processing and multiple
core processing, two scenarios where processed with single core
processing, followed by 5 scenarios utilizing parallel computing.</p>
<p>With regard to run times in this example, please see the <a href="#note">note</a> at the end of the vignette.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up scenarios</span></span>
<span><span class="va">scenario_setup</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">intercept</span>, <span class="va">mtd_prob</span>, <span class="va">mtd_dose</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/probFunction.html">probFunction</a></span><span class="op">(</span></span>
<span>    <span class="va">my_model</span>,</span>
<span>    alpha0 <span class="op">=</span> <span class="fu"><a href="../reference/logit.html">logit</a></span><span class="op">(</span><span class="va">intercept</span><span class="op">)</span>,</span>
<span>    alpha1 <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="../reference/logit.html">logit</a></span><span class="op">(</span><span class="va">mtd_prob</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="../reference/logit.html">logit</a></span><span class="op">(</span><span class="va">intercept</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">mtd_dose</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">safe_scenario</span> <span class="op">&lt;-</span> <span class="fu">scenario_setup</span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.3</span>, <span class="fl">20000</span><span class="op">)</span></span>
<span><span class="va">late_scenario</span> <span class="op">&lt;-</span> <span class="fu">scenario_setup</span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.3</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">early_scenario</span> <span class="op">&lt;-</span> <span class="fu">scenario_setup</span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.3</span>, <span class="fl">700</span><span class="op">)</span></span>
<span><span class="va">toxic_scenario</span> <span class="op">&lt;-</span> <span class="fu">scenario_setup</span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">peak_scenario</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">dose</span>,</span>
<span>    <span class="va">scenario</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">emptydata</span><span class="op">@</span><span class="va">doseGrid</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">11</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">scenario</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">dose</span>, <span class="va">scenario</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Helper function that outputs the elapsed time.</span></span>
<span><span class="va">report_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">report_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, usetz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="va">report_text</span>,</span>
<span>    <span class="st">"done - elapsed time from start:"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">start_time</span>, units <span class="op">=</span> <span class="st">"mins"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"\n"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Helper function that simulates a specific truth.</span></span>
<span><span class="va">get_oc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">truth</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span></span>
<span>    <span class="va">my_design</span>,</span>
<span>    args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    truth <span class="op">=</span> <span class="va">truth</span>,</span>
<span>    nsim <span class="op">=</span> <span class="va">my_nsim</span>,</span>
<span>    mcmcOptions <span class="op">=</span> <span class="va">my_options</span>,</span>
<span>    parallel <span class="op">=</span> <span class="va">do_parallel</span>,</span>
<span>    nCores <span class="op">=</span> <span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># get operation characteristics without utilizing parallel computing for</span></span>
<span><span class="co"># selected truth (to reduce the run time).</span></span>
<span><span class="va">time_no_parallel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, usetz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"start"</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">my_nsim</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="va">do_parallel</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span>  <span class="va">safe</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">safe_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"safe (single core processing)"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">late</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">late_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"late (single core processing)"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>When simulations with single core processing are running successful,
the full operation characteristics utilizing parallel computing can be
derived.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get full operation characteristics utilizing parallel computing.</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">start_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, usetz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"start"</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">my_nsim</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="va">do_parallel</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span>  <span class="va">safe</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">safe_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"safe"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">late</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">late_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"late"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">early</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">early_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"early"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">toxic</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">toxic_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"toxic"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">peak</span> <span class="op">&lt;-</span> <span class="fu">get_oc</span><span class="op">(</span><span class="va">peak_scenario</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">report_time</span><span class="op">(</span><span class="st">"peak"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="alternative-read-user-code-from-external-file">Alternative: read user code from external file<a class="anchor" aria-label="anchor" href="#alternative-read-user-code-from-external-file"></a>
</h2>
<p>As an alternative it may be more convenient to store the user
extensions in an external file and source the file in the wrapper
function. This has the advantage, that the <code>&lt;&lt;-</code>
operator is not necessary for user constructor functions and can be
replaced by the usual assignment <code>&lt;-</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Store code example form above in external file and</span></span>
<span>  <span class="co"># remove the wrapper function structure.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dump.html" class="external-link">dump</a></span><span class="op">(</span><span class="st">"my_own_extension"</span>, file <span class="op">=</span> <span class="st">"user_extension.R"</span><span class="op">)</span></span>
<span>  <span class="va">file_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">file</a></span><span class="op">(</span><span class="st">"user_extension.R"</span><span class="op">)</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">file_con</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">135</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"&lt;&lt;-"</span>, <span class="st">"&lt;-"</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">file_con</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Source the stored file in the wrapper function.</span></span>
<span>  <span class="va">my_own_extension2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"user_extension.R"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>crmpack_extensions <span class="op">=</span> <span class="va">my_own_extension2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"crmpack_extensions"</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Run the rest of the code from above example</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>The analyses presented in this vignette have used chains of a very
short length as well as a very limited number of trial simulations. This
is purely for convenience. Study simulations for real trials should use
considerably longer chains and a much higher number of trial
simulations.</p>
<p>In this example it is apparent that for small number of study
simulations, the overhead of initializing the cluster for parallel
computing, leads to longer run time of the simulations in comparison to
single core processing. However, for a relevant number of study
simulations, the substantial run time benefit utilizing parallel
computation can easily be seen.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Chambers2008" class="csl-entry">
Chambers, John. 2008. <em>Software for Data Analysis</em>. Statistics
and Computing. Springer-Verlag.
</div>
<div id="ref-SabanesBove2019" class="csl-entry">
Sabanes Bove, Daniel, Wai Yin Yeung, Giuseppe Palermo, and Thomas Jaki.
2019. <span>“Model-Based Dose Escalation Designs in r with
crmPack.”</span> <em>Journal of Statistical Software</em> 89. <a href="https://doi.org/10.18637/jss.v089.i10" class="external-link">https://doi.org/10.18637/jss.v089.i10</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Sabanes Bove, Wai Yin Yeung, Burak Kuersad Guenhan, Giuseppe Palermo, Thomas Jaki, Jiawen Zhu, Ziwei Liao, Dimitris Kontos, Marlene Schulte-Goebel, Doug Kelkhoff, Oliver Boix, Robert Adams, Clara Beck, John Kirkpatrick, F. Hoffmann-La Roche AG, Merck Healthcare KGaA, Bayer AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
