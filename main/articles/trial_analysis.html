<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="crmPack">
<title>Trial Analysis • crmPack</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trial Analysis">
<meta property="og:description" content="crmPack">
<meta property="og:image" content="https://roche.github.io/crmPack/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">crmPack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.9000.9137</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/trial_definition.html">Trial Definition</a>
    <a class="dropdown-item" href="../articles/trial_analysis.html">Trial Analysis</a>
    <a class="dropdown-item" href="../articles/trial_sanity_checks.html">Trial Design: basic sanity checks</a>
    <a class="dropdown-item" href="../articles/trial_simulation.html">Trial Simulation</a>
    <a class="dropdown-item" href="../articles/ordinal-crm.html">Ordinal CRM</a>
    <a class="dropdown-item" href="../articles/rolling-crm.html">Rolling CRM Example</a>
    <a class="dropdown-item" href="../articles/simulations.html">Simulation study example</a>
    <a class="dropdown-item" href="../articles/tidy_method.html">Using tidy</a>
    <a class="dropdown-item" href="../articles/migration_from_the_old_crmPack.html">Migrating from crmPack version 1.0.3</a>
    <a class="dropdown-item" href="../articles/parallel_computing_with_extensions.html">Parallel computing with extensions</a>
    <a class="dropdown-item" href="../articles/crmPack-jss-paper.html">Model-based Dose Escalation Designs in R with crmPack (JSS manuscript)</a>
    <a class="dropdown-item" href="../articles/example.html">crmPack: Object-oriented implementation of CRM designs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://Roche.github.io/crmPack/main">main</a> </div></li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/roche/crmPack">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="trial_analysis_files/kePrint-0.0.1/kePrint.js"></script><link href="trial_analysis_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Trial Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/roche/crmPack/blob/HEAD/vignettes/trial_analysis.Rmd" class="external-link"><code>vignettes/trial_analysis.Rmd</code></a></small>
      <div class="d-none name"><code>trial_analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette picks up where the previous one (<a href="trial_definition.html">Trial Definition</a>), ends. To recap, our
trial defines the six fundamental elements of a CRM trial as</p>
<div class="section level4">
<h4 id="the-dose-grid">The dose grid<a class="anchor" aria-label="anchor" href="#the-dose-grid"></a>
</h4>
<p>The trial will use a dose grid consisting of the following doses: 1,
3, 9, 20, 30, 45, 60, 80 and 100. The units in which doses are defined
is irrelevant to the operation of the CRM.</p>
</div>
<div class="section level4">
<h4 id="the-dose-toxicity-model">The dose-toxicity model<a class="anchor" aria-label="anchor" href="#the-dose-toxicity-model"></a>
</h4>
<p>The trial uses a logistic log Normal dose toxicity model</p>
<p><span class="math display">\[ log(\frac{p_i}{1 - p_i}) = \alpha +
\beta log(d_i / d^*) \]</span></p>
<p>where the prior joint distribution of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> is</p>
<p><span class="math display">\[
\begin{bmatrix}
\alpha \\
log(\beta)
\end{bmatrix}   \sim
N\begin{pmatrix}
\begin{bmatrix}
-0.85\\0
\end{bmatrix}   ,
\begin{bmatrix}
1 &amp; -0.5 \\
-0.5 &amp; 1
\end{bmatrix}   
\end{pmatrix}.
\]</span></p>
</div>
<div class="section level4">
<h4 id="the-increment-rule">The increment rule<a class="anchor" aria-label="anchor" href="#the-increment-rule"></a>
</h4>
<p>The maximum increment for doses greater than <code>0</code> and less
than <code>20</code> is 100 x (1 + 1)%, or 200% of the highest dose used
so far, whereas for <code>20</code> or more, the maximum increment is
100 x (1 + 0.5)%, or 150% of the highest dose used so far.</p>
<p>Note that a 2-fold <em>increment</em> corresponds to a 3-fold
<em>escalation</em>.</p>
</div>
<div class="section level4">
<h4 id="the-dose-selection-rule">The dose selection rule<a class="anchor" aria-label="anchor" href="#the-dose-selection-rule"></a>
</h4>
<p>Here, we choose to use Neuenschwander’s rule <span class="citation">(Neuenschwander, Branson, and Gsponer 2008)</span>, in
which the dose for the next cohort to be the dose (amongst those doses
that are eligible for selection according to the escalation rule) that
has the highest posterior chance of having a probability of toxicity in
the target range - here [0.2, 0.35) - provided that the dose’s chance of
having a probability in the overdose range - here [0.35, 1.0] - is less
than 0.25.</p>
</div>
<div class="section level4">
<h4 id="the-cohort-size">The cohort size<a class="anchor" aria-label="anchor" href="#the-cohort-size"></a>
</h4>
<p>Whilst the dose for the next cohort is 20 or less <em>and</em> no
DLTs have been observed, the minimum cohort size is 1. Otherwise, it is
3.</p>
</div>
<div class="section level4">
<h4 id="the-stopping-rule">The stopping rule<a class="anchor" aria-label="anchor" href="#the-stopping-rule"></a>
</h4>
<p>The trial will stop when <i>either</i></p>
<ul>
<li>Twenty patients have been recruited, or.</li>
<li>Both of the following conditions are true
<ul>
<li>At least three cohorts must have been treated AND</li>
<li>The probability that the current estimate of the MTD is in the
target toxicity range must be at least 0.5.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="trial-definition">Trial definition<a class="anchor" aria-label="anchor" href="#trial-definition"></a>
</h4>
<p>The code to define these elements of the trial design is given in the
<a href="trial_definition.Rmd">Trial Definition</a> vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="analysing-a-trial">Analysing a trial<a class="anchor" aria-label="anchor" href="#analysing-a-trial"></a>
</h2>
<p>Given the trial design constructed above, the process of analysing a
real life instance of the trial is simply a matter of providing the
model with the actual toxicity status of the participants treated so
far. The escalation rules we defined earlier allow the use of a single
patient run-in until either the first DLT is observed or until dose 20
has been administered.</p>
<div class="section level3">
<h3 id="the-single-patient-run-in">The single patient run-in<a class="anchor" aria-label="anchor" href="#the-single-patient-run-in"></a>
</h3>
<p>Assume that the first three patients - dosed at <code>1</code>,
<code>3</code> and <code>5</code> - completed the trial without
incident, but that the fourth patient - treated at <code>10</code> -
experienced a DLT.</p>
<p>We provide this information to <code>crmPack</code> via a
<code>Data</code> object:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">firstFour</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">doseGrid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Within a <code>Data</code> object, the doses at which each patient is
treated are given by the <code>x</code> slot and their toxicity status
(a Boolean where a toxicity is represented by a truthy value) by the
<code>y</code> slot.</p>
<p>The observed data is easily visualised</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">firstFour</span><span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>and, since the <code>plot</code> method returns a <code>ggplot</code>
object, it is easily customised.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">firstFour</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<p>Now, update the model to obtain the posterior estimate of the
dose-toxicity curve:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vignetteMcmcOptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/McmcOptions-class.html">McmcOptions</a></span><span class="op">(</span>burnin <span class="op">=</span> <span class="fl">100</span>, step <span class="op">=</span> <span class="fl">2</span>, samples <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">postSamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">firstFour</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  options <span class="op">=</span> <span class="va">vignetteMcmcOptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The posterior estimate of the dose toxicity curve is easily
visualised:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">postSamples</span>, <span class="va">model</span>, <span class="va">firstFour</span><span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<p>A visual representation of the model’s state is obtained with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">empty_data</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<p>The lower panel of the plot shows the posterior probability that each
dose is in the overdose range. The dashed horizontal black line shows
the acceptable risk of overdose: Doses with red lines which go above
this line are considered toxic. The upper panel shows the probability
that each dose is in the target toxicity range. Clearly, doses of
<code>30</code> and <code>45</code> have the highest probability of
being in the target toxicity range. However, the risk that both are in
the overdose range is unacceptable. Therefore, <code>20</code> is the
dose recommended for the next cohort.</p>
<p>We can produce a tabulation of the model state with</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tabulatePosterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mcmcSamples</span>, <span class="va">observedData</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>      <span class="va">my_next_best</span>,</span>
<span>      doselimit <span class="op">=</span> <span class="fl">100</span>,</span>
<span>      samples <span class="op">=</span> <span class="va">mcmcSamples</span>,</span>
<span>      model <span class="op">=</span> <span class="va">model</span>,</span>
<span>      data <span class="op">=</span> <span class="va">observedData</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">probs</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        dose <span class="op">=</span> <span class="va">observedData</span><span class="op">@</span><span class="va">x</span>,</span>
<span>        WithDLT <span class="op">=</span> <span class="va">observedData</span><span class="op">@</span><span class="va">y</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>          Treated <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          WithDLT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">WithDLT</span><span class="op">)</span>,</span>
<span>          .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>        <span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"dose"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Treated <span class="op">=</span> <span class="fl">0</span>, WithDLT <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dose</span>, <span class="va">Treated</span>, <span class="va">WithDLT</span>, <span class="va">target</span>, <span class="va">overdose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>      col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dose"</span>, <span class="st">"Treated"</span>, <span class="st">"With DLT"</span>, <span class="st">"Target range"</span>, <span class="st">"Overdose range"</span><span class="op">)</span>,</span>
<span>      digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Participants"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"Probability that dose is in "</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">tabulatePosterior</span><span class="op">(</span><span class="va">postSamples</span>, <span class="va">firstFour</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Participants
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Probability that dose is in
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Treated
</th>
<th style="text-align:right;">
With DLT
</th>
<th style="text-align:right;">
Target range
</th>
<th style="text-align:right;">
Overdose range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.028
</td>
<td style="text-align:right;">
0.010
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.079
</td>
<td style="text-align:right;">
0.027
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.197
</td>
<td style="text-align:right;">
0.092
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.279
</td>
<td style="text-align:right;">
0.295
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.243
</td>
<td style="text-align:right;">
0.492
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.199
</td>
<td style="text-align:right;">
0.675
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.152
</td>
<td style="text-align:right;">
0.811
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.077
</td>
<td style="text-align:right;">
0.905
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.929
</td>
</tr>
</tbody>
</table>
<p>From these presentations, we can see that:</p>
<ol style="list-style-type: decimal">
<li>The highest dose so far administered is <code>20</code>, so the
escalation rule permits doses up to and including <code>40</code> to be
considered as the dose for the next cohort. However…</li>
<li>Doses of <code>30</code> and above are considered unsafe</li>
<li>Of the remaining doses, <code>20</code> has the highest posterior
probability of being in the target toxicity range</li>
<li>A DLT has been reported</li>
</ol>
<p>Items 1 and 4 in the list tell us both that the size of the next
cohort should be three. Items 2 and 3 together imply that the highest
dose that can be used in the next cohort is <code>20</code>.</p>
<p>Thus, the model’s recommendation is that the next cohort should
consist of three patients, each treated at <code>20</code>. This can be
confirmed programmatically:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">firstFour</span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span>
<span><span class="co">#&gt; [1] 40</span></span>
<span></span>
<span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">firstFour</span></span>
<span><span class="op">)</span></span>
<span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 9</span></span></code></pre></div>
<p>However, given that the probability that <code>20</code> is in the
overdose range is only just less than the threshold of 0.25 (and because
the only participant so far treated at <code>20</code> experienced a
DLT) it would be a perfectly reasonable clinical decision to treat the
next cohort at <code>10</code> - or, indeed, at any other dose below
<code>20</code>. <i>There is absolutely no obligation to follow the CRM
dose recommendation without consideration of other factors that might
affect the choice of the most appropriate dose for the next cohort.</i>
However, for the purpose of exposition, we will treat the next cohort at
<code>20</code>, as recommended by the model.</p>
<p>We can confirm that the trial’s stopping rules have not been
satisfied:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  <span class="va">my_stopping</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">postSamples</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">firstFour</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; attr(,"message")[[1]]</span></span>
<span><span class="co">#&gt; attr(,"message")[[1]][[1]]</span></span>
<span><span class="co">#&gt; [1] "Number of cohorts is 4 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"message")[[1]][[2]]</span></span>
<span><span class="co">#&gt; [1] "Probability for target toxicity is 20 % for dose 9 and thus below the required 50 %"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"message")[[2]]</span></span>
<span><span class="co">#&gt; [1] "Number of patients is 4 and thus below the prespecified minimum number 20"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")</span></span>
<span><span class="co">#&gt; attr(,"individual")[[1]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; attr(,"message")[[1]]</span></span>
<span><span class="co">#&gt; [1] "Number of cohorts is 4 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"message")[[2]]</span></span>
<span><span class="co">#&gt; [1] "Probability for target toxicity is 20 % for dose 9 and thus below the required 50 %"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")</span></span>
<span><span class="co">#&gt; attr(,"individual")[[1]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; [1] "Number of cohorts is 4 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")[[2]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; [1] "Probability for target toxicity is 20 % for dose 9 and thus below the required 50 %"</span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")[[2]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; [1] "Number of patients is 4 and thus below the prespecified minimum number 20"</span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-first-full-cohort">The first full cohort<a class="anchor" aria-label="anchor" href="#the-first-full-cohort"></a>
</h3>
<p>Assume that none of the three patients in the first full cohort
report a DLT:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">firstFullCohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">doseGrid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Update the model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postSamples1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">firstFullCohort</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  options <span class="op">=</span> <span class="va">vignetteMcmcOptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Tabulate the posterior:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tabulatePosterior</span><span class="op">(</span><span class="va">postSamples1</span>, <span class="va">firstFullCohort</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Participants
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Probability that dose is in
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Treated
</th>
<th style="text-align:right;">
With DLT
</th>
<th style="text-align:right;">
Target range
</th>
<th style="text-align:right;">
Overdose range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
0.005
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.074
</td>
<td style="text-align:right;">
0.021
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.274
</td>
<td style="text-align:right;">
0.078
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.397
</td>
<td style="text-align:right;">
0.211
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.354
</td>
<td style="text-align:right;">
0.512
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.187
</td>
<td style="text-align:right;">
0.764
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.097
</td>
<td style="text-align:right;">
0.892
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:right;">
0.930
</td>
</tr>
</tbody>
</table>
<p>Should the trial stop? If not, what dose should be used for the next
cohort?</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">firstFullCohort</span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span>
<span><span class="co">#&gt; [1] 40</span></span>
<span></span>
<span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples1</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">firstFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 30</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  <span class="va">my_stopping</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">postSamples1</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">firstFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>So the trial should continue, treating three patients in the next
cohort at <code>30</code>.</p>
</div>
<div class="section level3">
<h3 id="the-second-full-cohort">The second full cohort<a class="anchor" aria-label="anchor" href="#the-second-full-cohort"></a>
</h3>
<p>Assume that none of the three patients in the next cohort report a
DLT:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">secondFullCohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">doseGrid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Update the model:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postSamples2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">secondFullCohort</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  options <span class="op">=</span> <span class="va">vignetteMcmcOptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Tabulate the posterior:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tabulatePosterior</span><span class="op">(</span><span class="va">postSamples2</span>, <span class="va">secondFullCohort</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Participants
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Probability that dose is in
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Treated
</th>
<th style="text-align:right;">
With DLT
</th>
<th style="text-align:right;">
Target range
</th>
<th style="text-align:right;">
Overdose range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.165
</td>
<td style="text-align:right;">
0.024
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.276
</td>
<td style="text-align:right;">
0.103
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.382
</td>
<td style="text-align:right;">
0.339
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.313
</td>
<td style="text-align:right;">
0.584
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.189
</td>
<td style="text-align:right;">
0.788
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.120
</td>
<td style="text-align:right;">
0.870
</td>
</tr>
</tbody>
</table>
<p>The dose with the highest posterior probability of being in the
target toxicity range is now <code>45</code>, but this dose also has an
unacceptably high probability of being in the overdose range. Therefore,
the trial should continue and the next cohort should be treated at
<code>30</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">secondFullCohort</span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span>
<span><span class="co">#&gt; [1] 45</span></span>
<span></span>
<span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples2</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">secondFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 30</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  <span class="va">my_stopping</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">postSamples2</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">secondFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-third-full-cohort">The third full cohort<a class="anchor" aria-label="anchor" href="#the-third-full-cohort"></a>
</h3>
<p>Assume that none of the three patients in the third cohort report a
DLT:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thirdFullCohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">doseGrid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Update the model:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postSamples3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">thirdFullCohort</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  options <span class="op">=</span> <span class="va">vignetteMcmcOptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Tabulate the posterior:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tabulatePosterior</span><span class="op">(</span><span class="va">postSamples3</span>, <span class="va">thirdFullCohort</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Participants
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Probability that dose is in
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Treated
</th>
<th style="text-align:right;">
With DLT
</th>
<th style="text-align:right;">
Target range
</th>
<th style="text-align:right;">
Overdose range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:right;">
0.002
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.209
</td>
<td style="text-align:right;">
0.030
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.436
</td>
<td style="text-align:right;">
0.170
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.411
</td>
<td style="text-align:right;">
0.436
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.221
</td>
<td style="text-align:right;">
0.717
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.123
</td>
<td style="text-align:right;">
0.841
</td>
</tr>
</tbody>
</table>
<p><code>45</code> is still the dose with the highest posterior
probability of being in the target toxicity range, and its probability
of being in the overdose range is now acceptable. Therefore, the trial
should continue and the next cohort should be treated at
<code>45</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">thirdFullCohort</span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span>
<span><span class="co">#&gt; [1] 45</span></span>
<span></span>
<span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples3</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">thirdFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 45</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  <span class="va">my_stopping</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">postSamples3</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">thirdFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-fourth-full-cohort">The fourth full cohort<a class="anchor" aria-label="anchor" href="#the-fourth-full-cohort"></a>
</h3>
<p>Assume that none of the three patients in the fourth cohort report a
DLT:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fourthFullCohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">16</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">doseGrid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Update the model:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postSamples4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fourthFullCohort</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  options <span class="op">=</span> <span class="va">vignetteMcmcOptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Tabulate the posterior:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tabulatePosterior</span><span class="op">(</span><span class="va">postSamples4</span>, <span class="va">fourthFullCohort</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Participants
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Probability that dose is in
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Treated
</th>
<th style="text-align:right;">
With DLT
</th>
<th style="text-align:right;">
Target range
</th>
<th style="text-align:right;">
Overdose range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.128
</td>
<td style="text-align:right;">
0.010
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.367
</td>
<td style="text-align:right;">
0.088
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.430
</td>
<td style="text-align:right;">
0.352
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:right;">
0.665
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.163
</td>
<td style="text-align:right;">
0.784
</td>
</tr>
</tbody>
</table>
<p><code>60</code> is now the dose with the highest posterior
probability of being in the target toxicity range, but its probability
of being in the overdose range is unacceptable. Therefore, the trial
should continue and the next cohort should be treated at
<code>45</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">fourthFullCohort</span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span>
<span><span class="co">#&gt; [1] 67.5</span></span>
<span></span>
<span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples4</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fourthFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 45</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  <span class="va">my_stopping</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">postSamples4</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">fourthFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-fifth-full-cohort">The fifth full cohort<a class="anchor" aria-label="anchor" href="#the-fifth-full-cohort"></a>
</h3>
<p>Assume that two of the three patients in the fourth cohort report a
DLT:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fifthFullCohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Data-class.html">Data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">19</span>,</span>
<span>  cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">9</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  doseGrid <span class="op">=</span> <span class="va">doseGrid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Update the model:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">postSamples5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmc.html">mcmc</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fifthFullCohort</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  options <span class="op">=</span> <span class="va">vignetteMcmcOptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Tabulate the posterior:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tabulatePosterior</span><span class="op">(</span><span class="va">postSamples5</span>, <span class="va">fifthFullCohort</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Participants
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Probability that dose is in
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Treated
</th>
<th style="text-align:right;">
With DLT
</th>
<th style="text-align:right;">
Target range
</th>
<th style="text-align:right;">
Overdose range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.099
</td>
<td style="text-align:right;">
0.006
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.290
</td>
<td style="text-align:right;">
0.027
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.533
</td>
<td style="text-align:right;">
0.243
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.339
</td>
<td style="text-align:right;">
0.605
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.153
</td>
<td style="text-align:right;">
0.829
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.087
</td>
<td style="text-align:right;">
0.906
</td>
</tr>
</tbody>
</table>
<p><code>45</code> remains the dose with the highest posterior
probability of being in the target toxicity range, and its probability
of being in the overdose range is acceptable. Moreover, the probability
that <code>45</code> is in the target toxicity range is above 0.5 and
more than three cohorts have been treated in total. Therefore, the trial
should stop and conclude that <code>45</code> is the MTD:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nextMaxDose</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxDose.html">maxDose</a></span><span class="op">(</span><span class="va">my_increments</span>, <span class="va">fifthFullCohort</span><span class="op">)</span></span>
<span><span class="va">nextMaxDose</span></span>
<span><span class="co">#&gt; [1] 67.5</span></span>
<span></span>
<span><span class="va">doseRecommendation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nextBest.html">nextBest</a></span><span class="op">(</span></span>
<span>  <span class="va">my_next_best</span>,</span>
<span>  doselimit <span class="op">=</span> <span class="va">nextMaxDose</span>,</span>
<span>  samples <span class="op">=</span> <span class="va">postSamples5</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fifthFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="co">#&gt; [1] 45</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stopTrial.html">stopTrial</a></span><span class="op">(</span></span>
<span>  <span class="va">my_stopping</span>,</span>
<span>  dose <span class="op">=</span> <span class="va">doseRecommendation</span><span class="op">$</span><span class="va">value</span>,</span>
<span>  <span class="va">postSamples5</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">fifthFullCohort</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; attr(,"message")[[1]]</span></span>
<span><span class="co">#&gt; attr(,"message")[[1]][[1]]</span></span>
<span><span class="co">#&gt; [1] "Number of cohorts is 9 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"message")[[1]][[2]]</span></span>
<span><span class="co">#&gt; [1] "Probability for target toxicity is 53 % for dose 45 and thus above the required 50 %"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"message")[[2]]</span></span>
<span><span class="co">#&gt; [1] "Number of patients is 19 and thus below the prespecified minimum number 20"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")</span></span>
<span><span class="co">#&gt; attr(,"individual")[[1]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; attr(,"message")[[1]]</span></span>
<span><span class="co">#&gt; [1] "Number of cohorts is 9 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"message")[[2]]</span></span>
<span><span class="co">#&gt; [1] "Probability for target toxicity is 53 % for dose 45 and thus above the required 50 %"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")</span></span>
<span><span class="co">#&gt; attr(,"individual")[[1]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; [1] "Number of cohorts is 9 and thus reached the prespecified minimum number 3"</span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")[[2]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; [1] "Probability for target toxicity is 53 % for dose 45 and thus above the required 50 %"</span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"individual")[[2]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; attr(,"message")</span></span>
<span><span class="co">#&gt; [1] "Number of patients is 19 and thus below the prespecified minimum number 20"</span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"report_label")</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summarising-the-trial-results">Summarising the trial results<a class="anchor" aria-label="anchor" href="#summarising-the-trial-results"></a>
</h2>
<p>crmPack provides a wealth of information about the trial’s results.
The following code snippets illustrate some of the many possibilities
for how the trial might be summarised.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fifthFullCohort</span><span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-33-1.png" width="480"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">postSamples5</span>, <span class="va">model</span>, <span class="va">fifthFullCohort</span><span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-33-2.png" width="480"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doseRecommendation</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-34-1.png" width="480"></p>
<p>With a little bit of work, we can obtain a more detailed summary and
plot of the posterior probabilities of toxicity at each dose:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slotNames</span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "params"          "ref_dose"        "datamodel"       "priormodel"     </span></span>
<span><span class="co">#&gt; [5] "modelspecs"      "init"            "datanames"       "datanames_prior"</span></span>
<span><span class="co">#&gt; [9] "sample"</span></span>
<span></span>
<span><span class="va">fullSamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Alpha <span class="op">=</span> <span class="va">postSamples5</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">alpha0</span>,</span>
<span>  Beta <span class="op">=</span> <span class="va">postSamples5</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">alpha1</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">expand</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">nesting</a></span><span class="op">(</span><span class="va">Alpha</span>, <span class="va">Beta</span><span class="op">)</span>, Dose <span class="op">=</span> <span class="va">doseGrid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>P <span class="op">=</span> <span class="fu"><a href="../reference/probFunction.html">probFunction</a></span><span class="op">(</span><span class="va">model</span>, alpha0 <span class="op">=</span> <span class="va">Alpha</span>, alpha1 <span class="op">=</span> <span class="va">Beta</span><span class="op">)</span><span class="op">(</span>dose <span class="op">=</span> <span class="va">Dose</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fullSummary</span> <span class="op">&lt;-</span> <span class="va">fullSamples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span>,</span>
<span>    Median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span>,</span>
<span>    Q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">P</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span></span>
<span>    col <span class="op">=</span> <span class="va">Q</span>,</span>
<span>    names_repair <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>        <span class="fu">str_detect</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"\\d+%"</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Q%02.0f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">str_remove_all</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="va">.x</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sprintf("Q%02.0f", as.numeric(str_remove_all(.x, "%"))): NAs</span></span>
<span><span class="co">#&gt; introduced by coercion</span></span>
<span></span>
<span><span class="va">fullSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dose"</span>, <span class="st">"Mean"</span>, <span class="st">"Median"</span>, <span class="st">"5th"</span>, <span class="st">"10th"</span>, <span class="st">"25th"</span>, <span class="st">"75th"</span>, <span class="st">"90th"</span>, <span class="st">"95th"</span><span class="op">)</span>,</span>
<span>    digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"Quantiles"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"P(Toxicity)"</span> <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="8">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
P(Toxicity)
</div>
</th>
</tr>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="3">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="6">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Quantiles
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
5th
</th>
<th style="text-align:right;">
10th
</th>
<th style="text-align:right;">
25th
</th>
<th style="text-align:right;">
75th
</th>
<th style="text-align:right;">
90th
</th>
<th style="text-align:right;">
95th
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:right;">
0.046
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.089
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
0.122
</td>
<td style="text-align:right;">
0.168
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.105
</td>
<td style="text-align:right;">
0.087
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
0.151
</td>
<td style="text-align:right;">
0.229
</td>
<td style="text-align:right;">
0.258
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.167
</td>
<td style="text-align:right;">
0.152
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
0.051
</td>
<td style="text-align:right;">
0.090
</td>
<td style="text-align:right;">
0.233
</td>
<td style="text-align:right;">
0.301
</td>
<td style="text-align:right;">
0.346
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
0.279
</td>
<td style="text-align:right;">
0.263
</td>
<td style="text-align:right;">
0.113
</td>
<td style="text-align:right;">
0.142
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.359
</td>
<td style="text-align:right;">
0.438
</td>
<td style="text-align:right;">
0.481
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.394
</td>
<td style="text-align:right;">
0.372
</td>
<td style="text-align:right;">
0.189
</td>
<td style="text-align:right;">
0.219
</td>
<td style="text-align:right;">
0.286
</td>
<td style="text-align:right;">
0.490
</td>
<td style="text-align:right;">
0.596
</td>
<td style="text-align:right;">
0.657
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0.514
</td>
<td style="text-align:right;">
0.500
</td>
<td style="text-align:right;">
0.237
</td>
<td style="text-align:right;">
0.278
</td>
<td style="text-align:right;">
0.376
</td>
<td style="text-align:right;">
0.647
</td>
<td style="text-align:right;">
0.769
</td>
<td style="text-align:right;">
0.837
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0.597
</td>
<td style="text-align:right;">
0.594
</td>
<td style="text-align:right;">
0.277
</td>
<td style="text-align:right;">
0.323
</td>
<td style="text-align:right;">
0.442
</td>
<td style="text-align:right;">
0.757
</td>
<td style="text-align:right;">
0.875
</td>
<td style="text-align:right;">
0.920
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fullSamples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Dose</span> <span class="op">&gt;</span> <span class="fl">9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">P</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Posterior PDFs for doses &gt; 9"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"Dose"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-35-1.png" width="480"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fullSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dose</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">Q05</span>, ymax <span class="op">=</span> <span class="va">Q95</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">Q10</span>, ymax <span class="op">=</span> <span class="va">Q90</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">Q25</span>, ymax <span class="op">=</span> <span class="va">Q75</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Mean</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Median</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Posterior Dose toxicity curve"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"Dose"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"P(Toxicity)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="trial_analysis_files/figure-html/unnamed-chunk-36-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>The analyses presented in this vignette have used chains of a very
short length. This is purely for convenience. Analyses of real trials
should use considerably longer chains. As an example, an effective
sample size of approximately 40,000 is required to estimate a percentage
to within ±1%.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Neuenschwander2008" class="csl-entry">
Neuenschwander, Beat, Michael Branson, and Thomas Gsponer. 2008.
<span>“Critical Aspects of the Bayesian Approach to Phase i Cancer
Trials.”</span> <em><span>Statistics in Medicine</span></em> 27 (13):
2420–39.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Sabanes Bove, Wai Yin Yeung, Burak Kuersad Guenhan, Giuseppe Palermo, Thomas Jaki, Jiawen Zhu, Ziwei Liao, Dimitris Kontos, Marlene Schulte-Goebel, Doug Kelkhoff, Oliver Boix, Robert Adams, Clara Beck, John Kirkpatrick, F. Hoffmann-La Roche AG, Merck Healthcare KGaA, Bayer AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
